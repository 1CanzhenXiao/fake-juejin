---
highlight: nord
theme: vuepress
---

## ğŸ¦„ é—®é¢˜

åç«¯åŒå­¦åœ¨ä½¿ç”¨æˆ‘ä»¬ç ”å‘çš„ [å·¥ä½œå°](https://workspace.jianguoyun.com/task/) æ—¶å‘ç°äº†ä¸€äº›æ€§èƒ½ä¸Šçš„é—®é¢˜ã€‚åœ¨ä»–çš„ç”µè„‘ä¸Šå¿«é€Ÿå‘é€æ¶ˆæ¯æ—¶ä¼šæ„Ÿè§‰åˆ°æ˜æ˜¾çš„æ¶ˆæ¯ loading ç­‰å¾…æ—¶é—´è¾ƒé•¿çš„é—®é¢˜ã€‚ä½†æ˜¯æˆ‘ä»¬ä½¿ç”¨ HTTP 2 æœ¬èº«å°±å¯ä»¥å¤šè·¯å¤ç”¨ã€‚å¹¶ä¸”åœ¨æ­£å¼ç¯å¢ƒä¸­ã€‚åç«¯å‘é€æ¶ˆæ¯çš„æ¥å£å¹³å‡å“åº”åœ¨ 20 msã€‚å› æ­¤å¯ä»¥æ’é™¤æ˜¯åç«¯æ¥å£çš„åŸå› ã€‚é‚£ä¹ˆåªèƒ½ä»å‰ç«¯æ–¹é¢å…¥æ‰‹ï¼Œçœ‹çœ‹æ˜¯ä»€ä¹ˆåŸå› é€ æˆçš„ loading æ—¶é—´ç­‰å¾…è¾ƒé•¿çš„åŸå› äº†ã€‚

å…ˆçœ‹çœ‹ä¼˜åŒ–ä¹‹å‰çš„æ•ˆæœå›¾ **ï¼ˆå› ä¸ºå†å½•åˆ¶å±å¹•ï¼Œè¿™ä¸ª loading ç­‰å¾…è¾ƒé•¿çš„é—®é¢˜ä¼šå°¤ä¸ºæ˜æ˜¾ï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œå¿«é€Ÿå‘æ¶ˆæ¯æŒç»­ 15s å°±ä¼šå¤ç°ã€‚ï¼‰**ï¼š

![2022-08-07 07.59.23.gif](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/366d9375fe364ca489e1443433f799bf~tplv-k3u1fbpfcp-watermark.image?)

## ğŸ¤” åˆ†æ

ä¸ºä»€ä¹ˆä¼šæœ‰è¿™ä¹ˆé•¿çš„ loading ç­‰å¾…æ—¶é—´å‘¢ï¼Ÿ

é‚£æˆ‘ä»¬å…ˆæ‰“å¼€ DevTools è¿›è¡Œä¸€ä¸‹æ€§èƒ½åˆ†æå§ï¼

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f64ca725e55740a696fd2481d592bb39~tplv-k3u1fbpfcp-watermark.image?)

ç‚¹å‡»å½•åˆ¶ï¼Œç„¶åç­‰å¾…å½•åˆ¶ç»“æœã€‚æˆ‘ä»¬è¿›è¡Œåˆ†æï¼

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f8361268a679426d9cbe29e9bee63672~tplv-k3u1fbpfcp-watermark.image?)

å¯ä»¥çœ‹åˆ°ï¼Œé¦–å…ˆä»»åŠ¡è¢« React åˆ‡åˆ†çš„å¾ˆæ¼‚äº® ğŸ˜€ã€‚å…¶æ¬¡ä»”ç»†è§‚å¯Ÿå¯ä»¥å‘ç°æœ‰**å¾ˆå¤šä»»åŠ¡è€—æ—¶éƒ½åœ¨ 200+ms**ï¼Œé‚£ç©¶ç«Ÿæ˜¯ä»€ä¹ˆå¼•èµ·çš„è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿæˆ‘å…ˆéšä¾¿å…ˆå±•å¼€ä¸€ä¸ªé•¿ä»»åŠ¡è¿›è¡Œåˆ†æã€‚

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/58a8a25952b647ea84ef41f397fb4e10~tplv-k3u1fbpfcp-watermark.image?)

æˆ‘ä»¬å¯ä»¥æ¸…æ™°çš„çœ‹åˆ°ï¼Œåœ¨å‘é€æ¶ˆæ¯çš„è¿‡ç¨‹ä¸­ï¼ŒReact ä¼šåšå¤šæ¬¡çš„æ¸²æŸ“ï¼Œè¿™ä¸ªç§æƒ…å†µéå¸¸çš„ä¸æ­£å¸¸ã€‚ä¸ºäº†æ‰¾åˆ°é—®é¢˜çš„æ ¹æœ¬ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è¿›ä¸€æ­¥ç¡®è®¤ã€‚

æ¥ä¸‹æ¥æˆ‘ä»¬æ‰“å¼€ React Developer Tools è¿›è¡Œåˆ†æã€‚æŸ¥çœ‹æ˜¯å…·ä½“æ˜¯å“ªé‡Œé€ æˆäº†è¿™ä¹ˆå¤šæ¬¡çš„æ¸²æŸ“ã€‚

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8c24b0ae2aad4799a24efdd6c113e25b~tplv-k3u1fbpfcp-watermark.image?)

æ•ˆæœå›¾å¦‚ä¸‹ï¼š

![2022-08-07 08.27.18.gif](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9dc1dad036a0455a96106603ca24b288~tplv-k3u1fbpfcp-watermark.image?)

ç«Ÿç„¶æ¸²æŸ“äº†è¿™ä¹ˆå¤šæ¬¡ï¼æˆ‘è®¤ä¸ºæˆ‘ä»¬å·²ç»æ‰¾åˆ°äº†é€ æˆå¿«é€Ÿå‘é€æ¶ˆæ¯ loading ç­‰å¾…æ—¶é—´è¾ƒé•¿çš„å…ƒå‡¶ï¼

æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦ä»”ç»†é˜…è¯»ä»£ç ï¼ŒæŸ¥çœ‹æ˜¯å“ªé‡Œé€ æˆäº†å¤šæ¬¡çš„æ¸²æŸ“ï¼


## ğŸ˜„ ä¼˜åŒ–

### ğŸ‘‰ ImChatBody 

é¦–å…ˆæˆ‘ä»¬æ¥æŸ¥çœ‹é˜…è¯» ImChatBody ç»„ä»¶çš„ç›¸å…³ä»£ç ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¦‚ä¸‹ä»£ç ï¼š


```
export function ImChatBody(props: ImChatBodyProps): JSX.Element {

  ...

  const renderMessageList = (): ReactNode => {
   const getGroupInfo = () => {
       ...
   }

    return (
      <>
        {messages.map((message, idx) => {
         
          return (
            <Fragment key={message.localId || message.ID}>
             ...
              <ImMessageItem
                ...
                message={message}
                ...
              />
            </Fragment>
          )
        })}
      </>
    )
  }

  return (
    ...
    {renderMessageList()}
    ...
    </div>
  )
}
```

å¯¹äºè¿™ç§ JSX ä»£ç ï¼Œæˆ‘ä»¬éœ€è¦è­¦æƒ•ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿ

é¦–å…ˆè¿™ä¸ªä»£ç å†™æˆäº†å‡½æ•°çš„å½¢å¼ï¼Œåœ¨å½“é¡µé¢ä»»ä½•ä¸€ä¸ªçŠ¶æ€å‘é€æ”¹å˜æ—¶ï¼Œéƒ½ä¼šä»æ–°è¿›è¡Œé€’å½’æ›´æ–°é¡µé¢ï¼Œéƒ½ä¼šæ‰§è¡Œåˆ°è¿™ä¸ª renderMessageList() å‡½æ•°ï¼Œå°½ç®¡ React ä¼šå¤ç”¨å¯å¤ç”¨çš„ Fiberï¼Œä½†æ˜¯åœ¨ diff é˜¶æ®µï¼ŒreconcileChildrenArray å‡½æ•°ä¸­ï¼Œä¼šä½¿ç”¨æœ€æ–°çš„ JSX å¯¹è±¡å’Œ Fiber å¯¹è±¡è¿›è¡Œå¯¹æ¯”ã€‚é€šå¸¸å‡½æ•°æ‰§è¡Œå¾ˆå¤šæ¬¡ï¼Œé‚£ä¹ˆå¯ä»¥æƒ³è±¡è¿™ä¸ªå¯¹æ€§èƒ½çš„æ¶ˆè€—ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹çœ‹è¿™ä¸ªå‡½æ•°çš„æ‰§è¡Œæ¬¡æ•°ã€‚

å¦‚ä¸‹å›¾ï¼š

![2022-08-07 08.47.09.gif](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5d3207ad71aa4a02ae674b94718ae5b8~tplv-k3u1fbpfcp-watermark.image?)

æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ¸…æ™°çš„çœ‹åˆ°è¿™ä¸ª List æ¸²æŸ“äº†è¿™ä¹ˆå¤šæ¬¡ã€‚å› æ­¤è¿™æ˜¯ä¸€ä¸ªéå¸¸å€¼å¾—ä¼˜åŒ–çš„ç‚¹ã€é‚£æˆ‘ä»¬éœ€è¦æ€ä¹ˆä¼˜åŒ–å‘¢ï¼Ÿ

1. é¦–å…ˆéœ€è¦å°†å…¶æ”¹ä¸ºä¸€ä¸ªæ­£å¸¸çš„ç»„ä»¶ã€‚
2. åœ¨ä½¿ç”¨ memo å¯¹å…¶è¿›è¡Œæ€§èƒ½ä¼˜åŒ–ã€‚
3. å®Œæˆç»„ä»¶çš„æ”¹é€ ä¹‹åå†è¿›è¡Œ console çš„æ‰“å°ï¼Œä»¥ç¡®å®šå…¶çš„ä¼˜åŒ–æ˜¯å¦ OKã€‚


```
const RenderMessageList = memo(function RenderMessageList({
  messages,
  ...
}: {
  messages: Message[]
  ...
}) {
  ...

  const getGroupInfo = useMemo(
    () =>
     ...
    [messages, ...],
  )

  return (
    <>
      {messages.map((message, idx) => {
       ...
        return (
          <MessageItem
            key={message.localId || message.ID}
            message={message}
            ...
          />
        )
      })}
    </>
  )
})
```
æˆ‘ä»¬åœ¨å¯¹å…¶è¿›è¡Œ console çš„æ‰“å°è¾“å‡ºï¼ŒæŸ¥çœ‹è¯¥ç»„ä»¶çš„æ¸²æŸ“æ¬¡æ•°ã€‚

![2022-08-07 09.03.52.gif](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1aa572e1f2064f3eba3fa70f5e98ec1a~tplv-k3u1fbpfcp-watermark.image?)

æœ‰çš„åŒå­¦å¯èƒ½ä¼šé—®ï¼Œä¸ºä»€ä¹ˆéœ€è¦ä½¿ç”¨ memo å‘¢ï¼Ÿ

å› ä¸ºå‡½æ•°ç»„ä»¶çš„ç‰¹æ€§ï¼Œå…¶å®å’Œ renderMessageList è¿™ä¸ªæ ·å­å†™æ‰€å¾—åˆ°çš„æ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚æˆ‘ä»¬ä½¿ç”¨ memo çš„åŸå› å°±æ˜¯æƒ³å‡å°‘ RenderMessageList ç»„ä»¶çš„æ¸²æŸ“æ¬¡æ•°ã€‚é‚£ memo å°±æ¯”è¾ƒåˆé€‚ã€‚å½“ä¸ä¼ é€’ ç¬¬äºŒä¸ªå‚æ•°æ—¶ï¼Œå®ƒä¼šå¯¹ props è¿›è¡Œå¼•ç”¨çš„å¯¹æ¯”æ¥å‡å°‘æ¸²æŸ“çš„æ¬¡æ•°ã€‚

å°±ç›®å‰çš„æ•ˆæœæ¥çœ‹ï¼Œå¯¹äº renderMessageList å‡½æ•°çš„ä¼˜åŒ–æ˜¯æˆåŠŸçš„ã€‚

### ğŸ‘‰ ImMessageItem

æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦å°†æ³¨æ„åŠ›æ”¾åˆ° ImMessageItem è¿™ä¸ªç»„ä»¶ä¸Šã€‚è¯¥ç»„ä»¶çš„ä¸»è¦ä½œç”¨å°±æ˜¯æ ¹æ®æ¶ˆæ¯çš„ç±»å‹ï¼Œæ¥æ¸²æŸ“ä¸åŒçš„æ¶ˆæ¯ã€‚

ä½†æ˜¯æˆ‘ä»¬å¯ä»¥ä» renderMessageList å‡½æ•°ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬æ˜¯ç›´æ¥éå† Messages è¿™ä¸ªæ•°ç»„è¿›è¡Œæ¶ˆæ¯çš„æ¸²æŸ“ã€‚ä½†æ˜¯åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­å‘ç°ï¼Œæ¯æ¬¡å‘é€æ–°æ¶ˆæ¯ï¼Œæ–°æ¶ˆæ¯éƒ½ä¼šè§¦å‘ç”Ÿæˆä¸‰æ¬¡æ–°çš„ Messages æ•°ç»„ï¼Œå› ä¸ºå¼•ç”¨çš„ä¸åŒï¼ŒåŒ…æ‹¬ Messages æ•°ç»„ä¸­çš„æ¯ä¸ªå¯¹è±¡çš„å¼•ç”¨ä¹Ÿè·Ÿç€æ”¹å˜ï¼Œé‚£ä¹ˆå¯¹äºä¹‹å‰çš„æ¶ˆæ¯æ¥è¯´ï¼Œprops æ”¹å˜ï¼ŒImMessageItem ç»„ä»¶ä¹Ÿä¼šä»æ–°æ¸²æŸ“ã€‚

å¦‚å›¾ï¼š


![2022-08-07 09.21.54.gif](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3aca9501a749407a944ee3357ce19ff4~tplv-k3u1fbpfcp-watermark.image?)

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä¼šæœ‰å¾ˆå¤šæ¬¡çš„æ¸²æŸ“ï¼Œconsole ä¼šè¢«åˆ†ä¸ºä¸‰ä¸ª 16 æ¬¡ï¼Œæˆ‘ä»¬çš„æ¶ˆæ¯é¡µï¼Œä¸€é¡µä¹Ÿæ˜¯ 16 æ¡
æ¶ˆæ¯ã€‚

å› æ­¤æˆ‘ä»¬éœ€è¦è€ƒè™‘æ€ä¹ˆè¿›è¡Œä¼˜åŒ–å‘¢ï¼Ÿ

1. å¯¹äºä¹‹å‰çš„è€æ•°æ®æ¥è¯´ï¼Œæˆ‘ä»¬éœ€è¦è®©å…¶ä¸è¿›è¡Œæ¸²æŸ“ã€‚
2. ImMessageItem ç»„ä»¶åªæ¸²æŸ“æ–°çš„æ¶ˆæ¯ã€‚

æ€è·¯ç°åœ¨æœ‰äº†ï¼Œä½†æ˜¯åº”è¯¥è€ƒè™‘æ€ä¹ˆå®ç°å‘¢ï¼Ÿå› ä¸ºæ¯ä¸ª Message çš„å¼•ç”¨éƒ½ä¸åŒï¼Œå› æ­¤ useMemo, useCallback ä¹Ÿéƒ½ä½¿ç”¨ä¸äº†ã€‚æˆ‘ä»¬çš„æƒ³æ³•æ˜¯ä¸æ¸²æŸ“è€çš„æ¶ˆæ¯æ•°æ®ï¼Œå¯¹è±¡çš„å¼•ç”¨ä¸èƒ½ç”¨äºåˆ¤æ–­ï¼Œé‚£æˆ‘ä»¬åªèƒ½ä½¿ç”¨ memo çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œä¼ é€’å‡½æ•°æ‰‹åŠ¨æ§åˆ¶ç»„ä»¶çš„æ¸²æŸ“äº†ã€‚


1. å°† ImMessageItem ç»„ä»¶å‘¨å›´çš„ä»£ç å†å°è£…ä¸€ä¸ªç»„ä»¶ã€‚
2. ä½¿ç”¨ memo å¯¹å…¶è¿›è¡Œæ›´åŠ è¯¦ç»†çš„ä¼˜åŒ–ã€‚å¯ä»¥è€ƒè™‘ä½¿ç”¨ equals å‡½æ•°è¿›è¡Œå†…å®¹çš„åˆ¤æ–­ã€‚ï¼ˆå› ä¸ºå¯¹äºè€çš„æ¶ˆæ¯æ•°æ®å†…å®¹æ˜¯ä¸ä¼šæ”¹å˜çš„ï¼‰
3. console éªŒè¯ç»„ä»¶çš„æ¸²æŸ“æ¬¡æ•°


```
const MessageItem = memo(
  function MessageItem({
    message,
    ...
  }: {
    message: Message
    ...
  }) {
    return (
      <Fragment key={message.localId || message.ID}>
        ...
        <ImMessageItem
          ...
          message={message}
          ...
        />
      </Fragment>
    )
  },
  function areEqual(prevProps, nextProps) {
    return equals(prevProps.message, nextProps.message)
  },
)
```

åœ¨è¿™é‡Œæœ‰çš„åŒå­¦å¯èƒ½ä¼šè§‰å¾—ï¼Œç›´æ¥ä½¿ç”¨ equals ä¹Ÿä¼šæœ‰æ€§èƒ½é—®é¢˜ï¼Œæ¯æ¬¡éƒ½ä¼šè¿›è¡Œå†…å®¹çš„æ·±å…¥æ¯”è¾ƒï¼Œä¹Ÿæ˜¯æœ‰é—®é¢˜çš„ã€‚æˆ‘ä¹Ÿæ˜¯æ˜ç¡®è¿™ä¸€ç‚¹çš„ï¼Œåœ¨è¿™é‡Œæˆ‘å…¶å®åšäº†ä¸€äº›è¡¡é‡çš„ï¼Œé¦–å…ˆå¯¹äºä¹‹å‰çš„å†™æ³•ä¼šé€ æˆå¤§é‡çš„æ¸²æŸ“ï¼Œç›´æ¥å¯¼è‡´æ¶ˆæ¯çš„loadingç­‰å¾…æ—¶é—´è¾ƒé•¿ã€‚ç›¸æ¯”è¾ƒäº equals å‡½æ•°ï¼Œè™½ç„¶ä¹Ÿä¼šé€ æˆä¸€äº›æ€§èƒ½ä¸Šçš„é—®é¢˜ï¼Œä½†æ˜¯äºŒè€…æ¯”è¾ƒä¹‹ä¸‹ï¼Œequals æ‰€é€ æˆçš„æ€§èƒ½è¦è¿œå°äºç›®å‰çš„å†™æ³•ï¼Œæˆ‘è§‰å¾—è¿™æ ·çš„æ€§èƒ½ç‰ºç‰²æ˜¯å€¼å¾—çš„ï¼

å¦‚å›¾ï¼š

![2022-08-07 09.50.06.gif](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cd364b97f0a4494fbb44601b8154eff0~tplv-k3u1fbpfcp-watermark.image?)

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ•ˆæœè¿˜æ˜¯éå¸¸ä¸é”™çš„ï¼ğŸ‘ğŸ»

### ğŸ‘‰ MessageContentRenderer 

æˆ‘ä»¬æ¥ä¸‹æ¥å°†æ³¨æ„åŠ›èšç„¦åœ¨ messageContentRenderer å‡½æ•°ä¸Šï¼Œè¿™ä¸ªå‡½æ•°ä¸»è¦çš„ä½œç”¨å°±æ˜¯æ¸²æŸ“ä¸åŒæ¶ˆæ¯ç±»å‹ï¼Œæ€»ä½“æ¥è¯´è¿™éƒ¨åˆ†çš„ä»£ç é—®é¢˜ç›¸å¯¹æ¥è¯´æ¯”è¾ƒå¤šã€‚


```
function messageContentRenderer({
  message,
  ...
}: {
  message: Message
  ...
}): null | JSX.Element {
  const AccountWrapper: FC<{ children: JSX.Element; account: Account }> = ({
    children,
    account,
  }) => {
    return ticketPermission ? (
      <FastAssign
        ticketPermission={ticketPermission}
        ...
      >
        {children}
      </FastAssign>
    ) : (
      <>{children}</>
    )
  }
  const header: undefined | JSX.Element =
    isShowMessageHeader && !mergeWithPrevMessage ? (
      <MessageHeader message={message} AccountWrapper={AccountWrapper} />
    ) : undefined

  const createContentRender = (
    content: JSX.Element,
    showSendState?: boolean,
  ): JSX.Element => (
    <MessageContentWithMenu
      message={message}
      ...
    >
      {content}
    </MessageContentWithMenu>
  )

  switch (message.type) {
    case MessageType.text:
      return (
        <ImMessageText
          from={message.from}
          ...
          customContentRender={content => createContentRender(content, true)}
        />
      )
    case MessageType.htmlText:
      return (
        <ImMessageHTMLText
          message={message}
          ...
          customContentRender={createContentRender}
        />
      )
    case MessageType.richText:
      return (
        <ImMessageRichText
          message={message}
          ...
          customContentRender={content => createContentRender(content, true)}
        />
      )
    case MessageType.file:
      const isImageMessage = Boolean(message.payload.thumbnailPreviewUrl)
      return (
        <ImMessageCustomFile
          message={message}
          ...
          customContentRender={createContentRender}
        />
      )
    case MessageType.sticker:
      return (
        <StickerMessage
          message={message}
          ...
          customContentRender={createContentRender}
        />
      )
    case MessageType.revoked:
      return <RevokedMessage message={message} header={header} />
  }
}
```

ä»”ç»†é˜…è¯»ä»£ç æˆ‘ä»¬å¯ä»¥å‘ç°åƒ AccountWrapperã€headerã€createContentRender è¿™äº› JSX æˆ‘ä»¬éœ€è¦ä½¿ç”¨ useMemoã€useCallback å¯¹å…¶è¿›è¡Œä¿å­˜å¼•ç”¨ï¼Œå‡å°‘å…¶æ›´æ–°ï¼Œè¿›ä¸€æ­¥çš„å‡å°‘å„ä¸ªæ¶ˆæ¯ç»„ä»¶ props çš„å¼•ç”¨æ”¹å˜å¯¼è‡´çš„é‡å¤æ¸²æŸ“ã€‚


```
export const MessageContentRenderer = memo(function MessageContentRenderer({
  message,
  ...
}: {
  message: Message
  ...
}) {
  const AccountWrapper: FC<{
    children: JSX.Element
    account: Account
  }> = useMemo(
    () => ({ ... }) => {
      return ticketPermission ? (
        <FastAssign
          ...
        >
          {children}
        </FastAssign>
      ) : (
        <>{children}</>
      )
    },
    [...],
  )

  const header: undefined | JSX.Element = useMemo(
    () =>
      isShowMessageHeader && !mergeWithPrevMessage ? (
        <MessageHeader ... />
      ) : undefined,
    [...],
  )

  const CreateContentRender: FC<{ showSendState?: boolean }> = useMemo(
    () => props => (
      <MessageContentWithMenu
       ...
      >
        {props.children}
      </MessageContentWithMenu>
    ),
    [...],
  )

  switch (message.type) {
    case MessageType.text:
      return (
        <ImMessageText
          ...
          message={message}
          ...
          CreateContentRender={CreateContentRender}
        />
      )
    case MessageType.htmlText:
      return (
        <ImMessageHTMLText
          message={message}
          ...
          CreateContentRender={CreateContentRender}
        />
      )
    case MessageType.richText:
      return (
        <ImMessageRichText
          message={message}
          ...
          CreateContentRender={CreateContentRender}
        />
      )
    case MessageType.file:
      const isImageMessage = Boolean(message.payload.thumbnailPreviewUrl)
      return (
        <ImMessageCustomFile
          message={message}
          ...
          CreateContentRender={CreateContentRender}
        />
      )
    case MessageType.sticker:
      return (
        <StickerMessage
          message={message}
          ...
          CreateContentRender={CreateContentRender}
        />
      )
    case MessageType.revoked:
      return <RevokedMessage ... />
  }
})
```

å¯¹äº messageContentRenderer å‡½æ•°çš„ä¼˜åŒ–å…¶å®ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶æ”¹ä¸ºç»„ä»¶ï¼Œä½¿ç”¨ memo å¯¹å…¶è¿›è¡Œæ€§èƒ½ä¸Šçš„ä¼˜åŒ–ã€‚å¦å¤–å°±æ˜¯ä¹Ÿä½¿ç”¨äº†ä¸€äº›å¸¸è§„çš„ä¼˜åŒ–æ‰‹æ³•ã€‚å€¼å¾—ä¸€è¯´çš„å°±æ˜¯ props.children ä¼˜åŒ–çš„æ€è·¯ã€‚è¿™ç§ä¼˜åŒ–æ–¹æ³•ä¸»è¦çš„æ€è·¯å°±æ˜¯é¿å…åœ¨çŠ¶æ€æ›´æ–°æ—¶ï¼Œæ‰§è¡Œ **React.createElement**ã€‚è€Œæ˜¯è®© React ç›´æ¥æ¸²æŸ“ children å³å¯ã€‚

æˆ‘ä»¬å¯ä»¥åœ¨ ImMessageText ç»„ä»¶ä¸­ console æ‰“å°ä¸€ä¸‹æ¸²æŸ“æ¬¡æ•°ã€‚

å¦‚å›¾ï¼š


![2022-08-07 10.26.34.gif](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5e859839022147d88c61613a434340e8~tplv-k3u1fbpfcp-watermark.image?)

æ•ˆæœä¹Ÿæ˜¯æ¯”è¾ƒæˆåŠŸçš„ã€‚ğŸ‘ğŸ»

## ğŸ‘€ æ•ˆæœå±•ç¤º

æœ¬æ¬¡ä¼˜åŒ–è¿˜æœ‰ä¸€äº›æ¯”è¾ƒå°çš„ä¼˜åŒ–ç‚¹åœ¨æœ¬ç¯‡æ–‡ç« ä¸­å¹¶æ²¡æœ‰å±•ç¤ºå‡ºæ¥ã€‚åªå±•å‡ºäº†ä¸€äº›æ¯”è¾ƒé‡è¦çš„ä¼˜åŒ–ç‚¹ã€‚
æœ€åæˆ‘ä»¬å†æ¥çœ‹çœ‹ React Developer Tools æ£€æµ‹çš„æ¸²æŸ“æƒ…å†µã€‚

å¦‚å›¾ï¼š


![2022-08-07 10.35.42.gif](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9b952875c5a34faabcfea5f9626420a7~tplv-k3u1fbpfcp-watermark.image?)

æœ¬æ¬¡çš„ä¼˜åŒ–å…¶å®å¹¶æ²¡æœ‰åšåˆ°å®Œç¾ï¼Œä½†æ˜¯ç»¼åˆè€ƒè™‘äº†æ—¶é—´æˆæœ¬ï¼Œå¹¶ä¸”å’Œç›®å‰æ‰€å¾—åˆ°çš„æ€§èƒ½è¡¨ç°æ¥çœ‹ï¼Œè¿˜æ˜¯ä¸€æ¬¡æˆåŠŸæ€§èƒ½ä¼˜åŒ–ã€‚å› æ­¤åç»­çš„ä¼˜åŒ–å¯ä»¥ç•™åˆ°ä»¥åå†å‡ºç°æ€§èƒ½é—®é¢˜çš„æ—¶å€™åœ¨åšå¤„ç†ã€‚

## ğŸ æ‹›è˜

å¤§å®¶å¥½å‘€ï¼æˆ‘å¸ï¼ˆ[åšæœäº‘](https://www.jianguoyun.com/)ï¼‰æ­£åœ¨æ‹›è˜å‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆã€‚èƒ½åŠ›è¦æ±‚å¦‚ä¸‹ï¼š

* ç†Ÿç»ƒä½¿ç”¨è‡³å°‘ä¸€ç§ç°ä»£å‰ç«¯æ¡†æ¶ï¼ŒåŒ…æ‹¬ä½†ä¸é™äº React, Vue.js, Angular
* å…·å¤‡è¾ƒå¼ºçš„å­¦ä¹ èƒ½åŠ›
* ç†Ÿç»ƒä½¿ç”¨ TypeScript ç¼–å†™ä»£ç 
* ç†Ÿç»ƒä½¿ç”¨ [RxJS](https://rxjs-dev.firebaseapp.com/) æè¿°å¤æ‚çš„ä¸šåŠ¡é€»è¾‘
* å¯¹ CSS æœ‰æ·±å…¥äº†è§£
* é™¤äº† Reactï¼Œèƒ½å¤Ÿç†Ÿç»ƒä½¿ç”¨ Vue ç¼–å†™å‰ç«¯å•é¡µåº”ç”¨
* ç†Ÿæ‚‰ [Electron](https://www.electronjs.org/), [React Native](https://reactnative.dev/)
* æœ‰ GitHub å¼€æºä»£ç ã€ä¸ªäººä½œå“

[è¯¦æƒ…è¯·ç‚¹å‡» ğŸ‘‡ğŸ» é“¾æ¥å“¦ï¼](https://juejin.cn/pin/7130438205198827557)

å¦‚æœä½ æœ‰æ„å‘è¯·å‘é€ç®€å†åˆ° [joinus@nutstore.net](mailto:joinus@nutstore.net) ã€‚ **å¤‡æ³¨ Destiny__** è®©æˆ‘ä»¬çŸ¥é“ä½ æ˜¯ä»è¿™ç¯‡æ–‡ç« çœ‹åˆ°çš„æ‹›è˜ä¿¡æ¯ï¼

**ï¼ˆä»¥ä¸Šä¸ªäººæŠ€èƒ½åªéœ€æ»¡è¶³éƒ¨åˆ†å³å¯ï¼‰å¦å¤–ï¼Œæˆ‘ä»¬å‘¨æœ«åŒä¼‘ã€‚**


## ğŸ‘ å¾€æœŸç²¾å½©

- [ğŸ‘ç®€å•è®¾è®¡ä¸€ä¸ª Form è¡¨å•ï¼](https://juejin.cn/post/7100450789079908388)
- [ğŸ‘React ç»„ä»¶ä¼˜åŒ–ç¬¬äºŒå¼¹æ¥è¢­ï¼ï¼](https://juejin.cn/post/7031336216066785294)
- [ğŸ‘è¿™äº›é¿å…Reactç»„ä»¶é‡å¤æ¸²æŸ“çš„æ‰‹æ®µä½ éƒ½çŸ¥é“å—ï¼Ÿ](https://juejin.cn/post/7023172291622076447)
- [ğŸ‘é¡¹ç›®å¼•å…¥ESBuildï¼Œç¼–è¯‘ç›´æ¥å¿«ä¸Šå¤©ï¼ï¼](https://juejin.cn/post/7020198955862458405)
- [ğŸ‘åœ¨Reactä¸­ä½¿ç”¨WebComponentsç»„ä»¶çš„æœ€ä½³å®è·µ](https://juejin.cn/post/7016870673658167310)
- [ğŸ‘æˆ‘æ˜¯æ€æ ·å°†50+MBçš„appæ‰“åŒ…æ–‡ä»¶ä¼˜åŒ–ä¸º4.2MBçš„ï¼Ÿ](https://juejin.cn/post/7010551051166154759)
- [ğŸ‘styleds-components çš„åŸç†ä½ èƒ½è®²ä¸€ä¸‹å—ï¼Ÿ](https://juejin.cn/post/7004611322222477326)  
- [ğŸ‘é¢è¯•å®˜ï¼šä½ èƒ½è®²ä¸€ä¸‹extendså’Œå¯„ç”Ÿå¼ç»„åˆç»§æ‰¿åŸå‹ä¹‹é—´çš„åŒºåˆ«ï¼Ÿ](https://juejin.cn/post/6999419506074320909)  
- [ğŸ‘å‰ç«¯Leaderè®©æˆ‘ç»™åŒäº‹è®²è®²äº‹ä»¶å¾ªç¯](https://juejin.cn/post/6994609420495765540) 
- [ğŸ‘Reactä¸VueçŠ¶æ€æ›´æ–°åŸç†å¯¹æ¯”](https://juejin.cn/post/6985314580339621901)  
- [ğŸ‘å½“Reacté‡åˆ°æ ‘å½¢ç©¿æ¢­æ¡†å’‹åŠï¼Ÿ](https://juejin.cn/post/6980121033072181279)  
- [ğŸ‘ä½¿ç”¨Reactæ—¶è¦é¿å…çš„ 10 å¤§é”™è¯¯](https://juejin.cn/post/6971215985026007076) 
- [ğŸ‘webpackæ‰“åŒ…ä¼˜åŒ–æ–¹å‘æŒ‡å—(ç†è®ºç¯‡)](https://juejin.cn/post/6960490563455942692) 
- [ğŸ‘vueé‡åˆ°æ‹–æ‹½åŠ¨æ€ç”Ÿæˆç»„ä»¶æ€ä¹ˆåŠï¼Ÿ](https://juejin.cn/post/6958378433604747278) 
- [ğŸ‘JS Coding æŠ€å·§ï¼Œå¤§å¤šæ•°äººéƒ½ä¸ä¼šï¼ï¼](https://juejin.cn/post/6950066851120414757)  
- [ğŸ‘TypeScript å®ƒä¸é¦™å—ï¼Ÿè¿˜ä¸å¿«æ¥ï¼](https://juejin.cn/post/6844903846859243528) 