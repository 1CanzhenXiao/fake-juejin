---
theme: cyanosis
highlight: a11y-light
---
# React - Hooks çŸ¥è¯†ä½“ç³»æ¦‚è§ˆ

- **èµ·æ­¥**ï¼šæˆ‘çš„**Hooks** å­¦ä¹ èµ„æ–™
- **å¼€å§‹**ï¼š`Hooks` äº§ç”Ÿçš„åŸå› å’Œäº§ç”ŸèƒŒæ™¯
- **Hooks Api**:
  - çŠ¶æ€é’©å­ï¼š`useState`ï¼Œ`useReducer`
  - å‰¯ä½œç”¨é’©å­ï¼š `useEffect`,`useLayoutEffect`
  - å…±äº«çŠ¶æ€é’©å­ï¼š `useCotext`
  - è®°å¿†å€¼é’©å­ï¼š `useMemo`
  - è®°å¿†å›è°ƒå‡½æ•°é’©å­ï¼š `useCallback`
  - ref é’©å­ï¼š `useRef`
  - ImperativeHandleé’©å­ï¼š`useImperativeHandle`
- **React Hooks in TypeScript**
- **React Hooks** **é€ è½®å­**
  - DOM å‰¯ä½œç”¨ä¿®æ”¹ / ç›‘å¬
  - ç»„ä»¶è¾…åŠ©
  - åŠ¨ç”»
  - è¯·æ±‚
  - è¡¨å•
  - æ¨¡æ‹Ÿç”Ÿå‘½å‘¨æœŸ
  - å­˜æ•°æ®
  - å°è£…åŸæœ‰åº“
- **React Hooks** **æºç **:å¾…ç»­

---

# èµ·æ­¥

## æˆ‘çš„ Hook å­¦ä¹ èµ„æ–™

##### Hooks Start

[React Hooks Tutorial](https://www.robinwieruch.de/react-hooks)

##### useState - useReducer

[how to useState in React](https://www.robinwieruch.de/react-usestate-hook/)

[useState - add-item-to-list](https://www.robinwieruch.de/react-add-item-to-list/)

[Remove an Item from a List in React](https://www.robinwieruch.de/react-remove-item-from-list/)

[How to update Item from a List in React](https://www.robinwieruch.de/react-hooks/)

#### useEffect - useLayoutEffect

[How to useEffect in React](https://www.robinwieruch.de/react-useeffect-hook/)

[How to fetchData in useEffect](https://www.robinwieruch.de/react-hooks-fetch-data/)

[A complete Guide to useEffect](https://overreacted.io/a-complete-guide-to-useeffect/)

[using the effect Hook](https://reactjs.org/docs/hooks-effect.html)

[React useLayoutEffect vs. useEffect with examples](https://blog.logrocket.com/useeffect-vs-uselayouteffect-examples/)

#### useContext

[How to use React Context](https://www.robinwieruch.de/react-context)

[How to useContext in React](https://www.robinwieruch.de/react-usecontext-hook/)

#### useMemo

[ã€è¯‘ã€‘ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ useMemo å’Œ useCallback](https://jancat.github.io/post/2019/translation-usememo-and-usecallback/#%E6%89%80%E4%BB%A5%E6%88%91%E5%BA%94%E8%AF%A5%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E4%BD%BF%E7%94%A8-usememo-%E5%92%8C-usecallback)

[docs useMemo](https://react.docschina.org/docs/hooks-reference.html#usememo)

#### useCallback

[ã€è¯‘ã€‘ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ useMemo å’Œ useCallback](https://jancat.github.io/post/2019/translation-usememo-and-usecallback/#%E6%89%80%E4%BB%A5%E6%88%91%E5%BA%94%E8%AF%A5%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E4%BD%BF%E7%94%A8-usememo-%E5%92%8C-usecallback)

[docs useCallback](https://react.docschina.org/docs/hooks-reference.html#usecallback)

[å¦‚ä½•éŒ¯èª¤åœ°ä½¿ç”¨ React hooks useCallback ä¾†ä¿å­˜ç›¸åŒçš„ function instance](https://jason-memo.dev/posts/how-to-use-react-hooks-useCallback-wrongly-for-keeping-same-function-instance/)

#### useRef

[How to use React Ref](https://www.robinwieruch.de/react-ref/)

[docs useRef](https://react.docschina.org/docs/hooks-reference.html#useref)

[React: Using Refs with the useRef Hook](https://medium.com/@rossbulat/react-using-refs-with-the-useref-hook-884ed25b5c29)

#### useImperativeHandle

[docs useImperativeHandle](https://react.docschina.org/docs/hooks-reference.html#useimperativehandle)

#### React Hooks in TypeScript

[React Hooks in TypeScript](https://medium.com/@jrwebdev/react-hooks-in-typescript-88fce7001d0d)

#### React Hooks é€ è½®å­

[react-use](https://github.com/streamich/react-use)

[ç²¾è¯»ã€Šæ€ä¹ˆç”¨ React Hooks é€ è½®å­ã€‹](https://github.com/ascoders/weekly/blob/v2/080.%E7%B2%BE%E8%AF%BB%E3%80%8A%E6%80%8E%E4%B9%88%E7%94%A8%20React%20Hooks%20%E9%80%A0%E8%BD%AE%E5%AD%90%E3%80%8B.md)

# å¼€å§‹

## Hooks äº§ç”Ÿçš„åŸå› ï¼ŒèƒŒæ™¯å’Œç›®çš„

### Hooks äº§ç”Ÿçš„èƒŒæ™¯å’Œç›®çš„

`React Hooks` æ˜¯åœ¨ `2018 å¹´ 10 æœˆ`çš„ `React Conf` ä¸Šå¼•å…¥çš„ï¼Œæ›¿æ¢åŸå…ˆç±»ç»„ä»¶çš„ä¹¦å†™æ–¹å¼ï¼Œä½¿å¾—å‡½æ•°å¼ç»„ä»¶æ”¯æŒ `state` å’Œ `side-effects`ã€‚`React-Hooks` ä¹‹å‰çš„å‡½æ•°å¼ç»„ä»¶æ˜¯æ— çŠ¶æ€ç»„ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¯´ `React-Hooks` å°±æ˜¯å¢å¼ºçš„å‡½æ•°å¼ç»„ä»¶ï¼Œæ”¯æŒçŠ¶æ€å’Œå‰¯ä½œç”¨çš„å…¨åŠŸèƒ½ç»„ä»¶ã€‚

### Hooks äº§ç”Ÿçš„åŸå› 

- å‡½æ•°å¼ç»„ä»¶æ›´åŠ ä¼˜é›…ï¼Œæ›´åŠ è½»é‡çº§ï¼Œé€šè¿‡ä¸€ä¸ªå°è®¡æ•°å™¨ `demo` å°±å¯ä»¥å‘ç°ã€‚å‰è€…æ˜¯ Hooks ä¹‹å‰çš„ç±»ç»„ä»¶ï¼Œåè€…å¼å‡½æ•°å¼ç»„ä»¶

```javascript
// Hooksä¹‹å‰çš„ç±»ç»„ä»¶
import React, { Component } from "react";

class Counter extends Component {
  constructor(props) {
    super(props);

    this.state = {
      count: 0,
    };
  }

  render() {
    return (
      <div>
        <p>You clicked {this.state.count} times</p>
        <button onClick={() => this.setState({ count: this.state.count + 1 })}>
          Click me
        </button>
      </div>
    );
  }
}

export default Counter;
```

```javascript
// Hooks
import React from "react";
function Counter() {
  const [count, setCount] = React.useState(0);

  return (
    <div>
      <p>You clicked {count} times</p>
      <button onClick={() => setCount(count + 1)}>Click me</button>
    </div>
  );
}

export default Counter;
```

- `React` å¼€å‘äººå‘˜çš„å­¦ä¹ æ›²çº¿ä¸ä¼šå¾ˆé™¡å³­ï¼Œåªéœ€è¦çŸ¥æ™“ `state, side-effects` æ¦‚å¿µå°±å¯ä»¥ï¼Œä¸éœ€è¦åœ¨åƒå­¦ä¹ ç±»ç»„ä»¶çš„æ—¶å€™ï¼Œéœ€è¦çŸ¥é“ `Class, this ç»‘å®š,super,state, setState, render` å‡½æ•°ï¼Œç”Ÿå‘½å‘¨æœŸã€‚åŸºæœ¬æ¶ˆé™¤äº†å¸¦ç»™` React` åˆå­¦è€…çš„æŒ«è´¥æ„Ÿã€‚

- åƒ `React æ ¸å¿ƒæˆå‘˜`è¯´çš„é‚£æ ·ï¼Œ`Hooks` æ¶ˆé™¤äº† `wrapper hell` - åŒ…è£…åœ°ç‹±ï¼Œæˆ‘å°±é‡åˆ°è¿‡è¿™ç§åŒ…è£…åœ°ç‹±åœºæ™¯ï¼šå½“æ—¶çš„æƒ…å†µæ˜¯ä¸€ä¸ªç±»ç»„ä»¶ï¼ŒåŒ…è£…äº† `redux` æä¾›çš„ `connect`å‡½æ•°,åŒ…è£…å›½é™…åŒ–åº“æä¾›çš„ `Api`å‡½æ•°ï¼ŒåŒ…è£…è‡ªå·±å°è£…çš„é«˜é˜¶ç»„ä»¶å‡½æ•°ï¼Œè¿˜åŒ…è£…äº†`withRouter`å‡½æ•°ã€‚è¿™ç§ä»£ç å¯è¯»æ€§æå·®ï¼Œå±‚çº§åµŒå¥—çš„ä»£ç åƒä¸ªæ€ªç‰©ã€‚
## useState

---

### åŸºæœ¬ä»‹ç»

ä¸ºå‡½æ•°ç»„ä»¶å¼•å…¥ `state`,ä»¥åŠæ›´æ–°`state` çš„ `setState` å‡½æ•°ã€‚

> Tips:ä¸ `class` ç»„ä»¶å½“ä¸­ `setState` ä¸åŒï¼Œ`Hook` çš„`setState`ä¸ä¼šè‡ªåŠ¨åˆå¹¶æ›´æ–°å¯¹è±¡ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼šä½¿ç”¨å±•å¼€è¿ç®—ç¬¦ï¼Œç»“åˆ `Hook` çš„ `setState` æ¥è¾¾åˆ°æ›´æ–°å¯¹è±¡çš„ç›®çš„ã€‚

---

### åŸºæœ¬ä½¿ç”¨

- ä¼ å…¥åˆå§‹çŠ¶æ€ï¼Œè¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„çš„ç¬¬ä¸€ä¸ªæˆå‘˜æ˜¯ `state`ï¼Œç¬¬äºŒä¸ªæˆå‘˜æ˜¯æ”¹å˜ `state` çš„å‡½æ•°ã€‚

---

#### useState ç»ƒä¹ :æ­Œæ›²çš„å¢åˆ æ”¹

```javascript
import { useState } from "react";
const InitialData = [{ name: "æ­Œå1", id: 1, isComplete: false }];

export const HookUseStateCpn = () => {
  const [songState, setSongState] = useState(InitialData);
  const [songName, setSongName] = useState("");
  const setName = (e) => {
    setSongName(e.target.value);
  };
  /**
   * æ·»åŠ æ­Œæ›²å¤„ç†
   */
  const handleAddSong = () => {
    const newData = songState.concat({
      name: songName,
      id: songState.length + 1,
      isComplete: false,
    });
    setSongState(newData);
    setSongName("");
  };
  /**
   * åˆ é™¤æ­Œæ›²å¤„ç†
   * @param {*} id æ­Œæ›² id
   */
  const handleDeleteSong = (id) => {
    const newData = songState.filter((item) => item.id !== id);
    setSongState(newData);
  };
  /**
   * ç¼–è¾‘æ­Œæ›²å¤„ç†
   * @param {*} id æ­Œæ›²id
   */
  const handleEditSong = (id) => {
    const newData = songState.map((item, index) => {
      if (item.id === id) item.isComplete = !item.isComplete;
      return item;
    });
    setSongState(newData);
  };
  return (
    <>
      <List
        songState={songState}
        handleDeleteSong={handleDeleteSong}
        handleEditSong={handleEditSong}
      />
      <AddItem
        setName={setName}
        handleAddSong={handleAddSong}
        songName={songName}
      />
    </>
  );
};

// å­ç»„ä»¶ AddItem
const AddItem = ({ setName, handleAddSong, songName }) => {
  return (
    <>
      <input onChange={(e) => setName(e)} value={songName}></input>
      <button onClick={(e) => handleAddSong(e)}>æ·»åŠ </button>
    </>
  );
};

// å­ç»„ä»¶ List
const List = ({ songState, handleDeleteSong, handleEditSong }) => {
  return (
    <>
      <h1>æœ€å–œæ¬¢çš„æ­Œ</h1>
      {songState.map((song) => {
        return (
          <div key={song.id}>
            <h4
              style={{
                textDecoration: song.isComplete ? "line-through" : "none",
              }}
            >
              {song.name} -- {song.id}{" "}
              <button onClick={() => handleEditSong(song.id)}>
                {song.isComplete ? "æ’¤é”€å®Œæˆ" : "å®Œæˆ"}
              </button>
              <button onClick={() => handleDeleteSong(song.id)}>åˆ é™¤</button>
            </h4>
          </div>
        );
      })}
    </>
  );
};
```

---

## useReducer

---

### åŸºæœ¬ä»‹ç»

æˆ‘ä»¬è¯´ï¼Œ`useState` ä¸º `React-Hooks` å¼•å…¥äº†çŠ¶æ€ç®¡ç†ï¼Œ`useReducer` çš„ä½œç”¨ä¹Ÿæ˜¯ä¸º `React-Hooks` æä¾›äº†çŠ¶æ€ç®¡ç†ã€‚`useReducer` æ˜¯ `useState` çš„å¢å¼ºå’Œæ›¿ä»£ APIï¼Œ`useReducer` ç”¨äºå¤æ‚çŠ¶æ€ç®¡ç†å’Œæ€§èƒ½ä¼˜åŒ–, æ€§èƒ½ä¼˜åŒ–æ˜¯å› ä¸ºå®ƒå¯ä»¥å€ŸåŠ© `Context API` ä¼ é€’ `dispatch` å‡½æ•°ç»™å­ç»„ä»¶ï¼Œç”±äº`dispatch` å‡½æ•°å§‹ç»ˆä¸å˜ï¼Œæ‰€ä»¥å­ç»„ä»¶ä¸ä¼šé‡æ–°æ¸²æŸ“ã€‚

> Tips:å¯¹äºä½¿ç”¨æˆ–è€…æŒæ¡äº† `Redux` çš„å¼€å‘è€…æ¥è®²ï¼Œ`useReducer` ä½¿ç”¨èµ·æ¥ä¼šå¾ˆé¡ºæ‰‹ã€‚å› ä¸ºå…¶ä¸­åƒï¼š`store`ï¼Œ`reducer`,`state`,`dispatch`,`action`çš„æ¦‚å¿µå·²ç»æŒæ¡å’Œäº†è§£äº†ã€‚çŸ¥é“ `store` çš„æ›´æ–°æµç¨‹æ˜¯æ€ä¹ˆæ ·çš„ï¼Œä½¿ç”¨ `useReducer` è‡ªç„¶ä¼šæ›´åŠ é¡ºæ‰‹ä¸€äº›

---

### åŸºæœ¬ä½¿ç”¨

```javascript
import { useReducer, useState } from "react";
const InitialData = [{ name: "æ­Œå1", id: 1, isComplete: false }];
const SongReducer = (state, action) => {
  const id = action?.payload?.id;
  switch (action.type) {
    case "ADD_SONG":
      return [...state, { name: action.payload.name, id, isComplete: false }];
    case "DELETE_SONG":
      return state.filter((item) => {
        return item.id !== id;
      });
    case "EDIT_SONG":
      return state.map((item) => {
        if (item.id === id) {
          const updateItem = {
            ...item,
            isComplete: !action.payload.isComplete,
          };
          return updateItem;
        }
        return item;
      });
    default:
      return new Error();
  }
};
export const HookUseReducerCpn = () => {
  const [songReducerState, dispatchSongData] = useReducer(
    SongReducer,
    InitialData
  );
  const [songName, setSongName] = useState("");
  const setName = (e) => {
    setSongName(e.target.value);
  };
  /**
   * æ·»åŠ æ­Œæ›²å¤„ç†
   */
  const handleAddSong = () => {
    dispatchSongData({
      type: "ADD_SONG",
      payload: { name: songName, id: songReducerState.length + 1 },
    });
    setSongName("");
  };
  /**
   * åˆ é™¤æ­Œæ›²å¤„ç†
   * @param {*} id æ­Œæ›² id
   */
  const handleDeleteSong = (id) => {
    dispatchSongData({ type: "DELETE_SONG", payload: { id } });
  };
  /**
   * ç¼–è¾‘æ­Œæ›²å¤„ç†
   * @param {*} id æ­Œæ›²id
   */
  const handleEditSong = (id, isComplete) => {
    dispatchSongData({ type: "EDIT_SONG", payload: { id, isComplete } });
  };
  return (
    <>
      <List
        songState={songReducerState}
        handleDeleteSong={handleDeleteSong}
        handleEditSong={handleEditSong}
      />
      <AddItem
        setName={setName}
        handleAddSong={handleAddSong}
        songName={songName}
      />
    </>
  );
};
const AddItem = ({ setName, handleAddSong, songName }) => {
  return (
    <>
      <input onChange={(e) => setName(e)} value={songName}></input>
      <button onClick={(e) => handleAddSong(e)}>æ·»åŠ </button>
    </>
  );
};
const List = ({ songState, handleDeleteSong, handleEditSong }) => {
  return (
    <>
      <h1>æœ€å–œæ¬¢çš„æ­Œ</h1>
      {songState.map((song) => {
        return (
          <div key={song.id}>
            <h4
              style={{
                textDecoration: song.isComplete ? "line-through" : "none",
              }}
            >
              {song.name} -- {song.id}{" "}
              <button onClick={() => handleEditSong(song.id, song.isComplete)}>
                {song.isComplete ? "æ’¤é”€å®Œæˆ" : "å®Œæˆ"}
              </button>
              <button onClick={() => handleDeleteSong(song.id)}>åˆ é™¤</button>
            </h4>
          </div>
        );
      })}
    </>
  );
};
```
## useEffect

---

### åŸºæœ¬ä»‹ç»

- `useEffect` ä¸º `React` å¼•å…¥äº†å‰¯ä½œç”¨å‡½æ•°ï¼Œä½ å¯ä»¥ä½¿ç”¨ `useEffect` å„ç§ç”¨æ³•æ¥å†³å®šï¼Œå‰¯ä½œç”¨å‡½æ•°åœ¨ç»„ä»¶æŒ‚è½½æ—¶ï¼Œç»„ä»¶æ¸²æŸ“æ—¶è¿˜æ˜¯åœ¨ç»„ä»¶æ›´æ–°æ¸²æŸ“æ—¶è¿è¡Œï¼Œä½ å¯ä»¥åœ¨å‰¯ä½œç”¨å‡½æ•°å½“ä¸­ï¼Œè¿›è¡Œ `mutations` ï¼ˆçŠ¶æ€æ”¹å˜ï¼‰, `subscriptions`ï¼ˆæ·»åŠ è®¢é˜…ï¼‰, `timers`(è®¾ç½®å®šæ—¶å™¨),`logging`ï¼ˆæ·»åŠ æ—¥å¿—ï¼‰,`fetch data`ï¼ˆç½‘ç»œè¯·æ±‚ï¼‰ã€‚

##### æ¯ä¸€æ¬¡ç»„ä»¶çš„æ¸²æŸ“éƒ½æœ‰å¯¹åº”è¿™ä¸€æ¬¡æ¸²æŸ“ `state` å’Œ `props`

åœ¨å¼€å§‹èŠ `useEffect` ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥èŠä¸€èŠç»„ä»¶çš„æ¸²æŸ“ï¼Œæˆ‘ä»¬é¦–å…ˆè¦æ˜ç¡®ï¼Œæ¯ä¸€æ¬¡ç»„ä»¶çš„æ¸²æŸ“éƒ½æœ‰å¯¹åº”è¿™ä¸€æ¬¡ `state` å’Œ `props`,é€šè¿‡ä¸‹é¢çš„å®šæ—¶å™¨æ¡ˆä¾‹ï¼Œä½ ä¼šå¯¹æ­¤æœ‰æ›´æ·±çš„äº†è§£ã€‚

```javascript
// è¿™æ˜¯ä¸€ä¸ªç®€å•çš„è®¡æ•°å™¨æ¡ˆä¾‹
function Counter() {
  const [count, setCount] = useState(0);

  return (
    <div>
      <p>You clicked {count} times</p>
      <button onClick={() => setCount(count + 1)}>Click me</button>
    </div>
  );
}
```

å½“æˆ‘ä»¬ç‚¹å‡»æŒ‰é’®æ”¹å˜ç»„ä»¶çŠ¶æ€çš„æ—¶å€™ï¼Œ`React` ä¼šé‡æ–°æ¸²æŸ“ç»„ä»¶ï¼Œæ¯ä¸€æ¬¡æ¸²æŸ“éƒ½ä¼šé‡æ–°åˆ›å»ºç»„ä»¶å‡½æ•°ï¼Œæ‹¿åˆ°å±äºæœ¬æ¬¡çš„ `count` çŠ¶æ€ï¼Œæ‰€ä»¥è¿™ä¸ª `count` å€¼åªæ˜¯å‡½æ•°ä½œç”¨åŸŸå½“ä¸­çš„ä¸€ä¸ªå¸¸é‡ã€‚é€šè¿‡ä¸‹é¢çš„ä»£ç ï¼Œä½ ä¼šå¯¹æ­¤æœ‰æ›´åŠ æ·±å…¥çš„äº†è§£ã€‚

```javascript
// During first render
function Counter() {
  const count = 0; // Returned by useState()
  // ...
  <p>You clicked {count} times</p>;
  // ...
}

// After a click, our function is called again
function Counter() {
  const count = 1; // Returned by useState()
  // ...
  <p>You clicked {count} times</p>;
  // ...
}

// After another click, our function is called again
function Counter() {
  const count = 2; // Returned by useState()
  // ...
  <p>You clicked {count} times</p>;
  // ...
}
```

æ‰€ä»¥è®¡æ•°å™¨æ¡ˆä¾‹ä¸­çš„ `count` æ²¡æœ‰ä»€ä¹ˆé­”æ³•ï¼ˆmagicï¼‰ï¼Œåªæ˜¯ä¸€ä¸ªå¸¸é‡ï¼Œä¹Ÿæ²¡æœ‰åƒ `vue` å½“ä¸­çš„ `watcher`ï¼Œ`proxy`ï¼Œæˆ–è€…æ˜¯ `databinding`ã€‚

##### æ¯ä¸€æ¬¡ç»„ä»¶æ¸²æŸ“ï¼Œéƒ½æœ‰å¯¹åº”è¿™ä¸€æ¬¡æ¸²æŸ“çš„äº‹ä»¶å¤„ç†å‡½æ•°

æˆ‘ä»¬æ˜ç¡®äº†æ¯ä¸€æ¬¡ç»„ä»¶çš„æ¸²æŸ“éƒ½æœ‰å¯¹åº”è¿™ä¸€æ¬¡ `state` å’Œ `props`ä¹‹åï¼Œç¬¬äºŒä¸ªè¦æ˜ç¡®çš„æ˜¯æ¯ä¸€æ¬¡ç»„ä»¶æ¸²æŸ“ï¼Œéƒ½æœ‰å¯¹åº”è¿™ä¸€æ¬¡çš„äº‹ä»¶å¤„ç†å‡½æ•°ã€‚é€šè¿‡ä¸‹é¢çš„æ¡ˆä¾‹ï¼Œä½ ä¼šå¯¹æ­¤æœ‰æ›´æ·±çš„äº†è§£ã€‚

```javascript
function Counter() {
  const [count, setCount] = useState(0);

  function handleAlertClick() {
    setTimeout(() => {
      alert("You clicked on: " + count);
    }, 3000);
  }

  return (
    <div>
      <p>You clicked {count} times</p>
      <button onClick={() => setCount(count + 1)}>Click me</button>
      <button onClick={handleAlertClick}>Show alert</button>
    </div>
  );
}
```

- ç‚¹å‡»å¢åŠ  `counter` åˆ° 3
- ç‚¹å‡»ä¸€ä¸‹ `â€œShow alertâ€`
- ç‚¹å‡»å¢åŠ  `counter` åˆ° 5 å¹¶ä¸”åœ¨å®šæ—¶å™¨å›è°ƒè§¦å‘å‰å®Œæˆ

æœ€åçš„ç»“æœç«Ÿç„¶æ˜¯ 3 è€Œä¸æ˜¯ 5ï¼Œä¸‹é¢çš„ä»£ç ä¼šè®©ä½ æœ‰æ›´åŠ æ·±åˆ»çš„äº†è§£ã€‚

```javascript
// During first render
function Counter() {
  const count = 0; // Returned by useState()
  // ...
  function handleAlertClick() {
    setTimeout(() => {
      alert("You clicked on: " + count);
    }, 3000);
  }
  // ...
}

// After a click, our function is called again
function Counter() {
  const count = 1; // Returned by useState()
  // ...
  function handleAlertClick() {
    setTimeout(() => {
      alert("You clicked on: " + count);
    }, 3000);
  }
  // ...
}

// After another click, our function is called again
function Counter() {
  const count = 2; // Returned by useState()
  // ...
  function handleAlertClick() {
    setTimeout(() => {
      alert("You clicked on: " + count);
    }, 3000);
  }
  // ...
}
```

æ‰€ä»¥å®é™…ä¸Šï¼Œæ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰ä¸€ä¸ª`â€œæ–°ç‰ˆæœ¬â€`çš„ `handleAlertClick(äº‹ä»¶å¤„ç†å‡½æ•°)`ã€‚æ¯ä¸€ä¸ªç‰ˆæœ¬çš„ `handleAlertClickï¼ˆäº‹ä»¶å¤„ç†å‡½æ•°ï¼‰`â€œè®°ä½â€ äº†å®ƒè‡ªå·±æœ¬æ¬¡å¯¹åº”çš„ `count`ï¼š

##### æ¯ä¸€æ¬¡ç»„ä»¶æ¸²æŸ“éƒ½æœ‰å¯¹åº”è¿™ä¸€æ¬¡æ¸²æŸ“çš„ Effects

è¿™æ˜¯ä¸€ä¸ªç®€å•çš„ `useEffect` æ¡ˆä¾‹

```javascript
function Counter() {
  const [count, setCount] = useState(0);

  useEffect(() => {
    document.title = `You clicked ${count} times`;
  });

  return (
    <div>
      <p>You clicked {count} times</p>
      <button onClick={() => setCount(count + 1)}>Click me</button>
    </div>
  );
}
```

æ¯ä¸€æ¬¡ç»„ä»¶çš„æ¸²æŸ“ï¼Œéƒ½æœ‰å¯¹åº”è¿™ä¸€æ¬¡æ¸²æŸ“çš„ `Effects` ï¼Œä¸‹é¢çš„ä»£ç ä¼šè®©ä½ æœ‰æ›´åŠ æ·±åˆ»çš„äº†è§£

```javascript
// During first render
function Counter() {
  // ...
  useEffect(
    // Effect function from first render
    () => {
      document.title = `You clicked ${0} times`;
    }
  );
  // ...
}

// After a click, our function is called again
function Counter() {
  // ...
  useEffect(
    // Effect function from second render
    () => {
      document.title = `You clicked ${1} times`;
    }
  );
  // ...
}

// After another click, our function is called again
function Counter() {
  // ...
  useEffect(
    // Effect function from third render
    () => {
      document.title = `You clicked ${2} times`;
    }
  );
  // ..
}
```

`React` ä¼šè®°ä½ä½ æä¾›çš„ `effects` å‡½æ•°ï¼Œç­‰å¾…æ¯æ¬¡ `React` å°† `DOM` æ›´æ–°æ¸²æŸ“ç»˜åˆ¶åˆ° `screen` ä¸Šä¹‹åå»è°ƒç”¨ `effects` å‡½æ•°ï¼Œæœ¬è´¨ä¸Šï¼Œ`effects` å‡½æ•°æ¯æ¬¡â€œçœ‹åˆ°çš„â€éƒ½æ˜¯å¯¹åº”é‚£ä¸€æ¬¡æ¸²æŸ“çš„ `state` å’Œ `props`.

##### useEffect è¿”å›çš„æ¸…ç†å‡½æ•°æ˜¯æ€ä¹ˆå›äº‹

```javascript
useEffect(() => {
  ChatAPI.subscribeToFriendStatus(props.id, handleStatusChange);
  return () => {
    ChatAPI.unsubscribeFromFriendStatus(props.id, handleStatusChange);
  };
});
```

å‡è®¾ç¬¬ä¸€æ¬¡æ¸²æŸ“çš„æ—¶å€™ props æ˜¯{id: 10}ï¼Œç¬¬äºŒæ¬¡æ¸²æŸ“çš„æ—¶å€™æ˜¯{id: 20}

- ä¼šå‘ç”Ÿä¸‹é¢çš„äº‹æƒ…:
  - React æ¸²æŸ“{id: 20}çš„ UIã€‚
  - æµè§ˆå™¨ç»˜åˆ¶ã€‚æˆ‘ä»¬åœ¨å±å¹•ä¸Šçœ‹åˆ°{id: 20}çš„ UIã€‚
  - React æ¸…é™¤{id: 10}çš„ effectã€‚
  - React è¿è¡Œ{id: 20}çš„ effectã€‚

##### å‘ useEffects ä¸­ä¼ é€’ä¾èµ–

ä¸Šæ–¹çš„ useEffect æ¡ˆä¾‹,åªæœ‰ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°,è¿™æ ·çš„ç»“æœæ˜¯åœ¨ç»„ä»¶æ¯æ¬¡æ¸²æŸ“æ—¶éƒ½ä¼šè°ƒç”¨ effects å‡½æ•°,è¿™æ ·å¹¶ä¸é«˜æ•ˆ,è¿˜æ—¶å¸¸å¯¼è‡´æ— é™æ¸²æŸ“é—®é¢˜,æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¼ é€’ç¬¬äºŒå‚æ•°æ¥è§£å†³é—®é¢˜,ç¬¬äºŒå‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„ä¾èµ–é¡¹,åªæœ‰å½“ä¾èµ–é¡¹å‘ç”Ÿå˜åŒ–æ—¶, æ‰ä¼šè°ƒç”¨ effects å‡½æ•°.

```javascript
useEffect(() => {
  document.title = "Hello, " + name;
}, [name]); // Our deps
```

åªæœ‰å½“ name å‘ç”Ÿå˜åŒ–æ—¶æ‰ä¼šè°ƒç”¨ effects å‡½æ•°.

##### å‡å°‘ useEffects å½“ä¸­çš„ä¾èµ–æ€§æ¥è¾¾åˆ°æ€§èƒ½ä¼˜åŒ–

```javascript
useEffect(() => {
  const id = setInterval(() => {
    setCount(count + 1);
  }, 1000);
  return () => clearInterval(id);
}, [count]);
```

ç°åœ¨ä¾èµ–æ•°ç»„æ­£ç¡®äº†ã€‚è™½ç„¶å®ƒå¯èƒ½ä¸æ˜¯å¤ªç†æƒ³ä½†ç¡®å®è§£å†³äº†ä¸Šé¢çš„é—®é¢˜ã€‚ç°åœ¨ï¼Œæ¯æ¬¡ count ä¿®æ”¹éƒ½ä¼šé‡æ–°è¿è¡Œ effectï¼Œå¹¶ä¸”å®šæ—¶å™¨ä¸­çš„ setCount(count + 1)ä¼šæ­£ç¡®å¼•ç”¨æŸæ¬¡æ¸²æŸ“ä¸­çš„ count å€¼ï¼š

```javascript
// First render, state is 0
function Counter() {
  // ...
  useEffect(
    // Effect from first render
    () => {
      const id = setInterval(() => {
        setCount(0 + 1); // setCount(count + 1)
      }, 1000);
      return () => clearInterval(id);
    },
    [0] // [count]
  );
  // ...
}

// Second render, state is 1
function Counter() {
  // ...
  useEffect(
    // Effect from second render
    () => {
      const id = setInterval(() => {
        setCount(1 + 1); // setCount(count + 1)
      }, 1000);
      return () => clearInterval(id);
    },
    [1] // [count]
  );
  // ...
}
```

è¿™èƒ½è§£å†³é—®é¢˜ä½†æ˜¯æˆ‘ä»¬çš„å®šæ—¶å™¨ä¼šåœ¨æ¯ä¸€æ¬¡ count æ”¹å˜åæ¸…é™¤å’Œé‡æ–°è®¾å®šã€‚è¿™åº”è¯¥ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœ.æ‰€ä»¥æˆ‘ä»¬éœ€è¦å‡å°‘ä¾èµ–é¡¹çš„åŒæ—¶,æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚.

###### å‡å°‘ä¾èµ–æ–¹æ¡ˆä¸€:seState çš„ updater function

```javascript
useEffect(() => {
  const id = setInterval(() => {
    setCount((c) => c + 1);
  }, 1000);
  return () => clearInterval(id);
}, []);
```

###### å‡å°‘ä¾èµ–æ–¹æ¡ˆäºŒ:useReducer çš„ dispatch function

```javascript
function Counter({ step }) {
  const [count, dispatch] = useReducer(reducer, 0);

  function reducer(state, action) {
    if (action.type === "tick") {
      return state + step;
    } else {
      throw new Error();
    }
  }

  useEffect(() => {
    const id = setInterval(() => {
      dispatch({ type: "tick" });
    }, 1000);
    return () => clearInterval(id);
  }, [dispatch]);

  return <h1>{count}</h1>;
}
```

###### å‡å°‘ä¾èµ–æ–¹æ¡ˆä¸‰:å°†å‡½æ•°å®šä¹‰åˆ° effects å‡½æ•°å½“ä¸­

```javascript
function SearchResults() {
  // ...
  useEffect(() => {
    // We moved these functions inside!
    function getFetchUrl() {
      return "https://hn.algolia.com/api/v1/search?query=react";
    }
    async function fetchData() {
      const result = await axios(getFetchUrl());
      setData(result.data);
    }

    fetchData();
  }, []); // âœ… Deps are OK
  // ...
}
```

###### å‡å°‘ä¾èµ–æ–¹æ¡ˆå››:å°†å‡½æ•°å®šä¹‰åˆ° effects å‡½æ•°å¤–é¢

é’ˆå¯¹äºç¬¬ä¸‰ç§è§£å†³æ–¹æ¡ˆ,ç¼ºç‚¹æ˜¯ä¸èƒ½å¤ç”¨ getFetchUrl å‡½æ•°,å¦‚æœå¤šä¸ªåœ°æ–¹åŒæ—¶ä½¿ç”¨åˆ°äº†è¯¥å‡½æ•°,åªèƒ½æ¯æ¬¡éƒ½é‡æ–°å®šä¹‰.

```javascript
function SearchResults() {
  // ğŸ”´ Re-triggers all effects on every render
  function getFetchUrl(query) {
    return "https://hn.algolia.com/api/v1/search?query=" + query;
  }

  useEffect(() => {
    const url = getFetchUrl("react");
    // ... Fetch data and do something ...
  }, [getFetchUrl]); // ğŸš§ Deps are correct but they change too often

  useEffect(() => {
    const url = getFetchUrl("redux");
    // ... Fetch data and do something ...
  }, [getFetchUrl]); // ğŸš§ Deps are correct but they change too often

  // ...
}
```

ä¸¤ä¸ªæ›´ç®€å•çš„è§£å†³åŠæ³•:

- å¦‚æœè¯¥å‡½æ•°æ²¡æœ‰ä¾èµ–ä»»ä½•ç»„ä»¶çŠ¶æ€,æ”¾åˆ°ç»„ä»¶çš„å¤–é¢å½“ä¸­å».

```javascript
// âœ… Not affected by the data flow
function getFetchUrl(query) {
  return "https://hn.algolia.com/api/v1/search?query=" + query;
}

function SearchResults() {
  useEffect(() => {
    const url = getFetchUrl("react");
    // ... Fetch data and do something ...
  }, []); // âœ… Deps are OK

  useEffect(() => {
    const url = getFetchUrl("redux");
    // ... Fetch data and do something ...
  }, []); // âœ… Deps are OK

  // ...
}
```

- å¦‚æœè¯¥å‡½æ•°ä¾èµ–äº†ç»„ä»¶çŠ¶æ€,é‚£å°±æ”¾åœ¨ç»„ä»¶å½“ä¸­,ä½¿ç”¨ callback è¿›è¡ŒåŒ…è£¹.

```javascript
function SearchResults() {
  // âœ… Preserves identity when its own deps are the same
  const getFetchUrl = useCallback((query) => {
    return "https://hn.algolia.com/api/v1/search?query=" + query;
  }, []); // âœ… Callback deps are OK

  useEffect(() => {
    const url = getFetchUrl("react");
    // ... Fetch data and do something ...
  }, [getFetchUrl]); // âœ… Effect deps are OK

  useEffect(() => {
    const url = getFetchUrl("redux");
    // ... Fetch data and do something ...
  }, [getFetchUrl]); // âœ… Effect deps are OK

  // ...
}
```

### åŸºæœ¬ä½¿ç”¨

---

#### å‘æœåŠ¡å™¨è¯·æ±‚æ•°æ®ï¼ˆfetch dataï¼‰ - useState

```javascript
const useDataApi = (initialUrl, initialData) => {
  const [data, setData] = useState(initialData);
  const [url, setUrl] = useState(initialUrl);
  const [isLoading, setIsLoading] = useState(false);
  const [isError, setIsError] = useState(false);

  useEffect(() => {
    const fetchData = async () => {
      setIsError(false);
      setIsLoading(true);

      try {
        const result = await axios(url);

        setData(result.data);
      } catch (error) {
        setIsError(true);
      }

      setIsLoading(false);
    };

    fetchData();
  }, [url]);

  return [{ data, isLoading, isError }, setUrl];
};
```

#### å‘æœåŠ¡å™¨è¯·æ±‚æ•°æ®ï¼ˆfetch dataï¼‰ - useReducer

```javascript
const dataFetchReducer = (state, action) => {
  switch (action.type) {
    case "FETCH_INIT":
      return {
        ...state,
        isLoading: true,
        isError: false,
      };
    case "FETCH_SUCCESS":
      return {
        ...state,
        isLoading: false,
        isError: false,
        data: action.payload,
      };
    case "FETCH_FAILURE":
      return {
        ...state,
        isLoading: false,
        isError: true,
      };
    default:
      throw new Error();
  }
};
const useDataApi = (initialUrl, initialData) => {
  const [url, setUrl] = useState(initialUrl);

  const [state, dispatch] = useReducer(dataFetchReducer, {
    isLoading: false,
    isError: false,
    data: initialData,
  });

  useEffect(() => {
    let didCancel = false;

    const fetchData = async () => {
      dispatch({ type: "FETCH_INIT" });

      try {
        const result = await axios(url);

        if (!didCancel) {
          dispatch({ type: "FETCH_SUCCESS", payload: result.data });
        }
      } catch (error) {
        if (!didCancel) {
          dispatch({ type: "FETCH_FAILURE" });
        }
      }
    };

    fetchData();

    return () => {
      didCancel = true;
    };
  }, [url]);

  return [state, setUrl];
};
```

#### useEffects: ç¬¬ä¸€æ¬¡æ¸²æŸ“ï¼ˆæŒ‚è½½ï¼‰åå’Œæ¯ä¸€æ¬¡çš„ç»„ä»¶æ›´æ–°éƒ½ä¼šæ‰§è¡Œ

> -- meaning it runs on the first render of the component (also called on mount or mounting of the component) and on every re-render of the component (also called on update or updating of the component).

```javascript
const Toggler = ({ toggle, onToggle }) => {
  React.useEffect(() => {
    console.log("I run on every render: mount + update.");
  });

  return (
    <div>
      <button type="button" onClick={onToggle}>
        Toggle
      </button>

      {toggle && <div>Hello React</div>}
    </div>
  );
};
```

#### useEffectï¼šåªæœ‰åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“ï¼ˆæŒ‚è½½ï¼‰åæ‰§è¡Œ

> If the dependency array is empty, the side-effect function used in React's useEffect Hook has no dependencies, meaning it runs only the first time a component renders(mount).

```javascript
const Toggler = ({ toggle, onToggle }) => {
  React.useEffect(() => {
    console.log("I run only on the first render: mount.");
  }, []);

  return (
    <div>
      <button type="button" onClick={onToggle}>
        Toggle
      </button>

      {toggle && <div>Hello React</div>}
    </div>
  );
};
```

#### useEffect: ç»„ä»¶æ›´æ–°çš„æ—¶å€™æ‰§è¡Œï¼ŒåŒ…æ‹¬ç¬¬ä¸€æ¬¡æ¸²æŸ“ï¼ˆæŒ‚è½½ï¼‰

> Now the side-effect function for this React component runs only when the variable in the dependency array changes. However, note that the function runs also on the component's first render (mount).

```javascript
const Toggler = ({ toggle, onToggle }) => {
  const [title, setTitle] = React.useState("Hello React");

  React.useEffect(() => {
    console.log("I run if toggle or title change (and on mount).");
  }, [toggle, title]);

  const handleChange = (event) => {
    setTitle(event.target.value);
  };

  return (
    <div>
      <input type="text" value={title} onChange={handleChange} />

      <button type="button" onClick={onToggle}>
        Toggle
      </button>

      {toggle && <div>{title}</div>}
    </div>
  );
};
```

#### useEffect: åªåœ¨ç»„ä»¶æ›´æ–°çš„æ—¶å€™æ‰§è¡Œï¼Œç¬¬ä¸€æ¬¡æ¸²æŸ“ï¼ˆæŒ‚è½½ï¼‰ä¸æ‰§è¡Œ

```javascript
const Toggler = ({ toggle, onToggle }) => {
  const didMount = React.useRef(false);

  React.useEffect(() => {
    if (didMount.current) {
      console.log("I run only if toggle changes.");
    } else {
      didMount.current = true;
    }
  }, [toggle]);

  return (
    <div>
      <button type="button" onClick={onToggle}>
        Toggle
      </button>

      {toggle && <div>Hello React</div>}
    </div>
  );
};
```

#### useEffect: åªåœ¨ç»„ä»¶æ›´æ–°çš„æ—¶å€™æ‰§è¡Œä¸€æ¬¡ï¼Œç¬¬ä¸€æ¬¡æ¸²æŸ“ï¼ˆæŒ‚è½½ï¼‰ä¸æ‰§è¡Œ

```javascript
const Toggler = ({ toggle, onToggle }) => {
  const calledOnce = React.useRef(false);

  React.useEffect(() => {
    if (calledOnce.current) {
      return;
    }

    if (toggle === false) {
      console.log("I run only once if toggle is false.");

      calledOnce.current = true;
    }
  }, [toggle]);

  return (
    <div>
      <button type="button" onClick={onToggle}>
        Toggle
      </button>

      {toggle && <div>Hello React</div>}
    </div>
  );
};
```

#### useEffect: æ¸…ç†å›è°ƒå‡½æ•°

```javascript
import * as React from "react";

const App = () => {
  const [timer, setTimer] = React.useState(0);

  React.useEffect(() => {
    const interval = setInterval(() => setTimer(timer + 1), 1000);

    return () => clearInterval(interval);
  }, [timer]);

  return <div>{timer}</div>;
};

export default App;
```

## useLayoutEffect

### åŸºæœ¬ä»‹ç»

`useLayoutEffect` å’Œ `useEffect` æœ‰ç€ä¸€æ ·çš„å‡½æ•°ç­¾å,ä¸¤è€…åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹å¯ä»¥ç›¸äº’æ›¿æ¢,`useLayoutEffect` å’Œ `useEffect`çš„æœ¬è´¨åŒºåˆ«æ˜¯è§¦å‘æ—¶æœºçš„ä¸ä¸€è‡´,`useEffect` å‘ç”Ÿåœ¨å°† DOM æ¸²æŸ“ç»˜åˆ¶åˆ°å±å¹•ä¹‹å,è€Œ `useLayoutEffect` å‘ç”Ÿåœ¨ DOM æ¸²æŸ“ç»˜åˆ¶åˆ°å±å¹•ä¹‹å‰åŒæ­¥è§¦å‘.ä¹Ÿå°±æ˜¯`useLayoutEffect`æ¯”`useEffect`æ›´å¿«æ‰§è¡Œ.`useLayouEffect`ç”¨åœ¨å¤æ‚çš„åŠ¨ç”»å½“ä¸­,æ•ˆæœæ¯” `useEffect` æ›´åŠ å¹²å‡€(æ²¡æœ‰é—ªçƒ(flicker)çš„æƒ…å†µ).å½“ç„¶å¤§å¤šæ•°æƒ…å†µä¸‹,è¿˜æ˜¯ä½¿ç”¨ `useEffect`,å› ä¸º `useEffect` å…ˆå°† `DOM æ”¹å˜(mutation)`è¿›è¡Œç»˜åˆ¶,åæ‰§è¡Œ`effects` å‡½æ•°,è€Œ `useLayoutEffect` æ˜¯å…ˆè®¡ç®— `effects` å‡½æ•°å†ç»˜åˆ¶,è®¡ç®—çš„è¿‡ç¨‹ä¼šåœ¨ä¸€å®šç¨‹åº¦ä¸Šé˜»å¡æµè§ˆå™¨çš„æ¸²æŸ“.

> The useLayoutEffect function is triggered synchronously before the DOM mutations are painted. However, the useEffect function is called after the DOM mutations are painted.
## useContext

---

### åŸºæœ¬ä»‹ç»

`useContext` è§£å†³å‚ç›´æ–¹å‘ä¸ŠåµŒå¥—å±‚çº§å¤ªæ·±çš„ç»„ä»¶ä¼ é€’ `props` å¤ªå†—é•¿çš„é—®é¢˜ï¼Œè¯¥é—®é¢˜ä¹Ÿè¢«å«åš `props drilling` é—®é¢˜ã€‚

```javascript
  +----------------+
          |                |
          |        A       |
          |        |Props  |
          |        v       |
          |                |
          +--------+-------+
                   |
         +---------+-----------+
         |                     |
         |                     |
+--------+-------+    +--------+-------+
|                |    |                |
|                |    |        +       |
|       B        |    |        |Props  |
|                |    |        v       |
|                |    |                |
+----------------+    +--------+-------+
                               |
                      +--------+-------+
                      |                |
                      |        +       |
                      |        |Props  |
                      |        v       |
                      |                |
                      +--------+-------+
                               |
                      +--------+-------+
                      |                |
                      |        +       |
                      |        |Props  |
                      |        C       |
                      |                |
                      +----------------+
```

---

### åŸºæœ¬ä½¿ç”¨

```javascript
import * as React from "react";
import { createContext, useState, useContext } from "react";
import ReactDOM from "react-dom";

const genColor = () => `hsla(${Math.random() * 360}, 70%, 50%)`;

type MyContext = { color: string, changer: (any) => void };

const ThemeContext = createContext < MyContext > null;

const Comp = () => {
  const { color, changer } = useContext(ThemeContext);

  return (
    <button style={{ color, fontSize: "2em" }} onClick={changer}>
      Hello World! Click to change color
    </button>
  );
};

const App = () => {
  const [state, setState] = useState({ color: "green" });

  const { color } = state;
  const changer = () => setState({ color: genColor() });

  return (
    <ThemeContext.Provider value={{ color, changer }}>
      <Comp />
    </ThemeContext.Provider>
  );
};
```

---

### useContext æœ€ä½³å®è·µ
å°è£…`useContext`å•ç‹¬æˆä¸ºä¸€ä¸ª`context`æ–‡ä»¶ï¼Œè¿™é‡Œæ˜¯`currencyContext.js`ã€‚å°†`context.Provider`ï¼Œ`contextæ•°æ®`ï¼Œ`æ”¹å˜contextå¯¹è±¡çš„å›è°ƒå‡½æ•°`å°è£…åˆ°ä¸€ä¸ªæ–‡ä»¶ï¼Œå¯¼å‡ºä¸€ä¸ªå°è£…`Provider`åœ¨é¡¶å±‚çš„é«˜é˜¶ç»„ä»¶ï¼ˆ`è¿™é‡Œæ˜¯CurrencyProvider`ï¼‰å’Œä¸€ä¸ªå±äºè¯¥`contextå¯¹è±¡`çš„è‡ªå®šä¹‰Hook(`è¿™é‡Œæ˜¯useCurrency`)ã€‚
#### currencyContext.js
```javascript

const CURRENCIES = {
  Euro: {
    code: "EUR",
    label: "Euro",
    conversionRate: 1, // base conversion rate
  },
  Usd: {
    code: "USD",
    label: "US Dollar",
    conversionRate: 1.19,
  },
};

const useCurrency = () => {
  const [currency, setCurrency] = React.useContext(CurrencyContext);

  const handleCurrency = (value) => {
    setCurrency(value);
  };

  return { value: currency, onChange: handleCurrency };
};

const CurrencyProvider = ({ children }) => {
  const [currency, setCurrency] = React.useState(CURRENCIES.Euro);

  return (
    <CurrencyContext.Provider value={[currency, setCurrency]}>
      {children}
    </CurrencyContext.Provider>
  );
};

export { CurrencyProvider, useCurrency, CURRENCIES };
```
#### App.js
```javascript
import { CurrencyProvider, useCurrency, CURRENCIES } from "./currency-context";
const App = () => {
  return (
    <CurrencyProvider>
      <CurrencyButtons />
    </CurrencyProvider>
  );
};

const CurrencyButtons = () => {
  const { onChange } = useCurrency();

  return Object.values(CURRENCIES).map((item) => (
    <CurrencyButton key={item.label} onClick={() => onChange(item)}>
      {item.label}
    </CurrencyButton>
  ));
};
```
## useCallback

---

### åŸºæœ¬ä»‹ç»

`useCallback` è¿”å›ä¸€ä¸ª `memoried` å›è°ƒå‡½æ•°ï¼Œåªæœ‰åœ¨ä¾èµ–é¡¹æ”¹å˜çš„æ—¶å€™ï¼Œæ‰ä¼šæ›´æ–°è¿™ä¸ªå›è°ƒå‡½æ•°ã€‚`useCallback`å¯ä»¥è§£å†³å¼•ç”¨ç›¸ç­‰é—®é¢˜ï¼Œé¿å…å­ç»„ä»¶è¿›è¡Œå¤šæ¬¡ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“ã€‚

---

### åŸºæœ¬ä½¿ç”¨

#### è§£å†³å¼•ç”¨ç›¸ç­‰é—®é¢˜ 1ï¼š useCallback + updater function(ç”¨å‡½æ•°æ¥æ›´æ–°çŠ¶æ€)

```javascript
import React, { useState, useCallback, useRef } from "react";
import ReactDOM from "react-dom";
import "./styles.css";

const Button = React.memo(({ handleClick }) => {
  const refCount = useRef(0);
  return (
    <button
      onClick={handleClick}
    >{`button render count ${refCount.current++}`}</button>
  );
});

function App() {
  const [isOn, setIsOn] = useState(false);
  const handleClick = useCallback(() => setIsOn((prevIsOn) => !prevIsOn), []);
  return (
    <div className="App">
      <h1>{isOn ? "On" : "Off"}</h1>
      <Button handleClick={handleClick} />
    </div>
  );
}

const rootElement = document.getElementById("root");
ReactDOM.render(<App />, rootElement);
```

#### è§£å†³å¼•ç”¨ç›¸ç­‰é—®é¢˜ 2ï¼šuseCallback + useReducer(dispatch å‡½æ•°ä½œä¸ºä¾èµ–)

```javascript
const Button = React.memo(({ handleClick, text }) => {
  const refCount = useRef(0);
  return (
    <button onClick={handleClick}>
      {`${text}`}
      <span className={"renderCount"}>
        self render count {refCount.current++}
      </span>
    </button>
  );
});

const reducer = (state, action) => {
  switch (action.type) {
    case "INCREASE_A":
      return {
        ...state,
        numA: state.numA + 1,
      };
    case "DECREASE_A":
      return {
        ...state,
        numA: state.numA - 1,
      };
    case "INCREASE_B":
      return {
        ...state,
        numB: state.numB + 1,
      };
    case "DECREASE_B":
      return {
        ...state,
        numB: state.numB - 1,
      };
    case "A_PLUS_B":
      return {
        ...state,
        result: state.numA + state.numB,
      };
    case "A_MINUS_B":
      return {
        ...state,
        result: state.numA - state.numB,
      };
    default:
      return state;
  }
};

function App() {
  const [{ numA, numB, result }, dispatch] = useReducer(reducer, {
    numA: 0,
    numB: 0,
    result: null,
  });
  const handlePlusAClick = useCallback(
    () => dispatch({ type: "INCREASE_A" }),
    [dispatch]
  );
  const handleMinusAClick = useCallback(
    () => dispatch({ type: "DECREASE_A" }),
    [dispatch]
  );
  const handlePlusBClick = useCallback(
    () => dispatch({ type: "INCREASE_B" }),
    [dispatch]
  );
  const handleMinusBClick = useCallback(
    () => dispatch({ type: "DECREASE_B" }),
    [dispatch]
  );
  const handleAPlusB = useCallback(
    () => dispatch({ type: "A_PLUS_B" }),
    [dispatch]
  );
  const handleAMinusB = useCallback(
    () => dispatch({ type: "A_MINUS_B" }),
    [dispatch]
  );
  return (
    <div className="App">
      <div className={"num"}>NumA: {numA}</div>
      <Button text={"+"} handleClick={handlePlusAClick} />
      <Button text={"-"} handleClick={handleMinusAClick} />
      <div className={"num"}>NumB: {numB}</div>
      <Button text={"+"} handleClick={handlePlusBClick} />
      <Button text={"-"} handleClick={handleMinusBClick} />
      <div className={"num"}>Result: {result}</div>
      <Button text={"A + B"} handleClick={handleAPlusB} />
      <Button text={"A - B"} handleClick={handleAMinusB} />
    </div>
  );
}
```

---

#### è§£å†³å¼•ç”¨ç›¸ç­‰é—®é¢˜ 3ï¼šuseCallback + useEffect(å‘ useEffect ä¼ é€’å¼•ç”¨ç›¸ç­‰çš„å‡½æ•°ä¾èµ–)

```javascript
function Foo({ bar, baz }) {
  React.useEffect(() => {
    const options = { bar, baz };
    buzz(options);
  }, [bar, baz]);
  return <div>foobar</div>;
}

function Blub() {
  const bar = React.useCallback(() => {}, []);
  const baz = React.useMemo(() => [1, 2, 3], []);
  return <Foo bar={bar} baz={baz} />;
}
```

---

### useCallback è¯¯åŒºä½¿ç”¨ï¼šç»™æ‰€æœ‰å‡½æ•°åŒ…è£…ä¸Š useCallback

```javascript
import { useState, useCallback } from "react";
export const HookUsecallback = () => {
  const [count, setCount] = useState(0);
  const handleAddFn = useCallback(() => {
    console.log("handleAdd");
    setCount(count + 1);
  }, [count]);
  return (
    <>
      <div>{count}</div>
      <button onClick={() => handleAddFn()}>+1</button>
    </>
  );
};
```

ä¸Šé¢çš„å®ä¾‹ï¼Œå°±ç®—ä¸åŒ…è£¹ `useCallback` ä¹Ÿå¯ä»¥è¾¾åˆ°ç›¸åŒçš„æ•ˆæœï¼Œä½†`useCallback` åšäº†æ›´å¤šçš„å·¥ä½œï¼Œè°ƒç”¨ `React.useCallback`,å®šä¹‰äº†ä¸€ä¸ªæ•°ç»„ `[]`ï¼Œåè€Œä½¿å¾—æ€§èƒ½å’Œå†…å­˜å˜å¾—ç³Ÿç³•ã€‚

---

### useCallback è¯¯åŒºä½¿ç”¨ï¼šä½¿ç”¨ useCallback æ¥ä¼˜åŒ–è®¡ç®—å¼€é”€

- è™½ç„¶å¯ä»¥åœ¨`useCallback`ä¸­çš„ `memoried` å‡½æ•°å½“ä¸­ä¹¦å†™è®¡ç®—é€»è¾‘ï¼Œæ¯æ¬¡è°ƒç”¨ä¹Ÿéƒ½ä¼šè·å¾—è®¡ç®—ç»“æœï¼Œä½†æ˜¯ `useCallback` è¿”å›çš„æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ‰€ä»¥æ¯æ¬¡ä½¿ç”¨çš„æ—¶å€™ï¼Œéƒ½ä¼šè°ƒç”¨ `memoried` å‡½æ•°é‡æ–°è®¡ç®—ã€‚æ‰€ä»¥ä¸èƒ½åƒ `useMemo` ä¸€æ ·è¿”å›ä¸€ä¸ªå¼•ç”¨ç›¸ç­‰çš„å€¼æ¥ä¼˜åŒ–è®¡ç®—å¼€é”€ã€‚
## useMemo

---

### åŸºæœ¬ä»‹ç»

`useMemo` è¿”å›ä¸€ä¸ª `memoried` å€¼ï¼Œåªæœ‰åœ¨ä¾èµ–é¡¹æ”¹å˜çš„æ—¶å€™ï¼Œæ‰ä¼šé‡æ–°è®¡ç®—`memoried`å€¼ã€‚`useMemo`ä»ä¸¤ä¸ªæ–¹é¢è¿›è¡Œæ€§èƒ½ä¼˜åŒ–ï¼Œ æ—¢å¯ä»¥è§£å†³å¼•ç”¨ç›¸ç­‰é—®é¢˜ï¼Œé¿å…å­ç»„ä»¶è¿›è¡Œå¤šæ¬¡ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“åˆå¯ä»¥ä¼˜åŒ–è®¡ç®—å¼€é”€ï¼Œé¿å…å¤šæ¬¡ä¸å¿…è¦çš„é‡æ–°è®¡ç®—ã€‚

---

### åŸºæœ¬ä½¿ç”¨

#### è§£å†³ä¼˜åŒ–è®¡ç®—å¼€é”€é—®é¢˜ï¼šuseMemo

```javascript
import "./styles.css";
import { useMemo, useState } from "react";
export default function App() {
  const [count, setCount] = useState(3);
  const [name, setName] = useState("Ryan");
  function computedExpensiveValue(count) {
    console.log("computed expensive value");
    let sum = 0;
    while (count > 0) {
      sum += count;
      count--;
    }
    return sum;
  }
  const result = useMemo(() => computedExpensiveValue(count), [count]);
  return (
    <div className="App">
      <h1>Hello CodeSandbox</h1>
      <input
        value={count}
        onChange={(e) => setCount(Number(e.target.value))}
      ></input>
      <input value={name} onChange={(e) => setName(e.target.value)}></input>
      <h2>{result}</h2>
      <h3>{name}</h3>
    </div>
  );
}
```

#### è§£å†³å¼•ç”¨ç›¸ç­‰é—®é¢˜ 1ï¼š useMemo + updater function(ç”¨å‡½æ•°æ¥æ›´æ–°çŠ¶æ€)

```javascript
const Button = React.memo(({ handleClick }) => {
  const refCount = useRef(0);
  return (
    <button
      onClick={handleClick}
    >{`button render count ${refCount.current++}`}</button>
  );
});
function App() {
  const [isOn, setIsOn] = useState(false);
  const handleClick = useMemo(() => () => setIsOn((prevIsOn) => !prevIsOn), []);
  return (
    <div className="App">
      <h1>{isOn ? "On" : "Off"}</h1>
      <Button handleClick={handleClick} />
    </div>
  );
}
```

#### è§£å†³å¼•ç”¨ç›¸ç­‰é—®é¢˜ 2ï¼šuseMemo + useEffect(å‘ useEffect ä¼ é€’å¼•ç”¨ç›¸ç­‰çš„å‡½æ•°ä¾èµ–)

```javascript
function Foo({ bar, baz }) {
  React.useEffect(() => {
    const options = { bar, baz };
    buzz(options);
  }, [bar, baz]);
  return <div>foobar</div>;
}

function Blub() {
  const bar = React.useCallback(() => {}, []);
  const baz = React.useMemo(() => [1, 2, 3], []);
  return <Foo bar={bar} baz={baz} />;
}
```

#### è§£å†³å¼•ç”¨ç›¸ç­‰é—®é¢˜ 3ï¼šuseMemo + useReducer(dispatch å‡½æ•°ä½œä¸ºä¾èµ–)

```javascript
import React, { useReducer, useMemo, useRef } from "react";
import "./App.css";

const Button = React.memo(({ handleClick, text }) => {
  const refCount = useRef(0);
  return (
    <button onClick={handleClick}>
      {`${text}`}
      <span className={"renderCount"}>
        self render count {refCount.current++}
      </span>
    </button>
  );
});

const reducer = (state, action) => {
  switch (action.type) {
    case "INCREASE_A":
      return {
        ...state,
        numA: state.numA + 1,
      };
    case "DECREASE_A":
      return {
        ...state,
        numA: state.numA - 1,
      };
    case "INCREASE_B":
      return {
        ...state,
        numB: state.numB + 1,
      };
    case "DECREASE_B":
      return {
        ...state,
        numB: state.numB - 1,
      };
    case "A_PLUS_B":
      return {
        ...state,
        result: state.numA + state.numB,
      };
    case "A_MINUS_B":
      return {
        ...state,
        result: state.numA - state.numB,
      };
    default:
      return state;
  }
};

function App() {
  const [{ numA, numB, result }, dispatch] = useReducer(reducer, {
    numA: 0,
    numB: 0,
    result: null,
  });
  const handlePlusAClick = useMemo(
    () => () => dispatch({ type: "INCREASE_A" }),
    [dispatch]
  );
  const handleMinusAClick = useMemo(
    () => () => dispatch({ type: "DECREASE_A" }),
    [dispatch]
  );
  const handlePlusBClick = useMemo(
    () => () => dispatch({ type: "INCREASE_B" }),
    [dispatch]
  );
  const handleMinusBClick = useMemo(
    () => () => dispatch({ type: "DECREASE_B" }),
    [dispatch]
  );
  const handleAPlusB = useMemo(
    () => () => dispatch({ type: "A_PLUS_B" }),
    [dispatch]
  );
  const handleAMinusB = useMemo(
    () => () => dispatch({ type: "A_MINUS_B" }),
    [dispatch]
  );
  return (
    <div className="App">
      <div className={"num"}>NumA: {numA}</div>
      <Button text={"+"} handleClick={handlePlusAClick} />
      <Button text={"-"} handleClick={handleMinusAClick} />
      <div className={"num"}>NumB: {numB}</div>
      <Button text={"+"} handleClick={handlePlusBClick} />
      <Button text={"-"} handleClick={handleMinusBClick} />
      <div className={"num"}>Result: {result}</div>
      <Button text={"A + B"} handleClick={handleAPlusB} />
      <Button text={"A - B"} handleClick={handleAMinusB} />
    </div>
  );
}
export default App;
```

ç»“åˆ `useCallback.md`ï¼Œä¼šå‘ç° `useCallback` èƒ½åšçš„ï¼Œ`useMemo` ä¹Ÿèƒ½åšï¼Œå› ä¸º `useCallback` åªèƒ½è¿”å› `memoried` å‡½æ•°ï¼Œè€Œ `useMemo` æ—¢èƒ½è¿”å›` memoried` å‡½æ•°ï¼Œä¹Ÿèƒ½è¿”å› `memoried` å€¼ã€‚
## useRef
### åŸºæœ¬ä»‹ç»
useRef ä¸»è¦ç”¨åœ¨ä¸‰ä¸ªæ–¹é¢ï¼Œç¬¬ä¸€ä¸ªæ–¹é¢æ˜¯ä½œä¸ºä¸€ä¸ªå¯å˜çš„å®ä¾‹å€¼ï¼Œè¯¥å®ä¾‹å€¼çš„å˜åŒ–ä¸ä¼šå¼•èµ·ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ã€‚ä¸€èˆ¬ç”¨æ¥è·Ÿè¸ªä¸åº”è¯¥è§¦å‘ç»„ä»¶é‡æ–°æ¸²æŸ“çš„ç»„ä»¶çŠ¶æ€.ç¬¬äºŒä¸ªæ–¹é¢æ˜¯ é€šè¿‡ ref å€¼å¼•ç”¨ DOMï¼Œæ¥æ”¹å˜ DOM çš„çŠ¶æ€ï¼ˆè¡¨å• focus blur ,æŒ‰é’® disabled, HTML å…ƒç´  classï¼‰ã€‚ç¬¬ä¸‰ä¸ªæ–¹é¢æ˜¯é€šè¿‡ ref å›è°ƒå‡½æ•°æ¥å¼•ç”¨ DOM,å°† DOM èŠ‚ç‚¹ä½œä¸ºå‚æ•°ä¼ å…¥.æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šè°ƒç”¨è¯¥å›è°ƒå‡½æ•°.

---
### åŸºæœ¬ä½¿ç”¨
#### useRef ä½œä¸ºå¯å˜çš„å®ä¾‹å€¼ï¼š

##### æ¡ˆä¾‹ 1ï¼š åˆ¤æ–­ç»„ä»¶æ˜¯é¦–æ¬¡æ¸²æŸ“è¿˜æ˜¯é‡æ–°æ¸²æŸ“

```javascript
function ComponentWithRefInstanceVariable() {
  const [count, setCount] = React.useState(0);

  function onClick() {
    setCount(count + 1);
  }

  const isFirstRender = React.useRef(true);

  React.useEffect(() => {
    if (isFirstRender.current) {
      isFirstRender.current = false;
    } else {
      console.log(
        `
          I am a useEffect hook's logic
          which runs for a component's
          re-render.
        `
      );
    }
  });

  return (
    <div>
      <p>{count}</p>

      <button type="button" onClick={onClick}>
        Increase
      </button>
    </div>
  );
}
```

#### useRef ref å€¼ä½œä¸º DOM å¼•ç”¨

##### æ¡ˆä¾‹ 1ï¼šä½¿ç”¨ ref focus input

```javascript
function App() {
  return <ComponentWithDomApi label="Label" value="Value" isFocus />;
}

function ComponentWithDomApi({ label, value, isFocus }) {
  const ref = React.useRef(); // (1)

  React.useEffect(() => {
    if (isFocus) {
      ref.current.focus(); // (3)
    }
  }, [isFocus]);

  return (
    <label>
      {/* (2) */}
      {label}: <input type="text" value={value} ref={ref} />
    </label>
  );
}
```

##### æ¡ˆä¾‹ 2ï¼š ä½¿ç”¨ ref æ”¹å˜æ–‡æ¡£æ ‡é¢˜

```javascript
function ComponentWithRefRead() {
  const [text, setText] = React.useState("Some text ...");

  function handleOnChange(event) {
    setText(event.target.value);
  }

  const ref = React.useRef();

  React.useEffect(() => {
    const { width } = ref.current.getBoundingClientRect();

    document.title = `Width:${width}`;
  }, [text]);

  return (
    <div>
      <input type="text" value={text} onChange={handleOnChange} />
      <div>
        <span ref={ref}>{text}</span>
      </div>
    </div>
  );
}
```

#### useRef ref å›è°ƒå‡½æ•°ä½œä¸º DOM å¼•ç”¨

æ¯æ¬¡ç»„ä»¶æ¸²æŸ“çš„æ—¶å€™ï¼Œéƒ½ä¼šè°ƒç”¨ ref å›è°ƒå‡½æ•°ï¼Œä¼ å…¥ DOM èŠ‚ç‚¹ä½œä¸ºå‚æ•°. ref å›è°ƒå‡½æ•°å¯¹æ¯” ref å€¼,æ‘†è„±äº† useEffect å’Œ useRef çš„ä½¿ç”¨.

##### æ¡ˆä¾‹ 1: ref å›è°ƒå‡½æ•°ä½œä¸º DOM å¼•ç”¨

```javascript
function ComponentWithRefRead() {
  const [text, setText] = React.useState("Some text ...");

  function handleOnChange(event) {
    setText(event.target.value);
  }

  const ref = (node) => {
    if (!node) return;

    const { width } = node.getBoundingClientRect();

    document.title = `Width:${width}`;
  };

  return (
    <div>
      <input type="text" value={text} onChange={handleOnChange} />
      <div>
        <span ref={ref}>{text}</span>
      </div>
    </div>
  );
}
```

##### æ¡ˆä¾‹ 2: useCallback å¢å¼º ref å›è°ƒå‡½æ•°ä½œä¸º DOM å¼•ç”¨

ä½¿ç”¨ useCallback (ä¾èµ–ä¸ºç©ºæ•°ç»„) å¯ä»¥åŒ…è£¹ ref å‡½æ•°,åªä½¿å¾— ref å‡½æ•°åœ¨ç¬¬ä¸€æ¬¡æŒ‚è½½åæ‰§è¡Œ,ä¹‹åç»„ä»¶æ›´æ–°,ä¸ä¼šæ‰§è¡Œ ref å‡½æ•°.æ¥å¢å¼º ref å‡½æ•°.

```javascript
function ComponentWithRefRead() {
  const [text, setText] = React.useState("Some text ...");

  function handleOnChange(event) {
    setText(event.target.value);
  }

  const ref = React.useCallback((node) => {
    if (!node) return;

    const { width } = node.getBoundingClientRect();

    document.title = `Width:${width}`;
  }, []); // åŠ ä¸Šä¾èµ–å’Œä¸åŒ…è£¹useCallbackæ˜¯ä¸€æ ·æ•ˆæœ

  return (
    <div>
      <input type="text" value={text} onChange={handleOnChange} />
      <div>
        <span ref={ref}>{text}</span>
      </div>
    </div>
  );
}
```
## useImperativeHandle

### åŸºæœ¬ä»‹ç»

useImperativeHandle å¯ä»¥è®©ä½ åœ¨ä½¿ç”¨ ref æ—¶è‡ªå®šä¹‰æš´éœ²ç»™çˆ¶ç»„ä»¶çš„å®ä¾‹å€¼ã€‚

### åŸºæœ¬ä½¿ç”¨

```javascript
import "./styles.css";
import { forwardRef, useImperativeHandle, useRef, useState } from "react";
const InputRef = forwardRef((props, ref) => {
  const inputEl = useRef(null);
  // useImperativeHandle å¯ä»¥å‡å°‘å‘çˆ¶ç»„ä»¶æš´éœ²DOMèŠ‚ç‚¹çš„å±æ€§ï¼Œåªæš´éœ²ç¬¬äºŒå‚æ•°çš„å¯¹è±¡ï¼Œä½œä¸ºdom.current
  useImperativeHandle(ref, () => ({
    color: "green",
    value: inputEl.current.value,
  }));
  return <input ref={inputEl}></input>;
});
export default function App() {
  const inputRef = useRef(null);
  const [isShow, setShow] = useState(true);
  return (
    <div className="App">
      <button onClick={() => console.log(inputRef.current)}>è·å–</button>
      <h1>Hello CodeSandbox</h1>
      <button onClick={() => setShow(!isShow)}>åˆ‡æ¢</button>
      <InputRef ref={inputRef} />
      <h2>Start editing to see some magic happen!</h2>
    </div>
  );
}
```
# React Hooks in TypeScript
## useState

å¦‚æœ `useState` ä¼ å…¥çš„åˆå§‹å€¼æ˜¯ç®€å•å€¼,ç±»å‹ä¼šè¢«è‡ªåŠ¨æ¨æ–­,å¦‚æœæ˜¯ `null` æˆ–è€…æ˜¯ `undefined`,æˆ–è€…æ˜¯å¯¹è±¡,æ•°ç»„ç­‰,å¯ä»¥ä½¿ç”¨ä¼ å…¥æ³›å‹.

```typescript
// inferred as number
const [value, setValue] = useState(0);

// explicitly setting the types
const [value, setValue] = (useState < number) | (undefined > undefined);
const [value, setValue] = useState < Array < number >> [];

interface MyObject {
  foo: string;
  bar?: number;
}
const [value, setValue] = useState < MyObject > { foo: "hello" };
```

## useContext

`useContext` å¯ä»¥æ ¹æ®ä¼ å…¥çš„ `Context` å¯¹è±¡çš„ç±»å‹è¿›è¡Œæ¨æ–­,ä¸éœ€è¦æ˜¾ç¤ºæ³¨å†Œç±»å‹.

```javascript
type Theme = "light" | "dark";
const ThemeContext = createContext < Theme > "dark";

const App = () => (
  <ThemeContext.Provider value="dark">
    <MyComponent />
  </ThemeContext.Provider>
);

const MyComponent = () => {
  const theme = useContext(ThemeContext);
  return <div>The theme is {theme}</div>;
};
```

## useEffect / useLayoutEffect

ç”±äº `useEffect / useLayoutEffect` å‡½æ•°æ²¡æœ‰æš´éœ²å¤„ç†è¿”å›å€¼çš„æ¥å£,æ‰€ä»¥ä¸éœ€è¦ç±»å‹

```typeScript
useEffect(() => {
  const subscriber = subscribe(options);
  return () => {
    unsubscribe(subscriber)
  };
}, [options]);
```

## useMemo / useCallback

`useMemo` å’Œ `useCallback` éƒ½å¯ä»¥æ ¹æ®è¿”å›å€¼æ¥æ¨æ–­ç±»å‹.

```javascript
const value = 10;
// inferred as number
const result = useMemo(() => value * 2, [value]);

const multiplier = 2;
// inferred as (value: number) => number
const multiply = useCallback(
  (value: number) => value * multiplier,
  [multiplier]
);
```

## useRef

`null` ä½œä¸ºåˆå§‹å€¼,æ³›å‹ä½œä¸º `ref` ç±»å‹.

```typescript
const MyInput = () => {
  const inputRef = useRef < HTMLInputElement > null;
  return <input ref={inputRef} />;
};
```

å½“ `ref` ç”¨æ¥ä¿å­˜å¯å˜çš„å®ä¾‹å€¼æ—¶ç±»å‹ï¼Œ`ref.current` çš„ç±»å‹ ä¼šè¢«è‡ªåŠ¨æ¨æ–­ã€‚

```typescript
const myNumberRef = useRef(0);
myNumberRef.current += 1;
```

## useReducer

`useReducer` ä¼šä» `reducer` å‡½æ•°çš„å‚æ•°ä¸­æ¨æ–­å‡º è¦æ´¾å‘`ï¼ˆdispatchï¼‰`çš„ `action` ç±»å‹ï¼Œä»¥åŠ `store` ä¸­ `state` çš„ç±»å‹ã€‚

```javascript
interface State {
  value: number;
}

type Action =
  | { type: "increment" }
  | { type: "decrement" }
  | { type: "incrementAmount", amount: number };

const counterReducer = (state: State, action: Action) => {
  switch (action.type) {
    case "increment":
      return { value: state.value + 1 };
    case "decrement":
      return { value: state.value - 1 };
    case "incrementAmount":
      return { value: state.value + action.amount };
    default:
      throw new Error();
  }
};

const [state, dispatch] = useReducer(counterReducer, { value: 0 });

dispatch({ type: "increment" });
dispatch({ type: "decrement" });
dispatch({ type: "incrementAmount", amount: 10 });

// TypeScript compilation error
dispatch({ type: "invalidActionType" });
```

## useImperativeHandle

`MyInputHandles` ä¸ºæš´éœ² `ref` å¯¹è±¡çš„ç±»å‹ï¼Œ`MyInputProps` æ˜¯è¢«è½¬å‘ç»„ä»¶ `props` ç±»å‹ã€‚

```typescript
export interface MyInputHandles {
  focus(): void;
}

const MyInput: RefForwardingComponent<MyInputHandles, MyInputProps> = (
  props,
  ref
) => {
  const inputRef = useRef<HTMLInputElement>(null);

  useImperativeHandle(ref, () => ({
    focus: () => {
      if (inputRef.current) {
        inputRef.current.focus();
      }
    },
  }));

  return <input {...props} ref={inputRef} />;
};

export default forwardRef(MyInput);
import MyInput, { MyInputHandles } from "./MyInput";

const Autofocus = () => {
  const myInputRef = useRef<MyInputHandles>(null);

  useEffect(() => {
    if (myInputRef.current) {
      myInputRef.current.focus();
    }
  });

  return <MyInput ref={myInputRef} />;
};
```
