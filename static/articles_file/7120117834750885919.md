---
highlight: atelier-cave-dark
---

<div align=center><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d83f44dceb8d41c7b15b0bc19630dd64~tplv-k3u1fbpfcp-zoom-1.image" width="100%" referrerpolicy="no-referrer"></div>




> - ğŸ’¡ ä½œè€…ï¼š[éŸ©ä¿¡å­](https://github.com/HanXinzi-AI)@[ShowMeAI](http://www.showmeai.tech/)
> - ğŸ“˜ [æ·±åº¦å­¦ä¹ å®æˆ˜ç³»åˆ—](http://www.showmeai.tech/tutorials/42)ï¼š[http://www.showmeai.tech/tutorials/42](http://www.showmeai.tech/tutorials/42)
> - ğŸ“˜ [NLP å®æˆ˜ç³»åˆ—](http://www.showmeai.tech/tutorials/45)ï¼š[http://www.showmeai.tech/tutorials/45](http://www.showmeai.tech/tutorials/45)
> - ğŸ“˜ [æœ¬æ–‡åœ°å€](http://www.showmeai.tech/article-detail/288)ï¼š[http://www.showmeai.tech/article-detail/288](http://www.showmeai.tech/article-detail/288)
> - ğŸ“¢ å£°æ˜ï¼šç‰ˆæƒæ‰€æœ‰ï¼Œè½¬è½½è¯·è”ç³»å¹³å°ä¸ä½œè€…å¹¶æ³¨æ˜å‡ºå¤„
> - ğŸ“¢ æ”¶è—[ShowMeAI](http://www.showmeai.tech/)æŸ¥çœ‹æ›´å¤šç²¾å½©å†…å®¹



æˆ‘ä»¬åœ¨æ—¥å¸¸ä¸šåŠ¡ä¸­é‡åˆ°çš„å¾ˆå¤šé—®é¢˜ï¼Œéƒ½å¯ä»¥å½’å±åˆ°æ—¶é—´åºåˆ—èŒƒç•´å†…â€”â€”è‚¡å¸‚æ¶¨è·Œå˜åŒ–ã€ç”µå•†é”€é‡é¢„æµ‹ã€ä¼ æŸ“ç—…ä¼ æ’­æŒ–æ˜ç­‰ï¼Œå…¶å®éƒ½å¯ä»¥ç”¨ã€**æ—¶é—´åºåˆ—**ã€è§£å†³ã€‚


æ—¶é—´åºåˆ—å»ºæ¨¡å·¥å…·åº“æœ‰å¾ˆå¤šï¼Œæ¯”è¾ƒçŸ¥åçš„æœ‰ Uber å¼€æºçš„ ğŸ“˜[**Orbit**](https://github.com/uber/orbit)å·¥å…·åº“ã€LinkedIn å¼€æºçš„ ğŸ“˜[**Greykite**](https://github.com/linkedin/greykite) å·¥å…·åº“ï¼Œæä¾›äº†éƒ¨åˆ†è§£å†³æ–¹æ³•ã€‚


<div align=center><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6d324e8455c441ea81a9bd0efe373b2e~tplv-k3u1fbpfcp-zoom-1.image" width="100%" referrerpolicy="no-referrer"></div>




æœ€è¿‘ Salesforce å›¢é˜Ÿç ”å‘çš„ ğŸ“˜[**Merlion**](https://github.com/salesforce/Merlion) å·¥å…·åº“å£°åé¹Šèµ·ã€‚Merlion ä½œä¸ºåèµ·ä¹‹ç§€ï¼Œè¦†ç›–éå¸¸å…¨é¢ï¼Œæä¾›äº†å¾ˆå¤šæ—¶é—´åºåˆ—çš„ç®—æ³•è§£å†³æ–¹æ¡ˆã€‚æœ¬ç¯‡ ShowMeAI å°±ç»™å¤§å®¶ä»‹ç»ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨ Merlion è§£å†³ã€æ—¶é—´åºåˆ—ã€é—®é¢˜ã€‚


<div align=center><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c56f51008574446883ab134e06d0f637~tplv-k3u1fbpfcp-zoom-1.image" width="70%" referrerpolicy="no-referrer"></div>


Merlion æ˜¯ä¸€ä¸ªç”¨äºæ—¶é—´åºåˆ—çš„æ™ºèƒ½Python åº“ï¼Œ**æä¾›äº†ä¸€ä¸ªç«¯åˆ°ç«¯çš„æœºå™¨å­¦ä¹ æ¡†æ¶ï¼ŒåŒ…æ‹¬åŠ è½½å’Œè½¬æ¢æ•°æ®ï¼Œå»ºç«‹å’Œè®­ç»ƒæ¨¡å‹ï¼Œæ¨¡å‹ç»“æœåå¤„ç†ï¼Œä»¥åŠè¯„ä¼°æ¨¡å‹æ€§èƒ½**ã€‚**Merlion** **æ”¯æŒå„ç§æ—¶é—´åºåˆ—å­¦ä¹ ä»»åŠ¡ï¼ŒåŒ…æ‹¬å•å˜é‡å’Œå¤šå˜é‡æ—¶é—´åºåˆ—çš„é¢„æµ‹ã€å¼‚å¸¸æ£€æµ‹å’Œå˜åŒ–ç‚¹æ£€æµ‹**ã€‚è¿™ä¸ªåº“çš„ç›®çš„æ˜¯ä¸ºå·¥ç¨‹å¸ˆå’Œç ”ç©¶äººå‘˜æä¾›ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆï¼Œå¿«é€Ÿå¼€å‘ç‰¹å®šçš„æ—¶é—´åºåˆ—éœ€æ±‚æ¨¡å‹ï¼Œå¹¶åœ¨å¤šä¸ªæ—¶é—´åºåˆ—æ•°æ®é›†ä¸Šè¿›è¡ŒåŸºå‡†æµ‹è¯•ã€‚


<div align=center><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f42f4e3c794445c09cb53a58f4be804e~tplv-k3u1fbpfcp-zoom-1.image" width="100%" referrerpolicy="no-referrer"></div>



## ğŸ’¡ ç¯å¢ƒé…ç½®

Merlionæœ€åŸºæœ¬çš„å®‰è£…åªéœ€è¦ **è¿è¡Œå‘½ä»¤** `pip install salesforce-merlion`ã€‚ä½†è¿™ä¸ªåŸºç¡€ç‰ˆæœ¬å¹¶ä¸åŒ…å«æ‰€æœ‰æ¨¡å‹ï¼Œå¦‚æœè¦å®‰è£…å…¨éƒ¨æ¨¡å‹ï¼Œå¦‚ LightGBM æˆ– Facebook çš„ Prophetï¼Œæˆ‘ä»¬åˆ‡æ¢æˆå‘½ä»¤ `pip install "salesforce-merlion[all]"` å°±å¯ä»¥ã€‚

## ğŸ’¡ å·¥å…·åº“æ¶æ„

åœ¨æ·±å…¥å­¦ä¹ ä½¿ç”¨ Merlion è§£å†³æ—¶é—´åºåˆ—é—®é¢˜ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆçœ‹çœ‹å®ƒçš„æ¶æ„ã€‚ä¸‹å›¾æŒ‰æ—¶é—´é¡ºåºæ˜¾ç¤ºäº†å®ƒçš„ä¸åŒæ¨¡å‹ä»¥åŠå®ƒä»¬å¦‚ä½•ååŒå·¥ä½œã€‚

<div align=center><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/435ec436eb8d44ed97a4ccb37a1b8de0~tplv-k3u1fbpfcp-zoom-1.image" width="100%" referrerpolicy="no-referrer"></div>

åœ¨æœ¬æ–‡ä¸­ï¼ŒShowMeAI å°†èšç„¦äºæ—¶é—´åºåˆ—ï¼Œä»‹ç»é™¤ **åå¤„ç†/post processing** æ¨¡å—ä¹‹å¤–çš„æ‰€æœ‰éƒ¨åˆ†ï¼ˆå› ä¸ºè¿™ä¸ªéƒ¨åˆ†ä»…ç”¨äºå¼‚å¸¸æ£€æµ‹ï¼Œå¹¶ä¸ä¸€å®šä¸æ—¶é—´åºåˆ—é—®é¢˜ç›¸å…³ï¼‰ã€‚

## ğŸ’¡ æ•°æ®åŠ è½½

Merlion çš„æ•°æ®ç»“æ„æ˜¯ `TimeSeries`ï¼Œæ”¯æŒ**å¤šå˜é‡**å’Œ**å•å˜é‡**æ—¶é—´åºåˆ—ã€‚å…¶åº•å±‚æ˜¯å¯¹ä¸€ç³»åˆ— `UnivariateTimeSeries` è¿›è¡Œçš„å°è£…ã€‚

ä¸ºäº†å°†æ•°æ®æ”¾å…¥æ‰€éœ€çš„æ•°æ®ç»“æ„ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ `TimeSeries` çš„å‡½æ•° `.from_pd()`ã€‚è¿™ä¸ªå‡½æ•°æ¥å—å¸¦æœ‰ DatetimeIndex çš„ DataFrame ä½œä¸ºè¾“å…¥ï¼Œå¹¶ä¸”é»˜è®¤æ£€æŸ¥æ¯ä¸ªç´¢å¼•æ˜¯å¦å”¯ä¸€ä»¥åŠæ˜¯å¦è®¾ç½®äº†é¢‘ç‡ freqï¼ˆé»˜è®¤1hï¼‰ã€‚

ä»¥ä¸‹ä¸ºä» pandas DataFrame åŠ è½½å•å˜é‡æ—¶é—´åºåˆ—çš„ç¤ºä¾‹ä»£ç ã€‚

```python
# æ²¡æœ‰ç¼ºå¤±å€¼æƒ…å†µçš„ç®€å•æ¡ˆä¾‹
from merlion.utils import TimeSeries
import pandas as pd
import numpy as np


# æ³¨æ„ï¼Œè¿™é‡Œéœ€è¦æ‰‹åŠ¨è®¾ç½®freqå‚æ•°ï¼Œå¦åˆ™æ•°æ®ä¼šæ··ä¹±
ts_series = pd.Series(data = [20, 21, 25, 18],
                      index = pd.date_range('2020-04-01', '2020-04-04', freq='D'),
                      name = 'v'
                     )
ts_df = pd.DataFrame(ts_series)

# æ„å»ºTimeSerieså¯¹è±¡
ts = TimeSeries.from_pd(ts_df)
```

å¦‚æœè¾“å…¥çš„ã€**å•å˜é‡æ—¶é—´åºåˆ—**ã€åŒ…å«ç¼ºå¤±å€¼æˆ– nan å€¼ï¼ŒMerlion ä¼šåˆ é™¤å®ƒä»¬åŠå…¶å¯¹åº”çš„ç´¢å¼•ã€‚

åœ¨è¾“å…¥ã€**å¤šå…ƒæ—¶é—´åºåˆ—**ã€é¢ä¸´**å¤šåºåˆ—ä¸å¯¹é½**çš„æƒ…å†µæ—¶ï¼ŒMerlion å·¥å…·åº“å¯ä»¥æ£€æŸ¥å¤šå…ƒæ—¶é—´åºåˆ—ã€æ˜¯å¦åŒ…å«ä»»ä½•ç¼ºå¤±å€¼ã€æˆ–ã€æ¯ä¸ªå˜é‡çš„ç´¢å¼•æ˜¯å¦æœªå¯¹é½ã€ï¼ˆè°ƒç”¨ `TimeSeries` çš„ `.is_aligned` å±æ€§ï¼‰ã€‚å¦‚æœæ²¡æœ‰å¯¹é½ï¼ˆ`.is_aligned` å±æ€§ä¸º `False`ï¼‰ï¼Œå¯ä»¥è°ƒç”¨ `.align()` å‡½æ•°å¯¹å…¶è¿›è¡Œä¿®å¤å¯¹é½ã€‚

```python
# æ— ç¼ºå¤±çš„ç®€å•æƒ…å†µ
from merlion.utils import TimeSeries
import pandas as pd
import numpy as np

# å¤šå…ƒæ—¶é—´åºåˆ—
ts_series_1 = pd.Series(data = [20, 21, 25, 18],
                      index = pd.date_range('2020-04-01', '2020-04-04', freq='D')
                     )
ts_series_2 = pd.Series(data = [20, 21, np.nan, 18],
                      index = pd.date_range('2020-04-01', '2020-04-04', freq='D')
                     )
ts_df = pd.DataFrame({'v1': ts_series_1, 'v2': ts_series_2})


# åŸºäºDataframeæ„å»ºTimeSerieså¯¹è±¡
ts = TimeSeries.from_pd(ts_df)

# è¾“å‡ºæ˜¯å¦å¯¹é½
print(ts.is_aligned)

# å¯¹é½æ“ä½œ
ts_aligned = ts.align()
print(ts_aligned.is_aligned)
```

é»˜è®¤æƒ…å†µä¸‹ï¼Œ`.align()` å‡½æ•°å°†åˆå¹¶ä»»ä½•å•ä¸ªå•å˜é‡ä¸­å­˜åœ¨çš„æ‰€æœ‰æ—¶é—´æˆ³ï¼Œå¹¶ä½¿ç”¨**çº¿æ€§æ’å€¼**æ¥ä¼°ç®—ç¼ºå¤±å€¼ã€‚

### åˆ‡ç‰‡å’Œåˆ†å‰²

é™¤äº† `.align()` å‡½æ•°ï¼ŒMerlion å¸¦æœ‰å¦å¤–ä¸¤ä¸ªæ–¹ä¾¿çš„å‡½æ•°ï¼š

- `.window(t0, tf)` ï¼šåœ¨`t0`å’Œ `tf` èŒƒå›´ä¹‹é—´åˆ‡å‡ºä¸€ä¸ªå­é›†ï¼Œè¾“å…¥å‚æ•°å¯ä»¥æ˜¯ä»»ä½•åˆç†çš„æ—¥æœŸæ—¶é—´æ ¼å¼ï¼Œä¹Ÿå¯ä»¥æ˜¯ Unix æ—¶é—´æˆ³ã€‚
- `.bisect(t)` ï¼šç±»ä¼¼äº `.window()`ï¼Œå°†æ—¶é—´åºåˆ—åˆ†æˆå·¦å³éƒ¨åˆ†ã€‚

### é¢„å¤„ç†

Merlion æä¾›å¸¸è§çš„æ•°æ® **é¢„å¤„ç†è½¬æ¢æŠ€æœ¯** ï¼Œä¾‹å¦‚æœ€å°-æœ€å¤§å½’ä¸€åŒ–ã€å¹‚å˜æ¢ (box-cox) æˆ–æŒ‡æ•°ç§»åŠ¨å¹³å‡ã€‚å®Œæ•´é¢„å¤„ç†æ–¹æ³•åˆ—è¡¨å¯ä»¥åœ¨ğŸ“˜[**è¿™é‡Œ**](https://opensource.salesforce.com/Merlion/latest/merlion.transform.html#module-merlion.transform.moving_average) æŸ¥çœ‹ã€‚

æ¯”å¦‚ä¸‹åˆ—ä»£ç å°±æ˜¯åœ¨å»ºæ¨¡æ­¥éª¤ä¹‹å‰ä½¿ç”¨ã€**æœ€å°** **-** **æœ€å¤§å½’ä¸€åŒ–**ã€å¯¹æ•°æ®é¢„å¤„ç†ï¼š

```python
from merlion.transform.normalize import MinMaxNormalize
# åˆå§‹åŒ–æ•°æ®é¢„å¤„ç†å™¨
transform = MinMaxNormalize()
# æ‹Ÿåˆ
transform.train(ts_aligned)
# åº”ç”¨é¢„å¤„ç†å™¨å˜æ¢
ts_transformed = transform(ts_aligned)
# é€†å˜æ¢
transform.invert(ts_transformed)
```

## ğŸ’¡ æ¨¡å‹åº“

<div align=center><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/41304defd7014bea80ed8a38bda9ab4e~tplv-k3u1fbpfcp-zoom-1.image" width="100%" referrerpolicy="no-referrer"></div>



Merlion æä¾›äº†ä¸€ç³»åˆ—ä¸åŒçš„æ¨¡å‹ï¼Œå¯ä»¥ç”¨äºæ—¶é—´åºåˆ—ç­‰é—®é¢˜ï¼š

- **ARIMA** ï¼ˆè‡ªå›å½’ç»¼åˆç§»åŠ¨å¹³å‡çº¿ï¼‰
- **SARIMA** ï¼ˆå…·æœ‰ç”¨æˆ·æŒ‡å®šå­£èŠ‚æ€§çš„ ARIMAï¼‰
- **ETS** ï¼ˆè¯¯å·®ã€è¶‹åŠ¿ã€å­£èŠ‚æ€§ï¼‰
- **Prophet** ï¼ˆå›´ç»• Facebook çš„ Prophet çš„åŒ…è£…ï¼‰
- **Smoother** ï¼ˆç”¨äºå•å˜é‡æ—¶é—´åºåˆ—é¢„æµ‹çš„å¤šå°ºåº¦æŒ‡æ•°å¹³æ»‘å™¨ï¼‰
- **å‘é‡è‡ªå›å½’** ç”¨äºå¤šå…ƒæ—¶é—´åºåˆ—é¢„æµ‹çš„
- **Bagging** ï¼ˆéšæœºæ£®æ—ï¼‰å’Œ **æå‡æ ‘**ï¼ˆlightgbmï¼‰
- **é•¿çŸ­æœŸè®°å¿†ç½‘ç»œ**

<div align=center><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/86524f54e1e74217ac06560d1c6daf6b~tplv-k3u1fbpfcp-zoom-1.image" width="70%" referrerpolicy="no-referrer"></div>

å¤§å®¶ä¹Ÿå¯ä»¥ ğŸ“˜[**åœ¨è¿™é‡Œ**](<https://opensource.salesforce.com/Merlion/latest/examples/forecast/3_ForecastNewModel.html>) å®šä¹‰è‡ªå·±çš„æ¨¡å‹ã€‚

<div align=center><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/18f65678f155439d821339b3689c63da~tplv-k3u1fbpfcp-zoom-1.image" width="70%" referrerpolicy="no-referrer"></div>

ä¸‹é¢çš„ä¾‹å­åŸºäº ğŸ“˜[**èˆªç©ºä¹˜å®¢æ•°æ®é›†**](https://pkg.robjhyndman.com/fma/reference/airpass.html)ï¼Œè¿›è¡Œæ—¶é—´åºåˆ—å»ºæ¨¡å±•ç¤ºã€‚

> ğŸ† **å®æˆ˜æ•°æ®é›†ä¸‹è½½ï¼ˆç™¾åº¦ç½‘ç›˜ï¼‰**ï¼šå…¬ä¼—å·ã€ShowMeAIç ”ç©¶ä¸­å¿ƒã€å›å¤ã€**å®æˆ˜**ã€ï¼Œæˆ–è€…ç‚¹å‡» [**è¿™é‡Œ**](http://www.showmeai.tech/article-detail/305) è·å–æœ¬æ–‡ [[15] ä½¿ç”¨ Merlion åº“å¿«é€Ÿå¼€å‘æ—¶é—´åºåˆ—æ¨¡å‹](http://www.showmeai.tech/article-detail/288) ã€**Monthly Airline Passenger Numbers 1949-1960 æ•°æ®é›†**ã€ 

> â­ **ShowMeAIå®˜æ–¹GitHub**ï¼š[https://github.com/ShowMeAI-Hub](https://github.com/ShowMeAI-Hub)



```python
import pandas as pd
from merlion.utils import TimeSeries
# åŠ è½½æ•°æ®
air_pass = pd.read_csv("airline-passengers.csv")
# æŠŠæ—¥æœŸè®¾ç½®ä¸ºç´¢å¼•
air_pass.set_index('Month', inplace=True)
air_pass.index = pd.to_datetime(air_pass.index)
# ä¸€å®šè¦ç¡®ä¿freqè®¾å®šå¥½
air_pass.index.freq = 'MS'


# è¯»å–ä¸ºTimeSerieså¯¹è±¡
air_pass_ts = TimeSeries.from_pd(air_pass, freq='MS')
print(air_pass_ts.is_aligned)


# ä½¿ç”¨ .bisect() å‡½æ•°åˆ‡åˆ†æ•°æ®ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†
# æˆ‘ä»¬å¸Œæœ›é¢„ä¼°æœªæ¥6ä¸ªæœˆçš„ä¹˜å®¢é‡
air_pass_ts_train, air_pass_ts_test = air_pass_ts.bisect('1960-07-01')
```

ä¸Šè¿°ä»£ç ä¸­ï¼šæˆ‘ä»¬é¦–å…ˆè¯»å–æ•°æ®ä¸º DataFrame æ ¼å¼ï¼Œå†å°†å…¶è½¬æ¢ä¸º Merlion çš„ TimeSeries æ•°æ®ç»“æ„ï¼Œä¹‹åæ£€æŸ¥æ•°æ®é›†æ˜¯å¦å¯¹é½ï¼ˆæ¯”å¦‚æœ‰æ²¡æœ‰ç¼ºå¤±çš„ç´¢å¼•ï¼‰ï¼Œæœ€åæˆ‘ä»¬å¯ä»¥å°†æ•°æ®æ‹†åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ã€‚

```python
from merlion.models.forecast.trees import LGBMForecaster, LGBMForecasterConfig
# è®¾å®šæ¨¡å‹é…ç½®
lgbm_config = LGBMForecasterConfig(maxlags = 30,
                                   max_forecast_steps=len(air_pass_ts_test)
                                  )
# åˆå§‹åŒ–æ¨¡å‹
lgbm = LGBMForecaster(lgbm_config)
# æ‹Ÿåˆæ¨¡å‹
lgbm.train(air_pass_ts_train)
# é¢„ä¼°
lgbm_fc = lgbm.forecast(air_pass_ts_test.time_stamps)
```

ä¸Šè¿°ä»£ç ä½¿ç”¨ LightGBM æ¨¡å‹ï¼ŒåŸºäºè¿‡å»çš„æ•°æ®å¯¹æœªæ¥è¿›è¡Œé¢„æµ‹ã€‚å¦‚æœæˆ‘ä»¬æƒ³å¯è§†åŒ–é¢„æµ‹ç»“æœï¼Œå¯ä»¥ä½¿ç”¨ Merlion ä¸­çš„ä¸¤ç§æ–¹æ³•ï¼š

- `.plot_forecast()`
- `.plot_forecast_plotly()`

ä¸‹é¢ä¸ºç»˜å›¾ç¤ºä¾‹ä»£ç ã€‚

```python
import matplotlib.pyplot as plt
fig, ax = lgbm.plot_forecast(time_series=air_pass_ts_test)
plt.show()
```

æˆ‘ä»¬å¾—åˆ°å¦‚ä¸‹çš„é¢„ä¼°ç»“æœå’ŒçœŸå®ç»“æœå¯¹æ¯”å›¾ã€‚

<div align=center><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d8f07f1003604fae943fc702b49f9756~tplv-k3u1fbpfcp-zoom-1.image" width="70%" referrerpolicy="no-referrer"></div>

å¤§å®¶å¯èƒ½çœ‹å‡ºæ¥äº†ï¼Œè¿™ä¸ªé¢„ä¼°ç»“æœå¹¶ä¸æ˜¯å¤ªå¥½ï¼Œæˆ‘ä»¬å¯ä»¥åšè¿›ä¸€æ­¥çš„è°ƒæ•´ä¼˜åŒ–ï¼ˆä¾‹å¦‚ä½¿ç”¨ä¸åŒçš„å‚æ•°æˆ–å˜æ¢ï¼‰ã€‚æˆ‘ä»¬è¿™é‡Œåªåšå¯è§†åŒ–çš„æ¼”ç¤ºï¼Œæš‚æ—¶ä¸çº ç»“é¢„ä¼°æ•ˆæœã€‚

## ğŸ’¡ è‡ªåŠ¨æœºå™¨å­¦ä¹ 

å¯¹æ¨¡å‹è¿›è¡Œè¶…å‚æ•°è°ƒä¼˜ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆéº»çƒ¦çš„äº‹æƒ…ï¼Œä½† Merlion é™„å¸¦äº†ä¸€ä¸ª AutoML åŒ…ï¼Œå®ƒæ”¯æŒï¼š

- SARIMA çš„è‡ªåŠ¨è¶…å‚æ•°é€‰æ‹©
- è‡ªåŠ¨å­£èŠ‚æ€§æ£€æµ‹
- Facebook Prophet çš„è‡ªåŠ¨ï¼ˆå¤šï¼‰å­£èŠ‚æ€§æ£€æµ‹
- ETS çš„è‡ªåŠ¨å­£èŠ‚æ€§æ£€æµ‹

ä»¥ä¸‹ç¤ºä¾‹ä½¿ç”¨ä¸ä¸Šè¿°ç›¸åŒçš„æ•°æ®é›†ï¼Œå¹¶å±•ç¤ºäº†å¦‚ä½•å°† AutoML ç”¨äº SARIMA æ¨¡å‹ã€‚

```python
from merlion.models.automl.autosarima import AutoSarima, AutoSarimaConfig


sarima_config = AutoSarimaConfig(auto_pqPQ=True, auto_d=True, auto_D=True, auto_seasonality=True,
                           approximation=True, maxiter=5)
sarima = AutoSarima(sarima_config)


# æ¨¡å‹è®­ç»ƒ
train_pred, train_err = sarima.train(
    air_pass_ts_train, train_config={"enforce_stationarity": True,
                              "enforce_invertibility": True}
)
sarima_fc = sarima.forecast(air_pass_ts_test.time_stamps)
```

## ğŸ’¡ æ¨¡å‹é€‰æ‹©ä¸æ¨¡å‹é›†æˆ

Merlion æä¾›äº†ä¸¤ç§å¸¸ç”¨çš„æ¨¡å‹é›†æˆæŠ€æœ¯ï¼š

- â‘  å¯¹å¤šä¸ªæ¨¡å‹å–**å¹³å‡å€¼**æˆ–**ä¸­ä½æ•°**çš„ä¼ ç»Ÿé›†æˆæ–¹æ³•
- â‘¡ è‡ªåŠ¨æ¨¡å‹é€‰æ‹©

æˆ‘ä»¬å…ˆçœ‹çœ‹ä¼ ç»Ÿé›†æˆæ–¹æ³•çš„åº”ç”¨ï¼š

```python
# ä½¿ç”¨lgbmå’Œautosarimaä¸¤ä¸ªæ–¹æ³•
from merlion.models.forecast.trees import LGBMForecaster, LGBMForecasterConfig
from merlion.models.automl.autosarima import AutoSarima, AutoSarimaConfig


# ä½¿ç”¨æ¨¡å‹é›†æˆæŠ€æœ¯
from merlion.evaluate.forecast import ForecastMetric
from merlion.models.ensemble.combine import Mean, ModelSelector
from merlion.models.ensemble.forecast import ForecasterEnsemble, ForecasterEnsembleConfig


# è®¾å®šè®­ç»ƒè®¾ç½®
from merlion.models.ensemble.base import EnsembleTrainConfig

# å®šä¹‰æ¨¡å‹
lgbm_config = LGBMForecasterConfig(maxlags = 30, max_forecast_steps=len(air_pass_ts_test))
lgbm = LGBMForecaster(lgbm_config)


sarima_config = AutoSarimaConfig(auto_pqPQ=True, auto_d=True, auto_D=True, auto_seasonality=True, approximation=True, maxiter=5)
sarima = AutoSarima(sarima_config)


# ä¼ ç»Ÿé›†æˆï¼Œå¤šæ¨¡å‹æ±‚å‡å€¼
ensemble_config = ForecasterEnsembleConfig(
    combiner=Mean(), models=[lgbm,sarima]
)


# é›†æˆé…ç½®
# æˆ‘ä»¬ä½¿ç”¨20%çš„æ•°æ®ä½œä¸ºéªŒè¯é›†
ensemble_train_config = EnsembleTrainConfig(valid_frac=0.2,
                                            per_model_train_configs=[None,{
                                                "enforce_stationarity": True,
                                                 "enforce_invertibility": True
                                            }])
# è®­ç»ƒä¸é¢„æµ‹
ensemble = ForecasterEnsemble(config=ensemble_config)
ensemble.train(air_pass_ts_train,train_config=ensemble_train_config)
ensemble.forecast(air_pass_ts_test.time_stamps)
```

ä¸‹é¢çš„ä»£ç æ˜¯è‡ªåŠ¨æ¨¡å‹é€‰æ‹©çš„æ–¹æ³•ç¤ºä¾‹ä»£ç ï¼š

```python
# ä½¿ç”¨lgbmå’Œautosarimaä¸¤ä¸ªæ–¹æ³•
from merlion.models.forecast.trees import LGBMForecaster, LGBMForecasterConfig
from merlion.models.automl.autosarima import AutoSarima, AutoSarimaConfig


# ä½¿ç”¨é›†æˆæŠ€æœ¯
from merlion.evaluate.forecast import ForecastMetric
from merlion.models.ensemble.combine import Mean, ModelSelector
from merlion.models.ensemble.forecast import ForecasterEnsemble, ForecasterEnsembleConfig


# é€šè¿‡è¯„ä¼°æŒ‡æ ‡æ¥é€‰æ‹©æ¨¡å‹
from merlion.evaluate.forecast import ForecastMetric


# å®šä¹‰æ¨¡å‹
lgbm_config = LGBMForecasterConfig(maxlags = 5, max_forecast_steps=len(air_pass_ts_test))
lgbm = LGBMForecaster(lgbm_config)

sarima_config = AutoSarimaConfig(auto_pqPQ=True, auto_d=True, auto_D=True, auto_seasonality=True, approximation=True, maxiter=5)
sarima = AutoSarima(sarima_config)

# é€šè¿‡sMAPEæŒ‡æ ‡é€‰æ‹©æœ€ä½³æ¨¡å‹
selector_config = ForecasterEnsembleConfig(
    combiner=ModelSelector(metric=ForecastMetric.sMAPE))
selector = ForecasterEnsemble(
    config=selector_config, models=[lgbm, sarima])

selector.train(air_pass_ts_train)
selector.forecast(air_pass_ts_test.time_stamps)
```

<div align=center><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c5e95b763d8f4fed84c42d9e89c2160c~tplv-k3u1fbpfcp-zoom-1.image" width="70%" referrerpolicy="no-referrer"></div>

é™¤äº† sMAPE Merlion è¿˜æ”¯æŒè®¸å¤šå…¶ä»–é”™è¯¯æŒ‡æ ‡ï¼Œä¾‹å¦‚ MAE æˆ– RMSEï¼Œå®Œæ•´åˆ—è¡¨å¯ä»¥æŸ¥çœ‹ ğŸ“˜[**è¿™é‡Œ**](https://opensource.salesforce.com/Merlion/latest/merlion.evaluate.html#module-merlion.evaluate.forecast)ã€‚

## ğŸ’¡ å­˜å‚¨å’ŒåŠ è½½æ¨¡å‹

å¦‚æœæ‚¨æƒ³å­˜å‚¨è®­ç»ƒè¿‡çš„æ¨¡å‹æˆ–åŠ è½½ï¼Œç°æœ‰çš„ Merlion çš„æ‰€æœ‰æ¨¡å‹éƒ½å¸¦æœ‰ `.save()` å’Œ `.load()` ç±»æ–¹æ³•ã€‚æ‚¨è¿˜å¯ä»¥åœ¨é€‚ç”¨äºä»»æ„æ¨¡å‹çš„ modelFactory åŒ…çš„å¸®åŠ©ä¸‹åŠ è½½æ¨¡å‹ã€‚è¿™ `.save()` æ–¹æ³•åœ¨ç»™å®šè·¯å¾„åˆ›å»ºä¸€ä¸ªæ–°ç›®å½•ï¼Œå®ƒå­˜å‚¨æ¨¡å‹çš„é…ç½®ï¼ˆjsonï¼‰ä»¥åŠå®ƒçš„çŠ¶æ€ï¼ˆäºŒè¿›åˆ¶ï¼‰ã€‚

ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†æˆ‘ä»¬å¦‚ä½•ä»ä¸Šé¢çš„é›†æˆç¤ºä¾‹ä¸­ä¿å­˜å’ŒåŠ è½½æ¨¡å‹ã€‚

```python
# å­˜å‚¨ä¸åŠ è½½æ¨¡å‹
from merlion.models.factory import ModelFactory
import json
import pprint

# æˆ‘ä»¬åªä¿å­˜ä½¿ç”¨äº†çš„æ¨¡å‹
selector.save("models",save_only_used_models=True)

# æˆ‘ä»¬è¾“å‡ºæ¨¡å‹é…ç½®çœ‹ä¸€ä¸‹
pp = pprint.PrettyPrinter()
with open("models/config.json") as f:
    pp.pprint(json.load(f))

# ä½¿ç”¨ForecasterEnsembleåŠ è½½æ¨¡å‹
selector_loaded = ForecasterEnsemble.load('models/')

# æˆ–è€…ä½¿ç”¨ModelFactoryåŠ è½½æ¨¡å‹
mdl_factory_selector = ModelFactory.load(name="ForecasterEnsemble", model_path='models/')
```

é»˜è®¤æƒ…å†µä¸‹ `.save()` æ–¹æ³•ä¼šå°†æ‰€æœ‰å®šä¹‰çš„æ¨¡å‹å­˜å‚¨åœ¨æˆ‘ä»¬æœ¬åœ°ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬è®¾ç½® `save_only_used_models=True`ï¼Œæ‰€ä»¥æˆ‘ä»¬åªå­˜å‚¨è¯„ä¼°æŒ‡æ ‡ sMAPE ä¸Šæ•ˆæœæœ€å¥½çš„æ¨¡å‹ã€‚ä¸è¿‡æˆ‘ä»¬åˆ›å»ºå¥½çš„é…ç½®æ–‡ä»¶åŒ…å«äº†æ‰€æœ‰é›†æˆæ¨¡å‹çš„å…ƒä¿¡æ¯ã€‚

## ğŸ’¡ è¯„ä¼°ç®¡é“(pipeline)

æœ€åè¦æåˆ°çš„æ˜¯ï¼ŒMerlion æœ‰ä¸€ä¸ªéå¸¸é…·çš„åŠŸèƒ½æ¥æ¨¡æ‹Ÿå®æ—¶æ¨¡å‹éƒ¨ç½²ã€‚è¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿæ ¹æ®ï¼ˆå¤šä¸ªï¼‰è¯„ä¼°æŒ‡æ ‡æ¥è¯„ä¼°æˆ‘ä»¬å¼€å‘çš„é¢„æµ‹å™¨çš„è´¨é‡ã€‚

è¿™ç§æ¨¡æ‹Ÿè¯„ä¼°ä¸æ»‘åŠ¨äº¤å‰éªŒè¯ï¼ˆrolling cross validationï¼‰éå¸¸ç›¸ä¼¼ï¼Œåœ¨æ—¶é—´åºåˆ—å»ºæ¨¡ä¸­æ˜¯å¾ˆå¸¸è§çš„éªŒè¯æ–¹æ³•ã€‚

ä¸‹è¿°ä»£ç æ˜¯æˆ‘ä»¬åœ¨ä¹‹å‰å¼€å‘çš„ lgbm æ¨¡å‹ä¸Šæ¨¡æ‹Ÿéƒ¨ç½²ï¼š

```python
from merlion.evaluate.forecast import ForecastEvaluator, ForecastEvaluatorConfig, ForecastMetric


def create_evaluator(model):
    # é‡æ–°åˆå§‹åŒ–æ¨¡å‹
    model.reset()
    evaluator = ForecastEvaluator(
        model=model, config=ForecastEvaluatorConfig(
            cadence="90d", horizon="180d", retrain_freq="90d", train_window="360d")
    )
    return evaluator

lgbm_evaluator = create_evaluator(lgbm)
lgbm_train_result, lgbm_test_result = lgbm_evaluator.get_predict(train_vals=air_pass_ts_train, test_vals=air_pass_ts_test)

rmse = lgbm_evaluator.evaluate(
    ground_truth=air_pass_ts_test,
    predict=lgbm_test_result,
    metric=ForecastMetric.RMSE)

print(f"{type(lgbm).__name__} RMSE:  {rmse:.3f}")
```

åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†é—´éš”è®¾ç½®ä¸º `90d` æ„å‘³ç€æ¯ 3 ä¸ªæœˆè®­ç»ƒæ¨¡å‹é¢„æµ‹æœªæ¥ 6 ä¸ªæœˆï¼ˆhorizon = `180d`ï¼‰ã€‚å…¶ä»–çš„å‚æ•°è®¾å®šï¼ŒåŒ…æ‹¬æ¨¡å‹æ¯ 3 ä¸ªæœˆé‡æ–°è®­ç»ƒä¸€æ¬¡ï¼ˆretrain_freq=`90d`) å¹¶ä½¿ç”¨ 12 ä¸ªæœˆï¼ˆtrain_window=360ï¼‰çš„è®­ç»ƒæ•°æ®ã€‚æœ€åï¼Œæˆ‘ä»¬è®¡ç®— *RMSE* æ¥è¯„ä¼°æˆ‘ä»¬æ¨¡å‹çš„æ€§èƒ½ã€‚

## ğŸ’¡ ç›¸å…³èµ„æº

- ğŸ† **å®æˆ˜æ•°æ®é›†ä¸‹è½½ï¼ˆç™¾åº¦ç½‘ç›˜ï¼‰**ï¼šå…¬ä¼—å·ã€ShowMeAIç ”ç©¶ä¸­å¿ƒã€å›å¤ã€**å®æˆ˜**ã€ï¼Œæˆ–è€…ç‚¹å‡» [**è¿™é‡Œ**](http://www.showmeai.tech/article-detail/305) è·å–æœ¬æ–‡ [[15] ä½¿ç”¨ Merlion åº“å¿«é€Ÿå¼€å‘æ—¶é—´åºåˆ—æ¨¡å‹](http://www.showmeai.tech/article-detail/288) ã€**Monthly Airline Passenger Numbers 1949-1960 æ•°æ®é›†**ã€ 
- â­ **ShowMeAIå®˜æ–¹GitHub**ï¼š[https://github.com/ShowMeAI-Hub](https://github.com/ShowMeAI-Hub)
- ğŸ“˜Â **Merlion æ—¶é—´åºåˆ—çš„æœºå™¨å­¦ä¹ åº“**: [https://github.com/salesforce/Merlion](https://github.com/salesforce/Merlion)
- ğŸ“˜Â **Merlionçš„æ–‡æ¡£**: [https://opensource.salesforce.com/Merlion/latest/](https://opensource.salesforce.com/Merlion/latest/)
- ğŸ“˜Â **Orbit å·¥å…·åº“**ï¼š[https://github.com/uber/orbit](https://github.com/uber/orbit)
- ğŸ“˜Â **Greykite å·¥å…·åº“**ï¼š[https://github.com/linkedin/greykite](https://github.com/linkedin/greykite)
- ğŸ“˜Â **Merlion å·¥å…·åº“**ï¼š[https://github.com/salesforce/Merlion](https://github.com/salesforce/Merlion)
- ğŸ“˜Â **Merlionï¼šæ—¶é—´åºåˆ—çš„æœºå™¨å­¦ä¹ åº“**:Â [https://github.com/salesforce/Merlion](https://github.com/salesforce/Merlion)
- ğŸ“˜Â **Merlion æ–‡æ¡£**:Â [https://opensource.salesforce.com/Merlion/latest/](https://opensource.salesforce.com/Merlion/latest/)

<a href="https://www.showmeai.tech/"><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e9190f41b8de4af38c8a1a0c96f0513b~tplv-k3u1fbpfcp-zoom-1.image" width="100%" referrerpolicy="no-referrer"></a>

> æˆ‘æ­£åœ¨å‚ä¸æ˜é‡‘æŠ€æœ¯ç¤¾åŒºåˆ›ä½œè€…ç­¾çº¦è®¡åˆ’æ‹›å‹Ÿæ´»åŠ¨ï¼Œ[ç‚¹å‡»é“¾æ¥æŠ¥åæŠ•ç¨¿](https://juejin.cn/post/7112770927082864653)ã€‚
