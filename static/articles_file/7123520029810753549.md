å¤§å®¶å¥½ï¼Œæœ€è¿‘å¼€å‘äº†ä¸€ä¸ªæ–°çš„é¡¹ç›®ï¼Œæˆ‘é€‰æ‹©äº†å‰ç«¯æœ€æ–°çš„æŠ€æœ¯æ ˆ  Vite2.x + Vue3 + TypeScript + Pinia, æ–‡ç« æ˜¯å¯¹è‡ªå·±çš„ä¸€ä¸ªæ€»ç»“ï¼Œä¹Ÿå¸Œæœ›ç»™å¤§å®¶å¸¦æ¥ä¸€äº›å¸®åŠ©ã€‚

### vite ä»‹ç»
-   ğŸ’¡ æé€Ÿçš„å¼€å‘æœåŠ¡å™¨å¯åŠ¨ (ä½¿ç”¨åŸç”Ÿ ESM æ–‡ä»¶ï¼Œæ— éœ€æ‰“åŒ…!)
-   âš¡ï¸ è½»é‡å¿«é€Ÿçš„çƒ­æ¨¡å—é‡è½½ (æ— è®ºåº”ç”¨ç¨‹åºå¤§å°å¦‚ä½•ï¼Œéƒ½å§‹ç»ˆæå¿«çš„æ¨¡å—çƒ­é‡è½½ï¼ˆHMRï¼‰)
-   ğŸ› ï¸ ä¸°å¯Œçš„åŠŸèƒ½ (å¯¹ TypeScriptã€JSXã€CSS ç­‰æ”¯æŒå¼€ç®±å³ç”¨ã€‚)
-   ğŸ“¦ è‡ªå¸¦ä¼˜åŒ–çš„æ„å»º (å¯é€‰ â€œå¤šé¡µåº”ç”¨â€ æˆ– â€œåº“â€ æ¨¡å¼çš„é¢„é…ç½® Rollup æ„å»º)
-   ğŸ”© é€šç”¨çš„æ’ä»¶æ¥å£ (åœ¨å¼€å‘å’Œæ„å»ºä¹‹é—´å…±äº« Rollup-superset æ’ä»¶æ¥å£ã€‚)
-   ğŸ”‘ å®Œå…¨ç±»å‹åŒ–çš„ API (çµæ´»çš„ API å’Œå®Œæ•´çš„ TypeScript ç±»å‹)

#### vue-cli å¯¹æ¯”

vue-cli:

Vue Cliä¼˜ç‚¹          | Vue Cliç¼ºç‚¹ |
| ------------------ | --------- |
| ç”Ÿæ€å¥½ï¼Œåº”ç”¨å®é™…é¡¹ç›®å¤š        | å¼€å‘ç¯å¢ƒæ…¢ï¼Œä½“éªŒå·® |
| å¯ä»¥å’ŒVue2.xï¼ŒVue3.xç»“åˆ | åªæ”¯æŒVue    |
| ç›´æ¥è§£æå„ç§ç±»å‹ä»£ç ä¾èµ–       | äº§ç‰©å†—ä½™ä»£ç å¤š   |
| æ„å»ºé…ç½®é¡¹ä¸°å¯Œï¼Œæ’ä»¶å…¨

Vite:

| Viteä¼˜ç‚¹       | Viteç¼ºç‚¹             |
| ------------ | ------------------ |
| å¼€å‘ç¯å¢ƒé€Ÿåº¦å¿«ï¼Œä½“éªŒå¥½  | åªé’ˆå¯¹ES6æµè§ˆå™¨          |
| æ”¯æŒVueï¼ŒReactç­‰ | è„šæ‰‹æ¶ä¸åŒ…æ‹¬Vuexï¼ŒRouterç­‰ |
| äº§ç‰©ç®€æ´æ¸…æ™°

#### ä½¿ç”¨
1. å®‰è£…vite
```shell
npm create vite@latest
````
2. é€‰æ‹©æ¨¡ç‰ˆç”Ÿæˆè„šæ‰‹æ¶
```shell
### npm 6.x 
npm create vite@latest my-vue-app --template vue 
### npm 7+, extra double-dash is needed: 
npm create vite@latest my-vue-app -- --template vue 
yarn yarn create vite my-vue-app --template vue 
pnpm pnpm create vite my-vue-app -- --template vue
```

æŸ¥çœ‹Â [create-vite](https://github.com/vitejs/vite/tree/main/packages/create-vite)Â ä»¥è·å–æ¯ä¸ªæ¨¡æ¿çš„æ›´å¤šç»†èŠ‚ï¼š`vanilla`ï¼Œ`vanilla-ts`ï¼Œ`vue`ï¼Œ`vue-ts`ï¼Œ`react`ï¼Œ`react-ts`ï¼Œ`preact`ï¼Œ`preact-ts`ï¼Œ`lit`ï¼Œ`lit-ts`ï¼Œ`svelte`ï¼Œ`svelte-ts`ã€‚

3. é…ç½®
åˆå§‹åŒ–å·¥ç¨‹åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨é¡¹ç›®æ–‡ä»¶å¤¹é‡Œçœ‹åˆ° vite.config.ts:
```ts
import { defineConfig } from "vite"
import vue from "@vitejs/plugin-vue"
import { resolve } from "path"
import Components from "unplugin-vue-components/vite"
import { AntDesignVueResolver } from "unplugin-vue-components/resolvers"
import svgLoader from "vite-svg-loader"

// è·¯å¾„æŸ¥æ‰¾
const pathResolve = (dir: string): string => {
  return resolve(__dirname, ".", dir)
}

// è®¾ç½®åˆ«å
const alias: Record<string, string> = {
  "@": pathResolve("src")
}

// https://vitejs.dev/config/
export default defineConfig({
  resolve: {
    alias
  },
  plugins: [
    vue(),
    Components({
      resolvers: [AntDesignVueResolver()]
    }),
    // svgç»„ä»¶åŒ–æ”¯æŒ
    svgLoader()
  ],
  server: {
    host: "0.0.0.0",
    proxy: {
      "/api": {
        target: "http://XXXX/",
        changeOrigin: true,
        rewrite: path => path.replace(/^\/api/, "")
      }
    }
  }
})
```

#### å¸¸ç”¨æ’ä»¶
1. å®˜æ–¹æ’ä»¶
@vitejs/plugin-vue: æä¾› Vue 3 å•æ–‡ä»¶ç»„ä»¶æ”¯æŒ<br>
@vitejs/plugin-vue-jsx: æä¾› Vue 3 JSX æ”¯æŒ<br>
@vitejs/plugin-react: æä¾›reactæ”¯æŒ<br>
@vitejs/plugin-legacy: ä¸ºæ‰“åŒ…åçš„æ–‡ä»¶æä¾›ä¼ ç»Ÿæµè§ˆå™¨æ”¯æŒ

2. æ¨èæ’ä»¶
```unplugin-vue-compoents```
æ˜¯ç”± Vueå®˜æ–¹äººå‘˜å¼€å‘çš„ä¸€æ¬¾è‡ªåŠ¨å¼•å…¥æ’ä»¶,å¯ä»¥çœå»å¤§é‡ importè¯­å¥ã€‚è¿™é‡Œä»¥ant-design-vueä¸ºä¾‹, åœ¨vite-config.tsé‡Œå¼•å…¥æ’ä»¶åï¼Œæˆ‘ä»¬åœ¨vueæ–‡ä»¶é‡Œå°±å¯ä»¥ä½¿ç”¨ant-desgin-vueçš„ä»»æ„ç»„ä»¶è€Œä¸éœ€è¦ä¸€ä¸ªä¸ªimportè¿›æ¥äº†ã€‚æ’ä»¶ä¹Ÿä¼šå¸®æˆ‘ä»¬ç”Ÿæˆä¸€ä¸ª components.d.ts æ–‡ä»¶å£°æ˜æˆ‘ä»¬é¡¹ç›®ä½¿ç”¨çš„ç»„ä»¶
```ts
import Components from "unplugin-vue-components/vite"
import { AntDesignVueResolver } from "unplugin-vue-components/resolvers"
export default defineConfig({
  plugins: [
    vue(),
    Components({
      resolvers: [AntDesignVueResolver()]
    })
  ]
})
```
```vite-svg-loader``` å¯ä»¥æŠŠsvgå›¾ç‰‡ç»„ä»¶åŒ–ã€‚
#### ç¯å¢ƒå˜é‡é…ç½®
```vite``` æä¾›äº†2ç§ç¯å¢ƒ ```å¼€å‘ç¯å¢ƒ``` å’Œ ```ç”Ÿäº§ç¯å¢ƒ```
å¯ä»¥åœ¨æ ¹ç›®å½•ä¸‹æ–°å»º ```.env.development``` ```.env.production``` æ¥åˆ†åˆ«å¯¹åº”å¼€å‘ç¯å¢ƒå˜é‡ å’Œ ç”Ÿäº§ç¯å¢ƒå˜é‡ã€‚ å½“è¿è¡Œ```npm run dev``` æ—¶ä¼šåŠ è½½å¼€å‘ç¯å¢ƒå˜é‡ï¼Œå½“è¿è¡Œ```npm run build```æ—¶ä¼šåŠ è½½ç”Ÿäº§ç¯å¢ƒå˜é‡ã€‚<br>
å¦‚æœé¡¹ç›®è¿˜éœ€è¦æµ‹è¯•ç¯å¢ƒï¼Œä¹Ÿå¯ä»¥æ–°å¢ ```.env.test```æ¥å®šä¹‰ç›¸å…³çš„ç¯å¢ƒå˜é‡ï¼Œåœ¨package.jsoné‡ŒæŒ‡å®šæ‰“åŒ…æµ‹è¯•ç¯å¢ƒçš„å‘½ä»¤
```json
"scripts": {
    "dev": "vite --port 8080",
    "build": "vue-tsc --noEmit && vite build",
    "testbuild": "vue-tsc --noEmit && vite build --mode test",
    },
```
åœ¨ç»„ä»¶ä¸­ä½¿ç”¨
```ts
const loadEnv = () => {
  return import.meta.env
}
const { VITE_PROXY_DOMAIN, VITE_PROXY_DOMAIN_REAL } = loadEnv()
```

æ³¨æ„ Vite é»˜è®¤æ˜¯ä¸åŠ è½½Â `.env`Â æ–‡ä»¶çš„ï¼Œå› ä¸ºè¿™äº›æ–‡ä»¶éœ€è¦åœ¨æ‰§è¡Œå®Œ Vite é…ç½®åæ‰èƒ½ç¡®å®šåŠ è½½å“ªä¸€ä¸ªï¼Œä¸¾ä¸ªä¾‹å­ï¼Œ`root`Â å’ŒÂ `envDir`Â é€‰é¡¹ä¼šå½±å“åŠ è½½è¡Œä¸ºã€‚ä¸è¿‡å½“ä½ çš„ç¡®éœ€è¦æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ Vite å¯¼å‡ºçš„Â `loadEnv`Â å‡½æ•°æ¥åŠ è½½æŒ‡å®šçš„Â `.env`Â æ–‡ä»¶ã€‚
```ts
import { defineConfig, loadEnv } from 'vite' 
export default defineConfig(({ command, mode }) => { 
// æ ¹æ®å½“å‰å·¥ä½œç›®å½•ä¸­çš„ `mode` åŠ è½½ .env æ–‡ä»¶ 
// è®¾ç½®ç¬¬ä¸‰ä¸ªå‚æ•°ä¸º '' æ¥åŠ è½½æ‰€æœ‰ç¯å¢ƒå˜é‡ï¼Œè€Œä¸ç®¡æ˜¯å¦æœ‰ `VITE_` å‰ç¼€ã€‚ 
const env = loadEnv(mode, process.cwd(), '') 
return { 
    // vite é…ç½® 
    define: { __APP_ENV__: env.APP_ENV } 
    } 
})
```

### vue3
1. ä¸vue2çš„åŒºåˆ«
(tsé‡å†™ã€optionApi-ã€‹compositionApiã€ç”Ÿå‘½å‘¨æœŸé’©å­ã€ç¢ç‰‡åŒ–ã€)
2. steup å’Œ defineComposition
### TypeScript
![TypeScript.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9ff89074510443bb9222bbd2def7c5a7~tplv-k3u1fbpfcp-watermark.image?)
### ä»£ç é£æ ¼çº¦æŸ
å…³äºeslintå’Œprettier å¤§å®¶å¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« ï¼Œè®²å¾—æ¸…æ™°å…¨é¢ [ä¼ é€é—¨](https://juejin.cn/post/6990929456382607374)
### è·¯ç”±

```shell
# å®‰è£…è·¯ç”±
yarn add vue-router@4
```
åœ¨Â `src`Â æ–‡ä»¶ä¸‹æ–°å¢Â `router`Â æ–‡ä»¶å¤¹ =>Â `router.ts`Â æ–‡ä»¶,å†…å®¹å¦‚ä¸‹:

```ts
import { createRouter, createWebHistory, RouteRecordRaw } from 'vue-router'

const routes: RouteRecordRaw[] = [
  {
    path: '/',
    name: 'Login',
    component: () => import('@/pages/login/Login.vue'), // æ³¨æ„è¿™é‡Œè¦å¸¦ä¸Š æ–‡ä»¶åç¼€.vue
  },
]

const router: Router = createRouter({
  history: createWebHistory(), // createWebHashHistory()
  routes: routes,
  strict: true,
  scrollBehavior(to, from, savedPosition) {
    return new Promise(resolve => {
      if (savedPosition) {
        return savedPosition
      } else {
        if (from.meta.saveSrollTop) {
          const top: number =
            document.documentElement.scrollTop || document.body.scrollTop
          resolve({ left: 0, top })
        }
      }
    })
  }
})

router.beforeEach((to, from, next) => {
  nProgress.start()
  if (to.path !== "/login" && !getAuth()) {
    next("/login")
  }
  if (to.path === "/login") {
    removeAuth()
  }
  next()
})

router.afterEach((to, from) => {
  nProgress.done()
})

export default router

```

ä¿®æ”¹å…¥å£æ–‡ä»¶Â `main.ts`Â :

```js
import { createApp } from 'vue'
import App from './App.vue'
import router from './router/index'

const app = createApp(App)

app.use(router)

app.mount('#app')

```

åˆ°è¿™é‡Œè·¯ç”±çš„åŸºç¡€é…ç½®å·²ç»å®Œæˆäº†,æ›´å¤šé…ç½®ä¿¡æ¯å¯ä»¥æŸ¥çœ‹Â `vue-router`Â å®˜æ–¹æ–‡æ¡£:

> vue-router:Â `https://next.router.vuejs.org/zh/guide/`


`vue-router4.x` æ”¯æŒ `typescript`ï¼Œé…ç½®è·¯ç”±çš„ç±»å‹æ˜¯ `RouteRecordRaw`ï¼Œè¿™é‡Œ `meta` å¯ä»¥è®©æˆ‘ä»¬æœ‰æ›´å¤šçš„å‘æŒ¥ç©ºé—´ï¼Œè¿™é‡Œæä¾›ä¸€äº›å‚è€ƒï¼š

-   `title`:`string`; é¡µé¢æ ‡é¢˜ï¼Œé€šå¸¸å¿…é€‰ã€‚
-   `icon?`:`string`; å›¾æ ‡ï¼Œä¸€èˆ¬é…åˆèœå•ä½¿ç”¨ã€‚
-   `auth?`:`boolean`; æ˜¯å¦éœ€è¦ç™»å½•æƒé™ã€‚
-   `ignoreAuth?`:`boolean`; æ˜¯å¦å¿½ç•¥æƒé™ã€‚
-   `roles?`:`RoleEnum[]`; å¯ä»¥è®¿é—®çš„è§’è‰²
-   `keepAlive?`:`boolean`; æ˜¯å¦å¼€å¯é¡µé¢ç¼“å­˜
-   `hideMenu?`:`boolean`; æœ‰äº›è·¯ç”±æˆ‘ä»¬å¹¶ä¸æƒ³åœ¨èœå•ä¸­æ˜¾ç¤ºï¼Œæ¯”å¦‚æŸäº›ç¼–è¾‘é¡µé¢ã€‚
-   `order?`:`number`; èœå•æ’åºã€‚
-   `frameUrl?`:`string`; åµŒå¥—å¤–é“¾ã€‚

### æ¥å£è¯·æ±‚å¯¹è±¡

```ts
# å®‰è£… axios
yarn add axios
# å®‰è£… nprogress ç”¨äºè¯·æ±‚ loading
# ä¹Ÿå¯ä»¥æ ¹æ®é¡¹ç›®éœ€æ±‚è‡ªå®šä¹‰å…¶å®ƒ loading
yarn add nprogress
yarn add @types/nprogress --dev
```

å°è£…httpå¯¹è±¡
```ts
import Axios, { AxiosInstance, AxiosRequestConfig } from "axios"
import {
  PureHttpError,
  RequestMethods,
  PureHttpResponse,
  PureHttpRequestConfig
} from "./types.d"
import qs from "qs"
import NProgress from "../progress"
import { message } from "ant-design-vue"
import { useUserStoreHook } from "@/store/user"

const loadEnv = () => {
  return import.meta.env
}

// åŠ è½½ç¯å¢ƒå˜é‡ VITE_PROXY_DOMAINï¼ˆå¼€å‘ç¯å¢ƒï¼‰  VITE_PROXY_DOMAIN_REALï¼ˆæ‰“åŒ…åçš„çº¿ä¸Šç¯å¢ƒï¼‰
const { VITE_PROXY_DOMAIN, VITE_PROXY_DOMAIN_REAL } = loadEnv()

// ç›¸å…³é…ç½®è¯·å‚è€ƒï¼šwww.axios-js.com/zh-cn/docs/#axios-request-config-1
const defaultConfig: AxiosRequestConfig = {
  baseURL:
    process.env.NODE_ENV === "production" || process.env.NODE_ENV === "test"
      ? VITE_PROXY_DOMAIN_REAL
      : VITE_PROXY_DOMAIN,
  // å½“å‰ä½¿ç”¨mockæ¨¡æ‹Ÿè¯·æ±‚ï¼Œå°†baseURLåˆ¶ç©ºï¼Œå¦‚æœä½ çš„ç¯å¢ƒç”¨åˆ°äº†httpè¯·æ±‚ï¼Œè¯·åˆ é™¤ä¸‹é¢çš„baseURLå¯ç”¨ä¸Šé¢çš„baseURLï¼Œå¹¶å°†11è¡Œã€16è¡Œä»£ç æ³¨é‡Šå–æ¶ˆ
  // baseURL: "/api",
  timeout: 10000,
  headers: {
    Accept: "application/json, text/plain, */*",
    "Content-Type": "application/json",
    "X-Requested-With": "XMLHttpRequest"
  }
  // withCredentials: true
  // æ•°ç»„æ ¼å¼å‚æ•°åºåˆ—åŒ–
  // paramsSerializer: params => qs.stringify(params, { indices: false })
}

class PureHttp {
  constructor() {
    this.httpInterceptorsRequest()
    this.httpInterceptorsResponse()
  }
  // åˆå§‹åŒ–é…ç½®å¯¹è±¡
  private static initConfig: PureHttpRequestConfig = {}

  // ä¿å­˜å½“å‰Axioså®ä¾‹å¯¹è±¡
  private static axiosInstance: AxiosInstance = Axios.create(defaultConfig)
  private interfaceTimeOut = false
  // è¯·æ±‚æ‹¦æˆª
  private httpInterceptorsRequest(): void {
    PureHttp.axiosInstance.interceptors.request.use(
      (config: PureHttpRequestConfig) => {
        const $config = config
        // å¼€å¯è¿›åº¦æ¡åŠ¨ç”»
        NProgress.start()
        // ä¼˜å…ˆåˆ¤æ–­post/getç­‰æ–¹æ³•æ˜¯å¦ä¼ å…¥å›æ‰ï¼Œå¦åˆ™æ‰§è¡Œåˆå§‹åŒ–è®¾ç½®ç­‰å›æ‰
        if (typeof config.beforeRequestCallback === "function") {
          config.beforeRequestCallback($config)
          return $config
        }
        if (PureHttp.initConfig.beforeRequestCallback) {
          PureHttp.initConfig.beforeRequestCallback($config)
          return $config
        }
        // const token = "1234567"
        // if (token) {
        //   const data = JSON.parse(token)
        //   config.headers["Authorization"] = "Bearer " + data.accessToken
        //   return $config
        // } else {
        //   return $config
        // }
        return $config
      },
      error => {
        return Promise.reject(error)
      }
    )
  }

  // å“åº”æ‹¦æˆª
  private httpInterceptorsResponse(): void {
    const instance = PureHttp.axiosInstance
    instance.interceptors.response.use(
      (response: PureHttpResponse) => {
        const $config = response.config
        // å…³é—­è¿›åº¦æ¡åŠ¨ç”»
        NProgress.done()
        // ä¼˜å…ˆåˆ¤æ–­post/getç­‰æ–¹æ³•æ˜¯å¦ä¼ å…¥å›æ‰ï¼Œå¦åˆ™æ‰§è¡Œåˆå§‹åŒ–è®¾ç½®ç­‰å›æ‰
        if (typeof $config.beforeResponseCallback === "function") {
          $config.beforeResponseCallback(response)
          return response.data
        }
        if (PureHttp.initConfig.beforeResponseCallback) {
          PureHttp.initConfig.beforeResponseCallback(response)
          return response.data
        }
        // ç»Ÿä¸€é”™è¯¯ä¿¡æ¯æç¤º
        if (
          response.data.code &&
          response.data.code !== 0 &&
          response.data.code !== 10010
        ) {
          message.error(response.data.msg)
        }
        return response.data
      },
      (error: PureHttpError) => {
        const $error = error
        $error.isCancelRequest = Axios.isCancel($error)
        // å…³é—­è¿›åº¦æ¡åŠ¨ç”»
        NProgress.done()
        // æ‰€æœ‰çš„å“åº”å¼‚å¸¸ åŒºåˆ†æ¥æºä¸ºå–æ¶ˆè¯·æ±‚/éå–æ¶ˆè¯·æ±‚
        return Promise.reject($error)
      }
    )
  }

  // é€šç”¨è¯·æ±‚å·¥å…·å‡½æ•°
  public request<T>(
    method: RequestMethods,
    url: string,
    param?: AxiosRequestConfig,
    axiosConfig?: PureHttpRequestConfig
  ): Promise<T> {
    const config = {
      method,
      url,
      ...param,
      ...axiosConfig
    } as PureHttpRequestConfig

    // å•ç‹¬å¤„ç†è‡ªå®šä¹‰è¯·æ±‚/å“åº”å›æ‰
    return new Promise((resolve, reject) => {
      PureHttp.axiosInstance
        .request(config)
        .then((response: any) => {
          resolve(response)
        })
        .catch(error => {
          reject(error)
        })
    })
  }

  // å•ç‹¬æŠ½ç¦»çš„postå·¥å…·å‡½æ•°
  public post<T, P>(
    url: string,
    params?: T,
    config?: PureHttpRequestConfig
  ): Promise<P> {
    return this.request<P>("post", url, params, config)
  }

  // å•ç‹¬æŠ½ç¦»çš„getå·¥å…·å‡½æ•°
  public get<T, P>(
    url: string,
    params?: T,
    config?: PureHttpRequestConfig
  ): Promise<P> {
    return this.request<P>("get", url, params, config)
  }
}

export const http = new PureHttp()

```

`api`Â : é¡¹ç›®ä¸­æ¥å£åšç»Ÿä¸€ç®¡ç†ï¼ŒæŒ‰ç…§æ¨¡å—æ¥åˆ’åˆ†
```ts
import { http } from "@/utils/http"
import { resultType } from "@/utils/http/types"
import {
  getUserPageRequest,
  addRoleRequest,
  addDeptRequest,
  addCustomerRequest
} from "@/types/user"

export const login = (data: { phoneNumber: string; code: string }) => {
  const params = {
    phone: data.phoneNumber,
    type: "front",
    verifyCode: data.code
  }
  return http.post<unknown, resultType>("/login", { params })
}
```

### çŠ¶æ€ç®¡ç†pinia

Pinia æ˜¯ Vue.js çš„è½»é‡çº§çŠ¶æ€ç®¡ç†åº“ï¼Œå®ƒä½¿ç”¨ Vue 3 ä¸­çš„æ–°ååº”ç³»ç»Ÿæ¥æ„å»ºä¸€ä¸ªç›´è§‚ä¸”å®Œå…¨ç±»å‹åŒ–çš„çŠ¶æ€ç®¡ç†åº“ã€‚

##### Piniaçš„ä¼˜ç‚¹

-   å®Œæ•´çš„ TypeScript æ”¯æŒï¼šä¸åœ¨ Vuex ä¸­æ·»åŠ  TypeScript ç›¸æ¯”ï¼Œæ·»åŠ  TypeScript æ›´å®¹æ˜“
-   æå…¶è½»å·§(ä½“ç§¯çº¦ 1KB)
-   store çš„ action è¢«è°ƒåº¦ä¸ºå¸¸è§„çš„å‡½æ•°è°ƒç”¨ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ dispatch æ–¹æ³•æˆ– MapAction è¾…åŠ©å‡½æ•°ï¼Œè¿™åœ¨ Vuex ä¸­å¾ˆå¸¸è§
-   æ”¯æŒå¤šä¸ªStore
-   æ”¯æŒ Vue devtoolsã€SSR å’Œ webpack ä»£ç æ‹†åˆ†

å®‰è£…å‘½ä»¤ï¼š

```shell
yarn add pinia@next
```

åˆ›å»ºpiniaå®ä¾‹

```ts
import type { App } from "vue"
import { createPinia } from "pinia"
const store = createPinia()

export function setupStore(app: App<Element>) {
  app.use(store)
}

export { store }
```

è®¾ç½®ä¸ºå…¨å±€å¯¹è±¡ï¼Œåœ¨`main.ts`ä¸­å¼•ç”¨
```ts
   import { createApp } from 'vue' 
   import App from './App.vue' 
   import router from './router/index'
   const app = createApp(App)
   // æ³¨å†Œè·¯ç”±
   app.use(router)
   // æ³¨å†Œstore
   setupStore(app)
   app.mount('#app')
```
åˆ›å»ºstore

```ts
import { defineStore } from "pinia"
import { store } from "./index"

export const useUserStore = defineStore({
  id: "pure-user",
  state: (): userType => ({
    lastLoginTime: "",
    name: "",
    roleName: "",
    perPaths: []
  })
  actions: {
    SET_LAST_LOGIN_TIME(lastLoginTime: string) {
      this.lastLoginTime = lastLoginTime
    },
    SET_NAME(name: string) {
      this.name = name
    },
    // ç™»å‡º æ¸…ç©ºç¼“å­˜
    async logOut() {
      if (!getAuth()) return
      const resp = await loginOut()
      if (resp.code === 20000) {
        router.push("/login")
        removeAuth()
      } else {
        message.error(resp.msg)
      }
    }
  }
})

export function useUserStoreHook() {
  return useUserStore(store)
}
```

åœ¨vueä¸­ä½¿ç”¨
```html
<script setup lang="ts">
    const userStore = useUserStoreHook()
</script>
<template>
<div class="top-header__right">
    <span class="top-header__last-login-time"
      >ä¸Šæ¬¡ç™»å½•æ—¶é—´ï¼š{{ userStore.lastLoginTime }}</span
    >
</div>
<logout-outlined
      class="top-header__logout"
      @click="userStore.logOut()"
      style="
        color: #434343;
        font-size: 16px;
        margin-left: 30px;
        margin-right: 8px;
      "
    />
</template>
```

æƒ³è¦ä½¿ç”¨å‰ç«¯æœ€æ–°æŠ€æœ¯æ ˆçš„å°ä¼™ä¼´ï¼Œèµ¶å¿«å­¦ä¹ èµ·æ¥å§ï¼ï¼ï¼