ğŸ˜€ è¿™æ˜¯çˆ¬è™«ä¸“æ ç¬¬Â **ã€Œ30ã€**Â ç¯‡åŸåˆ›

å‰é¢æˆ‘ä»¬ä»‹ç»äº†å¤šç§è¯·æ±‚åº“ï¼Œå¦‚ urllibã€requestsã€Seleniumã€Playwright ç­‰ç”¨æ³•ï¼Œä½†æ˜¯æ²¡æœ‰ç»Ÿä¸€æ¢³ç†ä»£ç†çš„è®¾ç½®æ–¹æ³•ï¼Œæœ¬èŠ‚æˆ‘ä»¬æ¥é’ˆå¯¹è¿™äº›åº“æ¥æ¢³ç†ä¸‹ä»£ç†çš„è®¾ç½®æ–¹æ³•ã€‚

## 1. å‡†å¤‡å·¥ä½œ

åœ¨æœ¬èŠ‚å¼€å§‹ä¹‹å‰ï¼Œè¯·å…ˆæ ¹æ®ä¸Šä¸€èŠ‚äº†è§£ä¸€ä¸‹ä»£ç†çš„åŸºæœ¬åŸç†ï¼Œäº†è§£äº†åŸºæœ¬åŸç†ä¹‹åæˆ‘ä»¬å¯ä»¥æ›´å¥½åœ°ç†è§£å’Œå­¦ä¹ æœ¬èŠ‚çš„å†…å®¹ã€‚

å¦å¤–æˆ‘ä»¬éœ€è¦å…ˆè·å–ä¸€ä¸ªå¯ç”¨ä»£ç†ï¼Œä»£ç†å°±æ˜¯ IP åœ°å€å’Œç«¯å£çš„ç»„åˆï¼Œå°±æ˜¯ `<ip>:<port>` è¿™æ ·çš„æ ¼å¼ã€‚å¦‚æœä»£ç†éœ€è¦è®¿é—®è®¤è¯ï¼Œé‚£å°±è¿˜éœ€è¦é¢å¤–çš„ç”¨æˆ·åå¯†ç ä¸¤ä¸ªä¿¡æ¯ã€‚

é‚£æ€ä¹ˆè·å–ä¸€ä¸ªå¯ç”¨ä»£ç†å‘¢ï¼Ÿ

ä½¿ç”¨æœç´¢å¼•æ“æœç´¢ â€œä»£ç†â€ å…³é”®å­—ï¼Œå¯ä»¥çœ‹åˆ°è®¸å¤šä»£ç†æœåŠ¡ç½‘ç«™ï¼Œç½‘ç«™ä¸Šä¼šæœ‰å¾ˆå¤šå…è´¹æˆ–ä»˜è´¹ä»£ç†ï¼Œæ¯”å¦‚å¿«ä»£ç†çš„å…è´¹ HTTP ä»£ç†ï¼š[https://www.kuaidaili.com/free/](https://www.kuaidaili.com/free/) ä¸Šé¢å°±å†™äº†å¾ˆå¤šå…è´¹ä»£ç†ï¼Œä½†æ˜¯è¿™äº›å…è´¹ä»£ç†å¤§å¤šæ•°æƒ…å†µä¸‹å¹¶ä¸ä¸€å®šç¨³å®šï¼Œæ‰€ä»¥æ¯”è¾ƒé è°±çš„æ–¹æ³•æ˜¯è´­ä¹°ä»˜è´¹ä»£ç†ã€‚ä»˜è´¹ä»£ç†çš„å„å¤§ä»£ç†å•†å®¶éƒ½æœ‰å¥—é¤ï¼Œæ•°é‡ä¸ç”¨å¤šï¼Œç¨³å®šå¯ç”¨å³å¯ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªè¡Œé€‰è´­ã€‚

å¦å¤–é™¤äº†è´­ä¹°ä»˜è´¹ HTTP ä»£ç†ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨æœ¬æœºé…ç½®ä¸€äº›ä»£ç†è½¯ä»¶ï¼Œå…·ä½“çš„é…ç½®æ–¹æ³•å¯ä»¥å‚è€ƒ https://setup.scrape.center/proxy-clientï¼Œè½¯ä»¶è¿è¡Œä¹‹åä¼šåœ¨æœ¬æœºåˆ›å»º HTTP æˆ– SOCKS ä»£ç†æœåŠ¡ï¼Œæ‰€ä»¥ä»£ç†åœ°å€ä¸€èˆ¬éƒ½æ˜¯ ` 127.0.0.1:<port>` è¿™æ ·çš„æ ¼å¼ï¼Œä¸åŒçš„è½¯ä»¶ç”¨çš„ç«¯å£å¯èƒ½ä¸åŒã€‚

è¿™é‡Œæˆ‘çš„æœ¬æœºå®‰è£…äº†ä¸€éƒ¨ä»£ç†è½¯ä»¶ï¼Œå®ƒä¼šåœ¨æœ¬åœ° 7890 ç«¯å£ä¸Šåˆ›å»º HTTP ä»£ç†æœåŠ¡ï¼Œå³ä»£ç†ä¸º 127.0.0.1:7890ã€‚å¦å¤–ï¼Œè¯¥è½¯ä»¶è¿˜ä¼šåœ¨ 7891 ç«¯å£ä¸Šåˆ›å»º SOCKS ä»£ç†æœåŠ¡ï¼Œå³ä»£ç†ä¸º 127.0.0.1:7891ï¼Œæ‰€ä»¥åªè¦è®¾ç½®äº†è¿™ä¸ªä»£ç†ï¼Œå°±å¯ä»¥æˆåŠŸå°†æœ¬æœº IP åˆ‡æ¢åˆ°ä»£ç†è½¯ä»¶è¿æ¥çš„æœåŠ¡å™¨çš„ IP äº†ã€‚

åœ¨æœ¬ç« ä¸‹é¢çš„ç¤ºä¾‹é‡Œï¼Œæˆ‘ä½¿ç”¨ä¸Šè¿°ä»£ç†æ¥æ¼”ç¤ºå…¶è®¾ç½®æ–¹æ³•ï¼Œä½ ä¹Ÿå¯ä»¥è‡ªè¡Œæ›¿æ¢æˆè‡ªå·±çš„å¯ç”¨ä»£ç†ã€‚

è®¾ç½®ä»£ç†åï¼Œæµ‹è¯•çš„ç½‘å€æ˜¯ [http://httpbin.org/get](http://httpbin.org/get)ï¼Œè®¿é—®è¯¥é“¾æ¥æˆ‘ä»¬å¯ä»¥å¾—åˆ°è¯·æ±‚çš„ç›¸å…³ä¿¡æ¯ï¼Œå…¶ä¸­è¿”å›ç»“æœçš„ `origin` å­—æ®µå°±æ˜¯å®¢æˆ·ç«¯çš„ IPï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®å®ƒæ¥åˆ¤æ–­ä»£ç†æ˜¯å¦è®¾ç½®æˆåŠŸï¼Œå³æ˜¯å¦æˆåŠŸä¼ªè£…äº† IPã€‚

å¥½ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥çœ‹ä¸‹å„ä¸ªè¯·æ±‚åº“çš„ä»£ç†è®¾ç½®æ–¹æ³•å§ã€‚

## 2. urllib

é¦–å…ˆæˆ‘ä»¬ä»¥æœ€åŸºç¡€çš„ urllib ä¸ºä¾‹ï¼Œæ¥çœ‹ä¸€ä¸‹ä»£ç†çš„è®¾ç½®æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š

```python
from urllib.error import URLError
from urllib.request import ProxyHandler, build_opener

proxy = '127.0.0.1:7890'
proxy_handler = ProxyHandler({
    'http': 'http://' + proxy,
    'https': 'http://' + proxy
})
opener = build_opener(proxy_handler)
try:
    response = opener.open('https://httpbin.org/get')
    print(response.read().decode('utf-8'))
except URLError as e:
    print(e.reason)
```

è¿è¡Œç»“æœå¦‚ä¸‹ï¼š

```json
{
  "args": {},
  "headers": {
    "Accept-Encoding": "identity",
    "Host": "httpbin.org",
    "User-Agent": "Python-urllib/3.7",
    "X-Amzn-Trace-Id": "Root=1-60e9a1b6-0a20b8a678844a0b2ab4e889"
  },
  "origin": "210.173.1.204",
  "url": "https://httpbin.org/get"
}
```

è¿™é‡Œæˆ‘ä»¬éœ€è¦å€ŸåŠ© ProxyHandler è®¾ç½®ä»£ç†ï¼Œå‚æ•°æ˜¯å­—å…¸ç±»å‹ï¼Œé”®åä¸ºåè®®ç±»å‹ï¼Œé”®å€¼æ˜¯ä»£ç†ã€‚æ³¨æ„ï¼Œæ­¤å¤„ä»£ç†å‰é¢éœ€è¦åŠ ä¸Šåè®®ï¼Œå³ `http://` æˆ–è€… `https://`ï¼Œå½“è¯·æ±‚çš„é“¾æ¥æ˜¯ HTTP åè®®çš„æ—¶å€™ï¼Œä¼šä½¿ç”¨ http é”®åå¯¹åº”çš„ä»£ç†ï¼Œå½“è¯·æ±‚çš„é“¾æ¥æ˜¯ HTTPS åè®®çš„æ—¶å€™ï¼Œä¼šä½¿ç”¨ https é”®åå¯¹åº”çš„ä»£ç†ã€‚ä¸è¿‡è¿™é‡Œæˆ‘ä»¬æŠŠä»£ç†æœ¬èº«è®¾ç½®ä¸ºäº† HTTP åè®®ï¼Œå³å‰ç¼€ç»Ÿä¸€è®¾ç½®ä¸ºäº† `http://`ï¼Œæ‰€ä»¥ä¸è®ºè®¿é—® HTTP è¿˜æ˜¯ HTTPS åè®®çš„é“¾æ¥ï¼Œéƒ½ä¼šä½¿ç”¨æˆ‘ä»¬é…ç½®çš„ HTTP åè®®çš„ä»£ç†è¿›è¡Œè¯·æ±‚ã€‚

åˆ›å»ºå®Œ ProxyHandler å¯¹è±¡ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦åˆ©ç”¨ build_opener æ–¹æ³•ä¼ å…¥è¯¥å¯¹è±¡æ¥åˆ›å»ºä¸€ä¸ª Openerï¼Œè¿™æ ·å°±ç›¸å½“äºæ­¤ Opener å·²ç»è®¾ç½®å¥½ä»£ç†äº†ã€‚æ¥ä¸‹æ¥ç›´æ¥è°ƒç”¨ Opener å¯¹è±¡çš„ open æ–¹æ³•ï¼Œå³å¯è®¿é—®æˆ‘ä»¬æ‰€æƒ³è¦çš„é“¾æ¥ã€‚

è¿è¡Œè¾“å‡ºç»“æœæ˜¯ä¸€ä¸ª JSONï¼Œå®ƒæœ‰ä¸€ä¸ªå­—æ®µ originï¼Œæ ‡æ˜äº†å®¢æˆ·ç«¯çš„ IPã€‚éªŒè¯ä¸€ä¸‹ï¼Œæ­¤å¤„çš„ IP ç¡®å®ä¸ºä»£ç†çš„ IPï¼Œå¹¶ä¸æ˜¯çœŸå®çš„ IPã€‚è¿™æ ·æˆ‘ä»¬å°±æˆåŠŸè®¾ç½®å¥½ä»£ç†ï¼Œå¹¶å¯ä»¥éšè—çœŸå® IP äº†ã€‚

å¦‚æœé‡åˆ°éœ€è¦è®¤è¯çš„ä»£ç†ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å¦‚ä¸‹çš„æ–¹æ³•è®¾ç½®ï¼š

```python
from urllib.error import URLError
from urllib.request import ProxyHandler, build_opener

proxy = 'username:password@127.0.0.1:7890'
proxy_handler = ProxyHandler({
    'http': 'http://' + proxy,
    'https': 'http://' + proxy
})
opener = build_opener(proxy_handler)
try:
    response = opener.open('https://httpbin.org/get')
    print(response.read().decode('utf-8'))
except URLError as e:
    print(e.reason)
```

è¿™é‡Œæ”¹å˜çš„åªæ˜¯ proxy å˜é‡ï¼Œåªéœ€è¦åœ¨ä»£ç†å‰é¢åŠ å…¥ä»£ç†è®¤è¯çš„ç”¨æˆ·åå¯†ç å³å¯ï¼Œå…¶ä¸­ username å°±æ˜¯ç”¨æˆ·åï¼Œpassword ä¸ºå¯†ç ï¼Œä¾‹å¦‚ username ä¸º fooï¼Œå¯†ç ä¸º barï¼Œé‚£ä¹ˆä»£ç†å°±æ˜¯ `foo:bar@127.0.0.1:7890`ã€‚

å¦‚æœä»£ç†æ˜¯ SOCKS5 ç±»å‹ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨å¦‚ä¸‹æ–¹å¼è®¾ç½®ä»£ç†ï¼š

```python
import socks
import socket
from urllib import request
from urllib.error import URLError

socks.set_default_proxy(socks.SOCKS5, '127.0.0.1', 7891)
socket.socket = socks.socksocket
try:
    response = request.urlopen('https://httpbin.org/get')
    print(response.read().decode('utf-8'))
except URLError as e:
    print(e.reason)
```

æ­¤å¤„éœ€è¦ä¸€ä¸ª socks æ¨¡å—ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤å®‰è£…ï¼š

```
pip3 install PySocks
```

è¿™é‡Œéœ€è¦æœ¬åœ°è¿è¡Œä¸€ä¸ª SOCKS5 ä»£ç†ï¼Œè¿è¡Œåœ¨ 7891 ç«¯å£ï¼Œè¿è¡ŒæˆåŠŸä¹‹åå’Œä¸Šæ–‡ HTTP ä»£ç†è¾“å‡ºç»“æœæ˜¯ä¸€æ ·çš„ï¼š

```json
{
  "args": {},
  "headers": {
    "Accept-Encoding": "identity",
    "Host": "httpbin.org",
    "User-Agent": "Python-urllib/3.7",
    "X-Amzn-Trace-Id": "Root=1-60e9a1b6-0a20b8a678844a0b2ab4e889"
  },
  "origin": "210.173.1.204",
  "url": "https://httpbin.org/get"
}
```

ç»“æœçš„ origin å­—æ®µåŒæ ·ä¸ºä»£ç†çš„ IPï¼Œä»£ç†è®¾ç½®æˆåŠŸã€‚

## 3.requests çš„ä»£ç†è®¾ç½®

å¯¹äº requests æ¥è¯´ï¼Œä»£ç†è®¾ç½®éå¸¸ç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦ä¼ å…¥ `proxies` å‚æ•°å³å¯ã€‚

è¿™é‡Œä»¥æˆ‘æœ¬æœºçš„ä»£ç†ä¸ºä¾‹ï¼Œæ¥çœ‹ä¸‹ requests çš„ HTTP ä»£ç†è®¾ç½®ï¼Œä»£ç å¦‚ä¸‹ï¼š

```python
import requests

proxy = '127.0.0.1:7890'
proxies = {
    'http': 'http://' + proxy,
    'https': 'http://' + proxy,
}
try:
    response = requests.get('https://httpbin.org/get', proxies=proxies)
    print(response.text)
except requests.exceptions.ConnectionError as e:
    print('Error', e.args)
```

è¿è¡Œç»“æœå¦‚ä¸‹ï¼š

```javascript
{
  "args": {},
  "headers": {
    "Accept": "*/*",
    "Accept-Encoding": "gzip, deflate",
    "Host": "httpbin.org",
    "User-Agent": "python-requests/2.22.0",
    "X-Amzn-Trace-Id": "Root=1-5e8f358d-87913f68a192fb9f87aa0323"
  },
  "origin": "210.173.1.204",
  "url": "https://httpbin.org/get"
}
```

å’Œ urllib ä¸€æ ·ï¼Œå½“è¯·æ±‚çš„é“¾æ¥æ˜¯ HTTP åè®®çš„æ—¶å€™ï¼Œä¼šä½¿ç”¨ http é”®åå¯¹åº”çš„ä»£ç†ï¼Œå½“è¯·æ±‚çš„é“¾æ¥æ˜¯ HTTPS åè®®çš„æ—¶å€™ï¼Œä¼šä½¿ç”¨ https é”®åå¯¹åº”çš„ä»£ç†ï¼Œä¸è¿‡è¿™é‡Œç»Ÿä¸€ä½¿ç”¨äº† HTTP åè®®çš„ä»£ç†ã€‚

è¿è¡Œç»“æœä¸­çš„ `origin` è‹¥æ˜¯ä»£ç†æœåŠ¡å™¨çš„ IPï¼Œåˆ™è¯æ˜ä»£ç†å·²ç»è®¾ç½®æˆåŠŸã€‚

å¦‚æœä»£ç†éœ€è¦è®¤è¯ï¼Œé‚£ä¹ˆåœ¨ä»£ç†çš„å‰é¢åŠ ä¸Šç”¨æˆ·åå’Œå¯†ç å³å¯ï¼Œä»£ç†çš„å†™æ³•å°±å˜æˆå¦‚ä¸‹æ‰€ç¤ºï¼š

```python
proxy = 'username:password@127.0.0.1:7890'
```

è¿™é‡Œåªéœ€è¦å°† `username` å’Œ `password` æ›¿æ¢å³å¯ã€‚

å¦‚æœéœ€è¦ä½¿ç”¨ SOCKS ä»£ç†ï¼Œåˆ™å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼æ¥è®¾ç½®ï¼š

```python
import requests

proxy = '127.0.0.1:7891'
proxies = {
    'http': 'socks5://' + proxy,
    'https': 'socks5://' + proxy
}
try:
    response = requests.get('https://httpbin.org/get', proxies=proxies)
    print(response.text)
except requests.exceptions.ConnectionError as e:
    print('Error', e.args)
```

è¿™é‡Œæˆ‘ä»¬éœ€è¦é¢å¤–å®‰è£…ä¸€ä¸ªåŒ… `requests[socks]`ï¼Œç›¸å…³å‘½ä»¤å¦‚ä¸‹æ‰€ç¤ºï¼š

```text
pip3 install "requests[socks]"
```

è¿è¡Œç»“æœæ˜¯å®Œå…¨ç›¸åŒçš„ï¼š

```javascript
{
  "args": {},
  "headers": {
    "Accept": "*/*",
    "Accept-Encoding": "gzip, deflate",
    "Host": "httpbin.org",
    "User-Agent": "python-requests/2.22.0",
    "X-Amzn-Trace-Id": "Root=1-5e8f364a-589d3cf2500fafd47b5560f2"
  },
  "origin": "210.173.1.204",
  "url": "https://httpbin.org/get"
}
```

å¦å¤–ï¼Œè¿˜æœ‰ä¸€ç§è®¾ç½®æ–¹å¼ï¼Œå³ä½¿ç”¨ socks æ¨¡å—ï¼Œä¹Ÿéœ€è¦åƒä¸Šæ–‡ä¸€æ ·å®‰è£… socks åº“ã€‚è¿™ç§è®¾ç½®æ–¹æ³•å¦‚ä¸‹æ‰€ç¤ºï¼š

```python
import requests
import socks
import socket

socks.set_default_proxy(socks.SOCKS5, '127.0.0.1', 7891)
socket.socket = socks.socksocket
try:
    response = requests.get('https://httpbin.org/get')
    print(response.text)
except requests.exceptions.ConnectionError as e:
    print('Error', e.args)
```

ä½¿ç”¨è¿™ç§æ–¹æ³•ä¹Ÿå¯ä»¥è®¾ç½® SOCKS ä»£ç†ï¼Œè¿è¡Œç»“æœå®Œå…¨ç›¸åŒã€‚ç›¸æ¯”ç¬¬ä¸€ç§æ–¹æ³•ï¼Œæ­¤æ–¹æ³•æ˜¯å…¨å±€è®¾ç½®çš„ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ä¸åŒæƒ…å†µä¸‹é€‰ç”¨ä¸åŒçš„æ–¹æ³•ã€‚

## 4. httpx çš„ä»£ç†è®¾ç½®

httpx çš„ç”¨æ³•æœ¬èº«å°±ä¸ requests çš„ä½¿ç”¨éå¸¸ç›¸ä¼¼ï¼Œæ‰€ä»¥å…¶ä¹Ÿæ˜¯é€šè¿‡ proxies å‚æ•°æ¥è®¾ç½®ä»£ç†çš„ï¼Œä¸è¿‡ä¸ requests ä¸åŒçš„æ˜¯ï¼Œproxies å‚æ•°çš„é”®åä¸èƒ½å†æ˜¯ `http` æˆ– `https`ï¼Œè€Œéœ€è¦æ›´æ”¹ä¸º `http://` æˆ– `https://`ï¼Œå…¶ä»–çš„è®¾ç½®æ˜¯ä¸€æ ·çš„ã€‚

å¯¹äº HTTP ä»£ç†æ¥è¯´ï¼Œè®¾ç½®æ–¹æ³•å¦‚ä¸‹ï¼š

```python
import httpx

proxy = '127.0.0.1:7890'
proxies = {
    'http://': 'http://' + proxy,
    'https://': 'http://' + proxy,
}

with httpx.Client(proxies=proxies) as client:
    response = client.get('https://httpbin.org/get')
    print(response.text)
```

å¯¹äºéœ€è¦è®¤è¯çš„ä»£ç†ï¼Œä¹Ÿæ˜¯æ”¹ä¸‹ proxy çš„å€¼å³å¯ï¼š

```python
proxy = 'username:password@127.0.0.1:7890'
```

è¿™é‡Œåªéœ€è¦å°† `username` å’Œ `password` æ›¿æ¢å³å¯ã€‚

è¿è¡Œç»“æœå’Œä½¿ç”¨ requests æ˜¯ç±»ä¼¼çš„ï¼Œç»“æœå¦‚ä¸‹ï¼š

```json
{
  "args": {},
  "headers": {
    "Accept": "*/*",
    "Accept-Encoding": "gzip, deflate",
    "Host": "httpbin.org",
    "User-Agent": "python-httpx/0.18.1",
    "X-Amzn-Trace-Id": "Root=1-60e9a3ef-5527ff6320484f8e46d39834"
  },
  "origin": "210.173.1.204",
  "url": "https://httpbin.org/get"
}
```

å¯¹äº SOCKS ä»£ç†ï¼Œæˆ‘ä»¬éœ€è¦å®‰è£… httpx-socks åº“ï¼Œå®‰è£…æ–¹æ³•å¦‚ä¸‹ï¼š

```
pip3 install "httpx-socks[asyncio]"
```

è¿™æ ·ä¼šåŒæ—¶å®‰è£…åŒæ­¥å’Œå¼‚æ­¥ä¸¤ç§æ¨¡å¼çš„æ”¯æŒã€‚

å¯¹äºåŒæ­¥æ¨¡å¼ï¼Œè®¾ç½®æ–¹æ³•å¦‚ä¸‹ï¼š

```python
import httpx
from httpx_socks import SyncProxyTransport

transport = SyncProxyTransport.from_url(
    'socks5://127.0.0.1:7891')

with httpx.Client(transport=transport) as client:
    response = client.get('https://httpbin.org/get')
    print(response.text)
```

è¿™é‡Œæˆ‘ä»¬éœ€è¦è®¾ç½®ä¸€ä¸ª transport å¯¹è±¡ï¼Œå¹¶é…ç½® SOCKS ä»£ç†çš„åœ°å€ï¼ŒåŒæ—¶åœ¨å£°æ˜ httpx çš„ Client å¯¹è±¡çš„æ—¶å€™ä¼ å…¥ transport å‚æ•°å³å¯ï¼Œè¿è¡Œç»“æœå’Œåˆšæ‰æ˜¯ä¸€æ ·çš„ã€‚

å¯¹äºå¼‚æ­¥æ¨¡å¼ï¼Œè®¾ç½®æ–¹æ³•å¦‚ä¸‹ï¼š

```python
import httpx
import asyncio
from httpx_socks import AsyncProxyTransport

transport = AsyncProxyTransport.from_url(
    'socks5://127.0.0.1:7891')

async def main():
    async with httpx.AsyncClient(transport=transport) as client:
        response = await client.get('https://httpbin.org/get')
        print(response.text)

if __name__ == '__main__':
    asyncio.get_event_loop().run_until_complete(main())
```

å’ŒåŒæ­¥æ¨¡å¼ä¸åŒçš„æ˜¯ï¼Œtransport å¯¹è±¡æˆ‘ä»¬ç”¨çš„æ˜¯ AsyncProxyTransport è€Œä¸æ˜¯ SyncProxyTransportï¼ŒåŒæ—¶éœ€è¦å°† Client å¯¹è±¡æ›´æ”¹ä¸º AsyncClient å¯¹è±¡ï¼Œå…¶ä»–çš„ä¸å˜ï¼Œè¿è¡Œç»“æœæ˜¯ä¸€æ ·çš„ã€‚

## 5. Selenium çš„ä»£ç†è®¾ç½®

Selenium åŒæ ·å¯ä»¥è®¾ç½®ä»£ç†ï¼Œè¿™é‡Œä»¥ Chrome ä¸ºä¾‹æ¥ä»‹ç»å…¶è®¾ç½®æ–¹æ³•ã€‚

å¯¹äºæ— è®¤è¯çš„ä»£ç†ï¼Œè®¾ç½®æ–¹æ³•å¦‚ä¸‹ï¼š

```python
from selenium import webdriver

proxy = '127.0.0.1:7890'
options = webdriver.ChromeOptions()
options.add_argument('--proxy-server=http://' + proxy)
browser = webdriver.Chrome(options=options)
browser.get('https://httpbin.org/get')
print(browser.page_source)
browser.close()
```

è¿è¡Œç»“æœå¦‚ä¸‹ï¼š

```json
{
  "args": {},
  "headers": {
    "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9",
    "Accept-Encoding": "gzip, deflate",
    "Accept-Language": "zh-CN,zh;q=0.9",
    "Host": "httpbin.org",
    "Upgrade-Insecure-Requests": "1",
    "User-Agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.149 Safari/537.36",
    "X-Amzn-Trace-Id": "Root=1-5e8f39cd-60930018205fd154a9af39cc"
  },
  "origin": "210.173.1.204",
  "url": "http://httpbin.org/get"
}
```

ä»£ç†è®¾ç½®æˆåŠŸï¼Œ`origin` åŒæ ·ä¸ºä»£ç† IP çš„åœ°å€ã€‚

å¦‚æœä»£ç†æ˜¯è®¤è¯ä»£ç†ï¼Œåˆ™è®¾ç½®æ–¹æ³•ç›¸å¯¹æ¯”è¾ƒç¹çï¼Œå…·ä½“å¦‚ä¸‹æ‰€ç¤ºï¼š

```python
from selenium import webdriver
from selenium.webdriver.chrome.options import Options
import zipfile

ip = '127.0.0.1'
port = 7890
username = 'foo'
password = 'bar'

manifest_json = """{"version":"1.0.0","manifest_version": 2,"name":"Chrome Proxy","permissions": ["proxy","tabs","unlimitedStorage","storage","<all_urls>","webRequest","webRequestBlocking"],"background": {"scripts": ["background.js"]
    }
}
"""
background_js = """
var config = {
        mode: "fixed_servers",
        rules: {
          singleProxy: {
            scheme: "http",
            host: "%(ip) s",
            port: %(port) s
          }
        }
      }

chrome.proxy.settings.set({value: config, scope: "regular"}, function() {});

function callbackFn(details) {
    return {
        authCredentials: {username: "%(username) s",
            password: "%(password) s"
        }
    }
}

chrome.webRequest.onAuthRequired.addListener(
            callbackFn,
            {urls: ["<all_urls>"]},
            ['blocking']
)
""" % {'ip': ip, 'port': port, 'username': username, 'password': password}

plugin_file = 'proxy_auth_plugin.zip'
with zipfile.ZipFile(plugin_file, 'w') as zp:
    zp.writestr("manifest.json", manifest_json)
    zp.writestr("background.js", background_js)
options = Options()
options.add_argument("--start-maximized")
options.add_extension(plugin_file)
browser = webdriver.Chrome(options=options)
browser.get('https://httpbin.org/get')
print(browser.page_source)
browser.close()
```

è¿™é‡Œéœ€è¦åœ¨æœ¬åœ°åˆ›å»ºä¸€ä¸ª manifest.json é…ç½®æ–‡ä»¶å’Œ background.js è„šæœ¬æ¥è®¾ç½®è®¤è¯ä»£ç†ã€‚è¿è¡Œä»£ç ä¹‹åï¼Œæœ¬åœ°ä¼šç”Ÿæˆä¸€ä¸ª proxy_auth_plugin.zip æ–‡ä»¶æ¥ä¿å­˜å½“å‰é…ç½®ã€‚

è¿è¡Œç»“æœå’Œä¸Šä¾‹ä¸€è‡´ï¼Œ`origin` åŒæ ·ä¸ºä»£ç† IPã€‚

SOCKS ä»£ç†çš„è®¾ç½®ä¹Ÿæ¯”è¾ƒç®€å•ï¼ŒæŠŠå¯¹åº”çš„åè®®ä¿®æ”¹ä¸º `socks5` å³å¯ï¼Œå¦‚æ— å¯†ç è®¤è¯çš„ä»£ç†è®¾ç½®æ–¹æ³•ä¸ºï¼š

```python
from selenium import webdriver

proxy = '127.0.0.1:7891'
options = webdriver.ChromeOptions()
options.add_argument('--proxy-server=socks5://' + proxy)
browser = webdriver.Chrome(options=options)
browser.get('https://httpbin.org/get')
print(browser.page_source)
browser.close()
```

è¿è¡Œç»“æœæ˜¯ä¸€æ ·çš„ã€‚

## 6.aiohttp çš„ä»£ç†è®¾ç½®

å¯¹äº aiohttp æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ `proxy` å‚æ•°ç›´æ¥è®¾ç½®ã€‚HTTP ä»£ç†è®¾ç½®å¦‚ä¸‹ï¼š

```python
import asyncio
import aiohttp

proxy = 'http://127.0.0.1:7890'

async def main():
    async with aiohttp.ClientSession() as session:
        async with session.get('https://httpbin.org/get', proxy=proxy) as response:
            print(await response.text())


if __name__ == '__main__':
    asyncio.get_event_loop().run_until_complete(main())
```

å¦‚æœä»£ç†æœ‰ç”¨æˆ·åå’Œå¯†ç ï¼Œåƒ requests ä¸€æ ·ï¼ŒæŠŠ `proxy` ä¿®æ”¹ä¸ºå¦‚ä¸‹å†…å®¹ï¼š

```
proxy = 'http://username:password@127.0.0.1:7890'
```

è¿™é‡Œåªéœ€è¦å°† `username` å’Œ `password` æ›¿æ¢å³å¯ã€‚

å¯¹äº SOCKS ä»£ç†ï¼Œæˆ‘ä»¬éœ€è¦å®‰è£…ä¸€ä¸ªæ”¯æŒåº“ aiohttp-socksï¼Œå…¶å®‰è£…å‘½ä»¤å¦‚ä¸‹ï¼š

```
pip3 install aiohttp-socks
```

æˆ‘ä»¬å¯ä»¥å€ŸåŠ©äºè¿™ä¸ªåº“çš„ ProxyConnector æ¥è®¾ç½® SOCKS ä»£ç†ï¼Œå…¶ä»£ç å¦‚ä¸‹ï¼š

```python
import asyncio
import aiohttp
from aiohttp_socks import ProxyConnector

connector = ProxyConnector.from_url('socks5://127.0.0.1:7891')

async def main():
    async with aiohttp.ClientSession(connector=connector) as session:
        async with session.get('https://httpbin.org/get') as response:
            print(await response.text())


if __name__ == '__main__':
    asyncio.get_event_loop().run_until_complete(main())
```

è¿è¡Œç»“æœæ˜¯ä¸€æ ·çš„ã€‚

å¦å¤–ï¼Œè¿™ä¸ªåº“è¿˜æ”¯æŒè®¾ç½® SOCKS4ã€HTTP ä»£ç†ä»¥åŠå¯¹åº”çš„ä»£ç†è®¤è¯ï¼Œå¯ä»¥å‚è€ƒå…¶å®˜æ–¹ä»‹ç»ã€‚

## 7. Pyppeteer çš„ä»£ç†è®¾ç½®

å¯¹äº Pyppeteer æ¥è¯´ï¼Œç”±äºå…¶é»˜è®¤ä½¿ç”¨çš„æ˜¯ç±»ä¼¼ Chrome çš„ Chromium æµè§ˆå™¨ï¼Œå› æ­¤å…¶è®¾ç½®æ–¹æ³•å’Œ Selenium çš„ Chrome ä¸€æ ·ï¼Œå¦‚ HTTP æ— è®¤è¯ä»£ç†è®¾ç½®æ–¹æ³•éƒ½æ˜¯é€šè¿‡ `args` æ¥è®¾ç½®çš„ï¼Œå®ç°å¦‚ä¸‹ï¼š

```python
import asyncio
from pyppeteer import launch

proxy = '127.0.0.1:7890'

async def main():
    browser = await launch({'args': ['--proxy-server=http://' + proxy], 'headless': False})
    page = await browser.newPage()
    await page.goto('https://httpbin.org/get')
    print(await page.content())
    await browser.close()


if __name__ == '__main__':
    asyncio.get_event_loop().run_until_complete(main())
```

è¿è¡Œç»“æœå¦‚ä¸‹ï¼š

```json
{
  "args": {},
  "headers": {
    "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8",
    "Accept-Encoding": "gzip, deflate, br",
    "Accept-Language": "zh-CN,zh;q=0.9",
    "Host": "httpbin.org",
    "Upgrade-Insecure-Requests": "1",
    "User-Agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3494.0 Safari/537.36",
    "X-Amzn-Trace-Id": "Root=1-5e8f442c-12b1ed7865b049007267a66c"
  },
  "origin": "210.173.1.204",
  "url": "https://httpbin.org/get"
}
```

åŒæ ·å¯ä»¥çœ‹åˆ°è®¾ç½®æˆåŠŸã€‚

SOCKS ä»£ç†ä¹Ÿä¸€æ ·ï¼Œåªéœ€è¦å°†åè®®ä¿®æ”¹ä¸º `socks5` å³å¯ï¼Œä»£ç å®ç°å¦‚ä¸‹ï¼š

```python
import asyncio
from pyppeteer import launch

proxy = '127.0.0.1:7891'

async def main():
    browser = await launch({'args': ['--proxy-server=socks5://' + proxy], 'headless': False})
    page = await browser.newPage()
    await page.goto('https://httpbin.org/get')
    print(await page.content())
    await browser.close()

if __name__ == '__main__':
    asyncio.get_event_loop().run_until_complete(main())
```

è¿è¡Œç»“æœä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚

## 8. Playwright çš„ä»£ç†è®¾ç½®

ç›¸å¯¹ Selenium å’Œ Pyppeteer æ¥è¯´ï¼ŒPlaywright çš„ä»£ç†è®¾ç½®æ›´åŠ æ–¹ä¾¿ï¼Œå…¶é¢„ç•™äº†ä¸€ä¸ª proxy å‚æ•°ï¼Œå¯ä»¥åœ¨å¯åŠ¨ Playwright çš„æ—¶å€™è®¾ç½®ã€‚

å¯¹äº HTTP ä»£ç†æ¥è¯´ï¼Œå¯ä»¥è¿™æ ·è®¾ç½®ï¼š

```python
from playwright.sync_api import sync_playwright

with sync_playwright() as p:
    browser = p.chromium.launch(proxy={
        'server': 'http://127.0.0.1:7890'
    })
    page = browser.new_page()
    page.goto('https://httpbin.org/get')
    print(page.content())
    browser.close()
```

åœ¨è°ƒç”¨ launch æ–¹æ³•çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ä¼ ä¸€ä¸ª proxy å‚æ•°ï¼Œæ˜¯ä¸€ä¸ªå­—å…¸ã€‚å­—å…¸æœ‰ä¸€ä¸ªå¿…å¡«çš„å­—æ®µå«åš serverï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å¡«å†™ HTTP ä»£ç†çš„åœ°å€å³å¯ã€‚

è¿è¡Œç»“æœå¦‚ä¸‹ï¼š

```json
{
  "args": {},
  "headers": {
    "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9",
    "Accept-Encoding": "gzip, deflate, br",
    "Accept-Language": "zh-CN,zh;q=0.9",
    "Host": "httpbin.org",
    "Sec-Ch-Ua": "\" Not A;Brand\";v=\"99\", \"Chromium\";v=\"92\"",
    "Sec-Ch-Ua-Mobile": "?0",
    "Sec-Fetch-Dest": "document",
    "Sec-Fetch-Mode": "navigate",
    "Sec-Fetch-Site": "none",
    "Sec-Fetch-User": "?1",
    "Upgrade-Insecure-Requests": "1",
    "User-Agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4498.0 Safari/537.36",
    "X-Amzn-Trace-Id": "Root=1-60e99eef-4fa746a01a38abd469ecb467"
  },
  "origin": "210.173.1.204",
  "url": "https://httpbin.org/get"
}
```

å¯¹äº SOCKS ä»£ç†ï¼Œè®¾ç½®æ–¹æ³•ä¹Ÿæ˜¯å®Œå…¨ä¸€æ ·çš„ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠ server å­—æ®µçš„å€¼æ¢æˆ SOCKS ä»£ç†çš„åœ°å€å³å¯ï¼š

```python
from playwright.sync_api import sync_playwright

with sync_playwright() as p:
    browser = p.chromium.launch(proxy={
        'server': 'socks5://127.0.0.1:7891'
    })
    page = browser.new_page()
    page.goto('https://httpbin.org/get')
    print(page.content())
    browser.close()
```

è¿è¡Œç»“æœå’Œåˆšæ‰ä¹Ÿæ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚

å¯¹äºæœ‰ç”¨æˆ·åå’Œå¯†ç çš„ä»£ç†ï¼ŒPlaywright çš„è®¾ç½®ä¹Ÿéå¸¸ç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨ proxy å‚æ•°é¢å¤–è®¾ç½® username å’Œ password å­—æ®µå³å¯ï¼Œå‡å¦‚ç”¨æˆ·åå’Œå¯†ç åˆ†åˆ«æ˜¯ foo å’Œ barï¼Œåˆ™è®¾ç½®æ–¹æ³•å¦‚ä¸‹ï¼š

```python
from playwright.sync_api import sync_playwright

with sync_playwright() as p:
    browser = p.chromium.launch(proxy={
        'server': 'http://127.0.0.1:7890',
        'username': 'foo',
        'password': 'bar'
    })
    page = browser.new_page()
    page.goto('https://httpbin.org/get')
    print(page.content())
    browser.close()
```

è¿™æ ·æˆ‘ä»¬å°±èƒ½éå¸¸æ–¹ä¾¿åœ°ä¸º Playwright å®ç°è®¤è¯ä»£ç†çš„è®¾ç½®ã€‚

## 9.æ€»ç»“

ä»¥ä¸Šæˆ‘ä»¬å°±æ€»ç»“äº†å„ä¸ªè¯·æ±‚åº“çš„ä»£ç†ä½¿ç”¨æ–¹å¼ï¼Œå„ç§åº“çš„è®¾ç½®æ–¹æ³•å¤§åŒå°å¼‚ï¼Œå­¦ä¼šäº†è¿™äº›æ–¹æ³•ä¹‹åï¼Œä»¥åå¦‚æœé‡åˆ°å° IP çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾é€šè¿‡åŠ ä»£ç†çš„æ–¹å¼æ¥è§£å†³ã€‚

æœ¬èŠ‚ä»£ç ï¼šhttps://github.com/Python3WebSpider/ProxyTest

éå¸¸æ„Ÿè°¢ä½ çš„é˜…è¯»ï¼Œæ›´å¤šç²¾å½©å†…å®¹ï¼Œè¯·å…³æ³¨æˆ‘çš„å…¬ä¼—å·ã€Œè¿›å‡»çš„ Coderã€å’Œã€Œå´”åº†æ‰ä¸¨é™è§…ã€ã€‚
