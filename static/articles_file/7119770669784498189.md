---
highlight: a11y-dark
---

<div align=center><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/57231d2a12c742d8833d9da75aa4f278~tplv-k3u1fbpfcp-zoom-1.image" width="100%" referrerpolicy="no-referrer"></div>





> - ğŸ’¡ ä½œè€…ï¼š[éŸ©ä¿¡å­](https://github.com/HanXinzi-AI)@[ShowMeAI](http://www.showmeai.tech/)
> - ğŸ“˜ [æ·±åº¦å­¦ä¹ å®æˆ˜ç³»åˆ—](http://www.showmeai.tech/tutorials/42)ï¼š[http://www.showmeai.tech/tutorials/42](http://www.showmeai.tech/tutorials/42)
> - ğŸ“˜ [NLPå®æˆ˜ç³»åˆ—](http://www.showmeai.tech/tutorials/45): [http://www.showmeai.tech/tutorials/45](http://www.showmeai.tech/tutorials/45)
> - ğŸ“˜ [æœ¬æ–‡åœ°å€](http://www.showmeai.tech/article-detail/291)ï¼š[http://www.showmeai.tech/article-detail/291](http://www.showmeai.tech/article-detail/291)
> - ğŸ“¢ å£°æ˜ï¼šç‰ˆæƒæ‰€æœ‰ï¼Œè½¬è½½è¯·è”ç³»å¹³å°ä¸ä½œè€…å¹¶æ³¨æ˜å‡ºå¤„
> - ğŸ“¢ æ”¶è—[ShowMeAI](http://www.showmeai.tech/)æŸ¥çœ‹æ›´å¤šç²¾å½©å†…å®¹




ã€Šç¤¼è®°Â·ä¹è®°ã€‹ä¸­è¯´ï¼šâ€œå‡¡éŸ³ä¹‹èµ·ï¼Œç”±äººå¿ƒç”Ÿä¹Ÿã€‚äººå¿ƒä¹‹åŠ¨ï¼Œç‰©ä½¿ä¹‹ç„¶ä¹Ÿã€‚æ„Ÿäºç‰©è€ŒåŠ¨ï¼Œæ•…å½¢äºå£°ã€‚å£°ç›¸åº”ï¼Œæ•…ç”Ÿå˜ã€‚â€

è¿™è¯´çš„æ˜¯äººå¯¹äºä¸€ç§äº‹ç‰©æœ‰æ„Ÿè€Œç”Ÿï¼Œå¿…ç„¶è¡¨ç°åœ¨å£°éŸ³ä¸Šã€‚è€Œæ™šæ¸…åè‡£æ›¾å›½è—©ä¹Ÿæåˆ°ï¼Œä»–åœ¨è®¤äººè¯†äººä¸­æœ‰è‡ªå·±ç‹¬åˆ°çš„æ–¹æ³•ï¼Œå…¶ä¸­ï¼Œç‰¹åˆ«å–œæ¬¢é€šè¿‡å£°éŸ³æ¥è¯†åˆ«äººæ‰ã€‚ä»–è®¤ä¸ºï¼Œå£°éŸ³ä¸ä»…èƒ½åæ˜ å‡ºä¸€ä¸ªäººçš„è´µè´±å’Œä¿®å…»ï¼Œä¹Ÿèƒ½å¬å‡ºå…¶å†…å¿ƒæƒ…ç»ªå˜åŒ–ã€‚ç»“åˆè¿™ä¸ªæ–¹æ³•ä»–ä¸€ç”Ÿææ‹”äº†å¤§é‡äººæ‰ã€‚

<div align=center><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dccd6fd8974d449dadc0b4548081d47c~tplv-k3u1fbpfcp-zoom-1.image" width="70%" referrerpolicy="no-referrer"></div>

æ—¢ç„¶å£°éŸ³å¯¹ä¸€ä¸ªäººçš„æƒ…ç»ªæ€§æ ¼è¡¨ç°è¿™ä¹ˆæ˜æ˜¾ï¼ŒAIç®—æ³•èƒ½ä¸èƒ½æ ¹æ®å£°éŸ³è¯†åˆ«æƒ…ç»ªå’Œæ°”æ°›å‘¢ï¼Ÿå¦‚æœæ¥ç”µè¯çš„å¥³æœ‹å‹ï¼Œä¸€å¼ å£AIå°±çŸ¥é“æ˜¯ä»€ä¹ˆæƒ…ç»ªçŠ¶æ€ï¼Œé’¢é“ç›´ç”·å°å“¥å“¥ä»¬å¯èƒ½æ±‚ç”Ÿæ¬²æŠ€èƒ½å¯ä»¥plus maxã€‚

åœ¨æœ¬ç¯‡å†…å®¹ä¸­ï¼ŒShowMeAIå°±é’ˆå¯¹ã€Œ**è¯­éŸ³æƒ…æ„Ÿè¯†åˆ«ä»»åŠ¡**ã€ï¼Œæ‰‹æŠŠæ‰‹å¸¦å¤§å®¶æ¥æ„å»ºä¸€ä¸ªå¤„ç†å’Œåˆ†ç±»è¯­éŸ³æ£€æµ‹æƒ…ç»ªçš„ç³»ç»Ÿã€‚

## ğŸ’¡ èƒŒæ™¯æ¦‚è¿°

è¦å®Œæˆè¯­éŸ³æƒ…ç»ªè¯†åˆ«ä»»åŠ¡ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ç‚¹åŸºç¡€çŸ¥è¯†ï¼š

> è¯­éŸ³åŒ…æ‹¬ä¸‰ç±»ä¸åŒçš„ç‰¹å¾ï¼š
> - è¯æ±‡ç‰¹å¾ï¼ˆä½¿ç”¨çš„è¯æ±‡ï¼‰
> - è§†è§‰ç‰¹å¾ï¼ˆè¯´è¯è€…çš„è¡¨è¾¾æ–¹å¼ï¼‰
> - å£°å­¦ç‰¹å¾ï¼ˆéŸ³é«˜ã€éŸ³è°ƒã€æŠ–åŠ¨ç­‰å£°éŸ³å±æ€§ï¼‰

<div align=center><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/05af7b1430e74215bc9c4dea9621923a~tplv-k3u1fbpfcp-zoom-1.image" width="70%" referrerpolicy="no-referrer"></div>

æˆ‘ä»¬å½“ç„¶å¯ä»¥åŸºäºè¯æ±‡ï¼ˆæ–‡æœ¬ï¼‰æˆ–è€…è§†è§‰ä¿¡æ¯æ¥åšæƒ…ç»ªåˆ†ç±»ï¼Œåœ¨æœ¬ç¯‡å†…å®¹ä¸­æˆ‘ä»¬èšç„¦åœ¨å£°å­¦ç‰¹å¾è¿›è¡Œåˆ†ç±»ï¼Œæˆ‘ä»¬æ„å»ºä¸€ä¸ªæ·±åº¦å­¦ä¹ çš„ç¥ç»ç½‘ç»œæ¥å®Œæˆè¿™ä¸ªä»»åŠ¡ã€‚

å½“ç„¶ä½¿ç”¨æ·±åº¦å­¦ä¹ ç½‘ç»œè¿›è¡Œæƒ…ç»ªè¯†åˆ«ä¹Ÿæœ‰å…¶è‡ªèº«çš„æŒ‘æˆ˜ã€‚å¤§å®¶éƒ½çŸ¥é“ï¼Œæƒ…ç»ªæ˜¯é«˜åº¦ä¸»è§‚çš„ï¼Œè§£é‡Šå› äººè€Œå¼‚ï¼›è€Œä¸”å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬å¾ˆéš¾å°†æƒ…ç»ªå½’ç±»ä¸ºå•ä¸€ç±»åˆ«ï¼Œæˆ‘ä»¬åœ¨ä»»ä½•ç»™å®šæ—¶é—´éƒ½å¯èƒ½æ„Ÿå—åˆ°ä¸€ç³»åˆ—æƒ…ç»ªã€‚æ‰€ä»¥çœŸå®è§£å†³è¿™ä¸ªé—®é¢˜çš„æ—¶å€™ï¼Œæ•°æ®çš„é‡‡é›†å’Œæ ‡æ³¨å…¶å®æ˜¯ä¸€ä¸ªæœ‰æŒ‘æˆ˜çš„ä»»åŠ¡ã€‚

## ğŸ’¡ æ•°æ®è¯´æ˜

åœ¨æœ¬ç¯‡ä¸­ï¼ŒShowMeAIä½¿ç”¨åˆ°çš„æ˜¯å…¬å¼€æ•°æ®é›†RAVDESSæ¥è®­ç»ƒè¯¥æ¨¡å‹ã€‚RAVDESS æ•°æ®é›†åŒ…å«1440ä¸ªæ–‡ä»¶ï¼Œè¦†ç›–ä¸¤ç§ä¸åŒç±»å‹çš„æ•°æ®ï¼š**æ¼”è®²**å’Œ**æ­Œæ›²**ã€‚ç”±24ä½ä¸“ä¸šæ¼”å‘˜ï¼ˆ12ä½å¥³æ€§ï¼Œ12ä½ç”·æ€§ï¼‰å½•åˆ¶ï¼Œè¯­éŸ³æƒ…ç»ªåŒ…æ‹¬å¹³é™ã€å¿«ä¹ã€æ‚²ä¼¤ã€æ„¤æ€’ã€ææƒ§ã€æƒŠè®¶å’ŒåŒæ¶ã€‚æ¯ç§æƒ…ç»ªéƒ½åŒ…å«2ç§ä¸åŒçš„ç¨‹åº¦ï¼ˆæ­£å¸¸ï¼Œå¼ºçƒˆï¼‰ã€‚

<div align=center><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/92a09628a37f4a30983715b33682623f~tplv-k3u1fbpfcp-zoom-1.image" width="70%" referrerpolicy="no-referrer"></div>

æ•°æ®å¯ä»¥åœ¨ ğŸ†[**kaggleå¹³å°æ•°æ®é¡µ**](https://www.kaggle.com/datasets/uwrfkaggler/ravdess-emotional-speech-audio)ä¸‹è½½ï¼Œå¤§å®¶ä¹Ÿå¯ä»¥åœ¨ShowMeAIçš„ç™¾åº¦ç½‘ç›˜ä¸­ç›´æ¥ä¸‹è½½æ•´ç†å¥½çš„ç‰ˆæœ¬ã€‚

> ğŸ† **å®æˆ˜æ•°æ®é›†ä¸‹è½½ï¼ˆç™¾åº¦ç½‘ç›˜ï¼‰**ï¼šå…¬ä¼—å·ã€ShowMeAIç ”ç©¶ä¸­å¿ƒã€å›å¤ã€**å®æˆ˜**ã€ï¼Œæˆ–è€…ç‚¹å‡» [**è¿™é‡Œ**](http://www.showmeai.tech/article-detail/305) è·å–æœ¬æ–‡ [[4] æ­å»ºåŸºäºæ·±åº¦å­¦ä¹ çš„è¯­éŸ³æƒ…æ„Ÿè¯†åˆ«ç³»ç»Ÿ](http://www.showmeai.tech/article-detail/291) ã€**RAVDESS Emotional speech audio æ•°æ®é›†**ã€

> â­ **ShowMeAIå®˜æ–¹GitHub**ï¼š[https://github.com/ShowMeAI-Hub](https://github.com/ShowMeAI-Hub)

## ğŸ’¡ ç¥ç»ç½‘ç»œå¼€å‘åº”ç”¨

æˆ‘ä»¬ä½¿ç”¨ç¥ç»ç½‘ç»œæ¥å¯¹éŸ³é¢‘æ•°æ®è¿›è¡Œç†è§£å’Œåˆ†æé¢„ä¼°ï¼Œæœ‰ä¸åŒçš„ç¥ç»ç½‘ç»œå¯ä»¥ä½¿ç”¨ï¼ˆå¤šå±‚æ„ŸçŸ¥å™¨ã€ CNN å’Œ LSTM ç­‰éƒ½å¯ä»¥å¤„ç†éŸ³é¢‘æ—¶åºæ•°æ®ï¼‰ï¼ŒåŸºäºæ•ˆç‡å’Œæ•ˆæœè€ƒè™‘ï¼Œæˆ‘ä»¬ä¸‹é¢ä¼šæ„å»ºæ·±åº¦å·ç§¯ç¥ç»ç½‘ç»œæ¥å¯¹éŸ³é¢‘æ–‡ä»¶ä¸­çš„æƒ…ç»ªè¿›è¡Œåˆ†ç±»ã€‚

<div align=center><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6bc4c93e6e7446efbb1e28a518058fbc~tplv-k3u1fbpfcp-zoom-1.image" width="100%" referrerpolicy="no-referrer"></div>



> å…³äºå·ç§¯ç¥ç»ç½‘ç»œçš„è¯¦ç»†çŸ¥è¯†å¯ä»¥å‚è€ƒ[ShowMeAI](http://www.showmeai.tech/)ä¸‹è¿°æ•™ç¨‹ï¼š
> - [ShowMeAI](http://www.showmeai.tech/)çš„ [**æ·±åº¦å­¦ä¹ æ•™ç¨‹ | å´æ©è¾¾ä¸“é¡¹è¯¾ç¨‹ Â· å…¨å¥—ç¬”è®°è§£è¯»**](<http://www.showmeai.tech/tutorials/35>)ä¸­çš„æ–‡ç«  [**å·ç§¯ç¥ç»ç½‘ç»œè§£è¯»**](http://www.showmeai.tech/article-detail/221)
> - [ShowMeAI](http://www.showmeai.tech/)çš„ [**æ·±åº¦å­¦ä¹ ä¸è®¡ç®—æœºè§†è§‰æ•™ç¨‹**](<http://www.showmeai.tech/tutorials/37>)ä¸­çš„æ–‡ç«  [**å·ç§¯ç¥ç»ç½‘ç»œè¯¦è§£**](<http://www.showmeai.tech/article-detail/264>)

### â‘  æ•°æ®å¯¼å…¥ä¸ç®€å•åˆ†æ

æˆ‘ä»¬é¦–å…ˆå¯¼å…¥æ•°æ®ï¼Œå¹¶åšä¸€ç‚¹ç®€å•çš„å¯è§†åŒ–å’Œåˆ†æï¼Œè¿™é‡Œçš„éŸ³é¢‘æ•°æ®æˆ‘ä»¬ä¼šä½¿ç”¨ LibROSAå·¥å…·åº“æ¥å¤„ç†å’Œç»˜å›¾ï¼ˆæ³¢å½¢å’Œé¢‘è°±å›¾ï¼‰ã€‚

é’ˆå¯¹è¯­éŸ³ç›¸å…³çš„ä»»åŠ¡ï¼ˆè¯­éŸ³è¯†åˆ«ã€å£°çº¹è¯†åˆ«ç­‰ï¼‰ï¼ŒMFCCï¼ˆMel Frequency Cepstrum Coefficientï¼ŒMelé¢‘ç‡å€’è°±ç³»æ•°ï¼‰æ˜¯éå¸¸æœ‰æ•ˆçš„è¡¨å¾ç‰¹å¾ã€‚Melé¢‘ç‡æ˜¯åŸºäºäººè€³å¬è§‰ç‰¹æ€§æå‡ºæ¥çš„ï¼Œå®ƒä¸Hzé¢‘ç‡æˆéçº¿æ€§å¯¹åº”å…³ç³»ã€‚Melé¢‘ç‡å€’è°±ç³»æ•°(MFCC)åˆ™æ˜¯åˆ©ç”¨å®ƒä»¬ä¹‹é—´çš„è¿™ç§å…³ç³»ï¼Œè®¡ç®—å¾—åˆ°çš„Hzé¢‘è°±ç‰¹å¾ï¼Œå®ƒå¹¿æ³›åœ°åº”ç”¨åœ¨è¯­éŸ³å„é¡¹ä»»åŠ¡ä¸­ã€‚ä½¿ç”¨ LibROSA åŒ…å¯ä»¥è½»æ¾å¯¼å…¥éŸ³é¢‘æ•°æ®å¹¶æå– MFCC æ ¼å¼ä¿¡æ¯ã€‚

```
# åœ¨notebookä¸­é€šè¿‡pip installå®‰è£…librosaåŒ…
!pip install librosa
```

```
# å¯¼å…¥å·¥å…·åº“
import librosa
import librosa.display
import numpy as np
import pandas as pd
import glob
import os, sys
import matplotlib.pyplot as plt
```

```
# è¯»å–éŸ³é¢‘æ•°æ®
data, sampling_rate = librosa.load('Data/03-02-06-02-02-02-12.wav')

# ç»˜åˆ¶éŸ³é¢‘å›¾åƒ
%matplotlib inline
plt.figure(figsize=(15, 5))
librosa.display.waveshow(data, sr=sampling_rate)
```

æˆ‘ä»¬å¾—åˆ°äº†å¦‚ä¸‹çš„éŸ³é¢‘æ³¢å½¢å›¾

<div align=center><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a54ae3cb45444622b40bf2dccda94655~tplv-k3u1fbpfcp-zoom-1.image" width="70%" referrerpolicy="no-referrer"></div>

ä¸‹é¢æˆ‘ä»¬ç»˜åˆ¶ä¸€ä¸‹éŸ³é¢‘çš„é¢‘è°±å›¾

```
import scipy.io.wavfile

sr,x = scipy.io.wavfile.read('RawData/03-02-06-02-02-02-12.wav')

## å‚æ•°: 10msä¸€æ­¥, 30msçª—é•¿
nstep = int(sr * 0.01)
nwin  = int(sr * 0.03)
nfft = nwin

window = np.hamming(nwin)


nn = range(nwin, len(x), nstep)
X = np.zeros( (len(nn), nfft//2) )

for i,n in enumerate(nn):
    xseg = x[n-nwin:n]
    z = np.fft.fft(window * xseg, nfft)
    X[i,:] = np.log(np.abs(z[:nfft//2]))

plt.imshow(X.T, interpolation='nearest',
    origin='lower',
    aspect='auto')

plt.show()
```

ç”Ÿæˆçš„é¢‘è°±å›¾å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚

<div align=center><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e07601c881b348b2b8d3511ec65556ce~tplv-k3u1fbpfcp-zoom-1.image" width="70%" referrerpolicy="no-referrer"></div>

### â‘¡ æ•°æ®æ ‡ç­¾æ„å»ºä¸æ˜ å°„

ä¸‹ä¸€æ­¥æˆ‘ä»¬æ¥æ„å»ºä¸€ä¸‹åˆ†ç±»é—®é¢˜çš„æ ‡ç­¾æ•°æ®

```
feeling_list=[]

# æ‰€æœ‰æ•°æ®
mylist= os.listdir('Data/')

# éå†æ•°æ®
for item in mylist:
    if item[6:-16]=='02' and int(item[18:-4])%2==0:
        feeling_list.append('female_calm') #å¥³æ€§å¹³é™
    elif item[6:-16]=='02' and int(item[18:-4])%2==1:
        feeling_list.append('male_calm') #ç”·æ€§å¹³é™
    elif item[6:-16]=='03' and int(item[18:-4])%2==0:
        feeling_list.append('female_happy') #å¥³æ€§å¼€å¿ƒ
    elif item[6:-16]=='03' and int(item[18:-4])%2==1:
        feeling_list.append('male_happy') #ç”·æ€§å¼€å¿ƒ
    elif item[6:-16]=='04' and int(item[18:-4])%2==0:
        feeling_list.append('female_sad') #å¥³æ€§æ‚²ä¼¤
    elif item[6:-16]=='04' and int(item[18:-4])%2==1:
        feeling_list.append('male_sad') #ç”·æ€§æ‚²ä¼¤
    elif item[6:-16]=='05' and int(item[18:-4])%2==0:
        feeling_list.append('female_angry') #å¥³æ€§æ„¤æ€’
    elif item[6:-16]=='05' and int(item[18:-4])%2==1:
        feeling_list.append('male_angry') #ç”·æ€§æ„¤æ€’
    elif item[6:-16]=='06' and int(item[18:-4])%2==0:
        feeling_list.append('female_fearful') #å¥³æ€§ææƒ§
    elif item[6:-16]=='06' and int(item[18:-4])%2==1:
        feeling_list.append('male_fearful') #ç”·æ€§ææƒ§
    elif item[:1]=='a':
        feeling_list.append('male_angry') #ç”·æ€§æ„¤æ€’
    elif item[:1]=='f':
        feeling_list.append('male_fearful') #ç”·æ€§ææƒ§
    elif item[:1]=='h':
        feeling_list.append('male_happy') #ç”·æ€§å¼€å¿ƒ
    #elif item[:1]=='n':
        #feeling_list.append('neutral')
    elif item[:2]=='sa':
        feeling_list.append('male_sad') #ç”·æ€§æ‚²ä¼¤
```

```
# æ„å»ºlabel Dataframe
labels = pd.DataFrame(feeling_list)
# è¾“å‡ºå‰920ä¸ªæ ·æœ¬label
labels[:920]
```

è¾“å‡ºçš„labelå¦‚ä¸‹æ‰€ç¤º

<div align=center><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/baeb86e26a3044b6a48a11ad647d51b0~tplv-k3u1fbpfcp-zoom-1.image" width="70%" referrerpolicy="no-referrer"></div>

### â‘¢ æ•°æ®å¤„ç†ä¸ç‰¹å¾å·¥ç¨‹

æˆ‘ä»¬å·²ç»å¯¹æ•°æ®åšäº†åˆæ­¥ç†è§£äº†ï¼Œä¸‹é¢æˆ‘ä»¬ä»éŸ³é¢‘æ–‡ä»¶ä¸­æå–ç‰¹å¾ï¼ˆéŸ³é¢‘ä¿¡æ¯è¡¨å¾ï¼‰ï¼Œæ¨¡å‹å¯ä»¥æ›´æœ‰æ•ˆåœ°å¯¹éŸ³é¢‘è¿›è¡Œå»ºæ¨¡å’Œé¢„ä¼°ã€‚è¿™é‡Œçš„ç‰¹å¾æå–æˆ‘ä»¬ä¾æ—§ä½¿ç”¨ LibROSA åº“ã€‚

å› ä¸ºCNNæ¨¡å‹çš„è¾“å…¥ç»´åº¦æ˜¯å›ºå®šçš„ï¼Œæˆ‘ä»¬åœ¨ç‰¹å¾æå–è¿‡ç¨‹ä¸­ï¼Œé™åˆ¶äº†éŸ³é¢‘é•¿åº¦ï¼ˆ3 ç§’ï¼Œå¤§å®¶åœ¨è®¡ç®—èµ„æºè¶³çš„æƒ…å†µä¸‹å¯ä»¥é€‰æ‹©æ›´é•¿çš„æ—¶é—´ï¼‰ã€‚æˆ‘ä»¬è¿˜åšäº†ä¸€ç‚¹å¤„ç†ï¼ŒæŠŠæ¯ä¸ªæ–‡ä»¶çš„é‡‡æ ·ç‡å¢åŠ äº†ä¸€å€ï¼ŒåŒæ—¶ä¿æŒé‡‡æ ·é¢‘ç‡ä¸å˜ã€‚è¿™ä¸ªæ“ä½œæ˜¯ä¸ºäº†æ”¶é›†åˆ°æ›´å¤šç‰¹å¾ã€‚

```
# æ„å»º1ä¸ªåŒ…å«featureç‰¹å¾åˆ—çš„Dataframe
df = pd.DataFrame(columns=['feature'])
bookmark=0

# éå†æ•°æ®
for index,y in enumerate(mylist):
    if mylist[index][6:-16] not in ['01', '07', '08'] and mylist[index][:2]!='su' and mylist[index][:1] not in ['n','d']:
        X, sample_rate = librosa.load('Data/'+y, res_type='kaiser_fast',duration=2.5,sr=22050*2,offset=0.5)
        mfccs = librosa.feature.mfcc(y=X, sr=np.array(sample_rate), n_mfcc=13)
        feature = np.mean(mfccs, axis=0)
        df.loc[bookmark] = [feature]
        bookmark=bookmark+1     
```

```
# æ‹¼æ¥ç‰¹å¾ä¸æ ‡ç­¾
df3 = pd.DataFrame(df['feature'].values.tolist())
newdf = pd.concat([df3,labels], axis=1)
# é‡å‘½åæ ‡ç­¾å­—æ®µ
rnewdf = newdf.rename(index=str, columns={"0": "label"})
```

å¾—åˆ°çš„ç‰¹å¾åˆ—å’Œæ ‡ç­¾åˆ—å¦‚ä¸‹æ‰€ç¤ºï¼š

<div align=center><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a5ed7e7fffa44b5d9b77a2d319dafc45~tplv-k3u1fbpfcp-zoom-1.image" width="70%" referrerpolicy="no-referrer"></div>

### â‘£ æ¨¡å‹æ„å»ºä¸ä¼˜åŒ–

åœ¨å®Œæˆæ•°æ®ç‰¹å¾æŠ½å–ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹å»ºæ¨¡äº†ï¼Œä¸ºäº†ç§‘å­¦åœ°å»ºæ¨¡å’Œæ•ˆæœè¯„ä¼°ï¼Œæˆ‘ä»¬ä¼šå°†æ¨¡å‹åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼Œç”¨æµ‹è¯•é›†è¯„ä¼°æ¨¡å‹çš„æ€§èƒ½ã€‚

```
# æ‰“ä¹±æ ·æœ¬é¡ºåº
from sklearn.utils import shuffle
rnewdf = shuffle(newdf)

# 80%çš„è®­ç»ƒé›†ï¼Œ20%çš„æµ‹è¯•é›†
newdf1 = np.random.rand(len(rnewdf)) < 0.8
train = rnewdf[newdf1]
test = rnewdf[~newdf1]

# è¾“å‡ºéƒ¨åˆ†æ•°æ®çœ‹çœ‹
train[250:260]
```

æˆ‘ä»¬å¾—åˆ°å¦‚ä¸‹çš„è®­ç»ƒé›†éƒ¨åˆ†æ ·æœ¬

<div align=center><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a60f53b32a8645b38162cef15d5f5519~tplv-k3u1fbpfcp-zoom-1.image" width="70%" referrerpolicy="no-referrer"></div>

åœ¨å®é™…å»ºæ¨¡çš„æ—¶å€™ï¼Œæ ‡ç­¾çš„æ ¼å¼è¦é€‚ç”¨ç½‘ç»œæœ€åçš„softmaxç»“æ„ï¼Œæˆ‘ä»¬å¯¹æ ‡ç­¾labelä½¿ç”¨LabelEncoderè¿›è¡Œæ˜ å°„å¤„ç†ï¼Œå¾—åˆ°one-hotçš„è¡¨ç¤ºã€‚

> å…³äºone-hotç‹¬çƒ­å‘é‡ç¼–ç ï¼Œå¯ä»¥æŸ¥çœ‹ShowMeAIçš„[æœºå™¨å­¦ä¹ å®æˆ˜æ•™ç¨‹](http://showmeai.tech/tutorials/41)ä¸­çš„æ–‡ç«  [**æœºå™¨å­¦ä¹ ç‰¹å¾å·¥ç¨‹æœ€å…¨è§£è¯»**](http://www.showmeai.tech/article-detail/208)

```
# è®­ç»ƒé›†ç‰¹å¾ä¸æ ‡ç­¾
trainfeatures = train.iloc[:, :-1]
trainlabel = train.iloc[:, -1:]

# æµ‹è¯•é›†ç‰¹å¾ä¸æ ‡ç­¾
testfeatures = test.iloc[:, :-1]
testlabel = test.iloc[:, -1:]

from tensorflow.keras.utils import np_utils
from sklearn.preprocessing import LabelEncoder
# è½¬ä¸ºnumpy arrayæ ¼å¼
X_train = np.array(trainfeatures)
y_train = np.array(trainlabel)
X_test = np.array(testfeatures)
y_test = np.array(testlabel)

# æ˜ å°„ç¼–ç 
lb = LabelEncoder()
y_train = np_utils.to_categorical(lb.fit_transform(y_train))
y_test = np_utils.to_categorical(lb.fit_transform(y_test))
```

æˆ‘ä»¬å¾—åˆ°çš„ y_train å½¢å¦‚ä¸‹é¢æ ¼å¼ï¼š

<div align=center><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fdc253414a874470a8593d5e240df933~tplv-k3u1fbpfcp-zoom-1.image" width="70%" referrerpolicy="no-referrer"></div>

ä¸‹é¢æˆ‘ä»¬æ„å»ºä¸€ä¸ªæ·±åº¦å·ç§¯ç½‘ç»œæ¥å®Œæˆåˆ†ç±»é—®é¢˜ã€‚è¿™ä¸ª CNN æ¨¡å‹åŒ…æ‹¬Conv1Då·ç§¯å±‚ã€poolingæ± åŒ–å±‚ï¼Œä»¥åŠ Dropout éšæœºå¤±æ´»å±‚ï¼Œä»¥åŠæœ€åçš„å…¨è¿æ¥å±‚ã€‚

```
# æ‰©å……ç»´åº¦
x_traincnn =np.expand_dims(X_train, axis=2)
x_testcnn= np.expand_dims(X_test, axis=2)

# æ„å»ºCNNåºè´¯æ¨¡å‹
model = Sequential()
# å·ç§¯å±‚+æ¿€æ´»å±‚
model.add(Conv1D(256, 5,padding='same', input_shape=(216,1)))
model.add(Activation('relu'))
model.add(Conv1D(128, 5,padding='same'))
model.add(Activation('relu'))
# Dropouté˜²æ­¢è¿‡æ‹Ÿåˆ
model.add(Dropout(0.1))
# æ± åŒ–å±‚é™ç»´
model.add(MaxPooling1D(pool_size=(8)))
# å·ç§¯å±‚+æ¿€æ´»å±‚
model.add(Conv1D(128, 5,padding='same',))
model.add(Activation('relu'))
model.add(Conv1D(128, 5,padding='same',))
model.add(Activation('relu'))
# å±•å¹³+å…¨è¿æ¥å±‚
model.add(Flatten())
model.add(Dense(10))
model.add(Activation('softmax'))
```

```
# è¾“å‡ºæ¨¡å‹ä¿¡æ¯
model.summary()
```

æˆ‘ä»¬å¾—åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼Œå¤§å®¶å¯ä»¥æ¸…æ™°åœ°çœ‹åˆ°æ¨¡å‹ç»“æ„

<div align=center><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c422655e52454e5fa8deccd7f9cc6231~tplv-k3u1fbpfcp-zoom-1.image" width="70%" referrerpolicy="no-referrer"></div>

ä¸‹é¢æˆ‘ä»¬ä½¿ç”¨æ¨¡å‹å¯¹æ•°æ®è¿›è¡Œæ‹Ÿåˆè®­ç»ƒ

```
# ç¼–è¯‘
model.compile(loss='categorical_crossentropy', optimizer='adam',metrics=['accuracy'])
# è®­ç»ƒ
cnnhistory=model.fit(x_traincnn, y_train, batch_size=16, epochs=700, validation_data=(x_testcnn, y_test))
```

éƒ¨åˆ†è®­ç»ƒä¿¡æ¯å¦‚ä¸‹ï¼š

<div align=center><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dbfb7ed6b4af43b09576d9756fd18ff5~tplv-k3u1fbpfcp-zoom-1.image" width="70%" referrerpolicy="no-referrer"></div>

### â‘¤ æ¨¡å‹å­˜å‚¨åŠæµ‹è¯•é›†è¯„ä¼°

```
# æ¨¡å‹å­˜å‚¨

# æ¨¡å‹åç§°
model_name = 'Emotion_Voice_Detection_Model.h5'
# è·¯å¾„åç§°
save_dir = os.path.join(os.getcwd(), 'saved_models')
model_path = os.path.join(save_dir, model_name)
# æ¨¡å‹å­˜å‚¨
model.save(model_path)
print('æ¨¡å‹å­˜å‚¨åœ¨ %s ' % model_path)
```

```
# æ¨¡å‹é‡åŠ è½½ä¸æµ‹è¯•é›†è¯„ä¼°
from tensorflow import keras
loaded_model = keras.models.load_model(model_path)

# æµ‹è¯•é›†è¯„ä¼°
score = loaded_model.evaluate(x_testcnn, y_test, verbose=0)
print("%s: %.2f%%" % (loaded_model.metrics_names[1], score[1]*100))
```

### â‘¥ æµ‹è¯•é›†é¢„ä¼°

```
# é¢„ä¼°å¾—åˆ°æ¦‚ç‡
preds = loaded_model.predict(x_testcnn, batch_size=32, verbose=1)
# å–å‡ºæ¦‚ç‡æœ€é«˜çš„ç±»åˆ«
pred_labels = preds.argmax(axis=1)
# æ˜ å°„å›æƒ…ç»ªåç§°
pred_labels = pred_labels.astype(int).flatten()
predictedvalues = (lb.inverse_transform((pred_labels)))

# çœŸå®æµ‹è¯•é›†æ ‡ç­¾
actual_labels = y_test.argmax(axis=1).astype(int).flatten()
actualvalues = (lb.inverse_transform((actual_labels)))

# åˆå¹¶é¢„æµ‹æ ‡ç­¾ä¸çœŸå®æ ‡ç­¾
final_df = pd.DataFrame({'actualvalues': actualvalues, 'predictedvalues': predictedvalues})

# è¾“å‡ºéƒ¨åˆ†ç»“æœ
final_df[170:176]
```

ç»“æœå¦‚ä¸‹ï¼š

<div align=center><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/43390ad95e464021917876bc21a8108f~tplv-k3u1fbpfcp-zoom-1.image" width="70%" referrerpolicy="no-referrer"></div>

## ğŸ’¡ å®æ—¶é¢„ä¼°æ¼”ç¤º

ä¸‹é¢æˆ‘ä»¬å½•åˆ¶äº†ä¸€ä¸ªå®æ—¶éŸ³é¢‘æ–‡ä»¶ï¼Œå¹¶åœ¨å¾—åˆ°çš„æ¨¡å‹ä¸Šè¿›è¡Œæµ‹è¯•ã€‚

```
# å½•åˆ¶éŸ³é¢‘
import sounddevice as sd
from scipy.io.wavfile import writefs = 44100  # é‡‡æ ·ç‡
seconds = 4  # æ—¶é•¿
sd.wait()  # å½•åˆ¶ç›´è‡³ç»“æŸ
write('output.wav', fs, myrecording)  # å­˜å‚¨ä¸ºwavæ–‡ä»¶
```

```
data, sampling_rate = librosa.load('output.wav')
plt.figure(figsize=(15, 5))
librosa.display.waveshow(data, sr=sampling_rate)
```

<div align=center><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8fd1a0375add40c083aaa9f4100ccdb2~tplv-k3u1fbpfcp-zoom-1.image" width="70%" referrerpolicy="no-referrer"></div>

```

X, sample_rate = librosa.load('output.wav', res_type='kaiser_fast',duration=2.5,sr=22050*2,offset=0.5)
mfccs = np.mean(librosa.feature.mfcc(y=X, sr=np.array(sample_rate), n_mfcc=13),axis=0)
livedf= pd.DataFrame(data=mfccs)
livedf = np.expand_dims(livedf.stack().to_frame().T, axis=2)
livepreds = loaded_model.predict(livedf, batch_size=32, verbose=1)
lb.inverse_transform(livepreds.argmax(axis=1))
```

æˆ‘ä»¬å¾—åˆ°æ­£ç¡®çš„ç»“æœ`array(['male_sad'], dtype=object)`ã€‚

## å‚è€ƒèµ„æ–™

- ğŸ† **å®æˆ˜æ•°æ®é›†ä¸‹è½½ï¼ˆç™¾åº¦ç½‘ç›˜ï¼‰**ï¼šå…¬ä¼—å·ã€ShowMeAIç ”ç©¶ä¸­å¿ƒã€å›å¤ã€**å®æˆ˜**ã€ï¼Œæˆ–è€…ç‚¹å‡» [**è¿™é‡Œ**](http://www.showmeai.tech/article-detail/305) è·å–æœ¬æ–‡ [[4] æ­å»ºåŸºäºæ·±åº¦å­¦ä¹ çš„è¯­éŸ³æƒ…æ„Ÿè¯†åˆ«ç³»ç»Ÿ](http://www.showmeai.tech/article-detail/291) ã€**RAVDESS Emotional speech audio æ•°æ®é›†**ã€
- â­ **ShowMeAIå®˜æ–¹GitHub**ï¼š[https://github.com/ShowMeAI-Hub](https://github.com/ShowMeAI-Hub)
- ğŸ“˜ **æ·±åº¦å­¦ä¹ æ•™ç¨‹ | å´æ©è¾¾ä¸“é¡¹è¯¾ç¨‹ Â· å…¨å¥—ç¬”è®°è§£è¯»**: [http://www.showmeai.tech/tutorials/35](http://www.showmeai.tech/tutorials/35)
- ğŸ“˜**å·ç§¯ç¥ç»ç½‘ç»œè§£è¯»**: [http://www.showmeai.tech/article-detail/221](http://www.showmeai.tech/article-detail/221)
- ğŸ“˜**æ·±åº¦å­¦ä¹ ä¸è®¡ç®—æœºè§†è§‰æ•™ç¨‹**: [http://www.showmeai.tech/tutorials/37](http://www.showmeai.tech/tutorials/37)
- ğŸ“˜**å·ç§¯ç¥ç»ç½‘ç»œè¯¦è§£**: [http://www.showmeai.tech/article-detail/264](http://www.showmeai.tech/article-detail/264)
- ğŸ“˜**æœºå™¨å­¦ä¹ å®æˆ˜æ•™ç¨‹**: [http://showmeai.tech/tutorials/41](http://showmeai.tech/tutorials/41)
- ğŸ“˜ **æœºå™¨å­¦ä¹ ç‰¹å¾å·¥ç¨‹æœ€å…¨è§£è¯»**: [http://www.showmeai.tech/article-detail/208](http://www.showmeai.tech/article-detail/208)


<a href="https://www.showmeai.tech/"><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e9190f41b8de4af38c8a1a0c96f0513b~tplv-k3u1fbpfcp-zoom-1.image" width="100%" referrerpolicy="no-referrer"></a>

> æˆ‘æ­£åœ¨å‚ä¸æ˜é‡‘æŠ€æœ¯ç¤¾åŒºåˆ›ä½œè€…ç­¾çº¦è®¡åˆ’æ‹›å‹Ÿæ´»åŠ¨ï¼Œ[ç‚¹å‡»é“¾æ¥æŠ¥åæŠ•ç¨¿](https://juejin.cn/post/7112770927082864653)ã€‚
