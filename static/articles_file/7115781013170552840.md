> æ¬¢è¿å…³æ³¨å¾®ä¿¡å…¬ä¼—å·ï¼š[FSAå…¨æ ˆè¡ŒåŠ¨ ğŸ‘‹](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/31960a996f1f4b0da35d69ab7480f7d6~tplv-k3u1fbpfcp-zoom-1.image)

## ä¸€ã€å‰æƒ…æ¦‚è¦

ç›®å‰ï¼Œæˆ‘åœ¨å¼€å‘çš„ä¸€ä¸ª Android é¡¹ç›®éœ€è¦å„ä¸ªåŠŸèƒ½åšåˆ°çº¿ä¸ŠåŠ¨æ€åŒ–ï¼Œå…¶ä¸­ï¼ŒApp å¯åŠ¨æ—¶æ˜¾ç¤ºçš„ Loading æ¨¡å—ï¼Œä¼šä¼˜å…ˆæ£€æµ‹åŠ è½½è¿œç¨‹çš„ Loading æ¨¡å—ï¼ŒåŠ è½½å¤±è´¥æ—¶ï¼Œä¼šä½¿ç”¨ App æœ¬èº«é»˜è®¤çš„ Loading è§†å›¾ï¼Œä¸ºæ­¤ï¼Œæˆ‘ç¼–å†™äº†ä¸€ä¸ª LoadingLoader å·¥å…·ç±»ï¼š

```kotlin
/**
 * Loading åŠ è½½å™¨
 *
 * @author GitLqr
 * @since 2022/7/2
 */
object LoadingLoader {

    private var isInited = false // é˜²æ­¢å¤šæ¬¡åˆå§‹åŒ–
    private lateinit var onLoadFail: () -> Unit // è¿œç¨‹loadingåŠ è½½å¤±è´¥æ—¶çš„å›è°ƒ
    private lateinit var onLoadComplete: () -> Unit // åŠ è½½å®Œæˆåå›è°ƒï¼ˆæ— è®ºæˆåŠŸå¤±è´¥ï¼‰

    fun init(onLoadFail: () -> Unit = {}, onLoadComplete: () -> Unit = {}): LoadingLoader {
        if (!isInited) {
            this.onLoadFail = onLoadFail
            this.onLoadComplete = onLoadComplete
            isInited = true
        } else {
            log("you have inited, this time is not valid")
        }
        return this
    }

    fun go() {
        if (isInited) {
            loadRemoteLoading(callback = { isSuccess ->
                if (!isSuccess) onLoadFail()
                onLoadComplete()
            })
        } else {
            log("you must invoke init() firstly")
        }
    }

    private fun loadRemoteLoading(callback: (boolean: Boolean) -> Unit) {
        // æ¨¡æ‹Ÿè¿œç¨‹ Loading æ¨¡å—åŠ è½½å¤±è´¥
        Handler(Looper.getMainLooper()).postDelayed({
            callback(false)
        }, 1000)
    }

    private fun log(msg: String) {
        Log.e("LoadingUpdater", msg)
    }
}
```

LoadingLoader å·¥å…·ç±»ä½¿ç”¨ Kotlin çš„å•ä¾‹æ¨¡å¼ï¼Œ`init()` æ–¹æ³•æ¥æ”¶ 2 ä¸ªå›è°ƒå‚æ•°ï¼Œ`go()` æ–¹æ³•è§¦å‘åŠ è½½è¿œç¨‹ Loading æ¨¡å—ï¼Œå¹¶æ ¹æ®åŠ è½½ç»“æœæ‰§è¡Œå›è°ƒï¼Œå…¶ä¸­ `isInited` ç”¨äºé˜²æ­¢è¯¥å·¥å…·ç±»è¢«åˆå§‹åŒ–å¤šæ¬¡ã€‚ç„¶åï¼Œåœ¨ App çš„ä¸»å…¥å£ LoadingActivity ä¸­ä½¿ç”¨ LoadingLoaderï¼Œå½“åŠ è½½è¿œç¨‹ Loading æ¨¡å—å¤±è´¥æ—¶ï¼Œå°†åŸæœ¬éšè—çš„é»˜è®¤ Loading è§†å›¾æ˜¾ç¤ºå‡ºæ¥ï¼›å½“åŠ è½½ Loading æ¨¡å—å®Œæˆåï¼ˆæ— è®ºæˆåŠŸå¤±è´¥ï¼‰ï¼Œæ¨¡æ‹Ÿåˆå§‹åŒ–æ•°æ®å¹¶è·³è½¬ä¸»ç•Œé¢ï¼Œå…³é—­ LoadingActivity:

```kotlin
/**
 * App å¯åŠ¨æ—¶çš„ Loading ç•Œé¢
 *
 * @author GitLqr
 * @since 2022/7/2
 */
class LoadingActivity : AppCompatActivity() {

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_loading)
        // Loading æ¨¡å—åŠ è½½å™¨
        LoadingLoader.init(onLoadFail, onLoadComplete).go()
    }

    override fun onDestroy() {
        super.onDestroy()
        Log.e("GitLqr", "onDestroy")
    }

    private val onLoadFail: () -> Unit = {
        // æ˜¾ç¤ºé»˜è®¤ loading ç•Œé¢
        findViewById<View>(R.id.cl_def_loading).setVisibility(View.VISIBLE)
    }

    private val onLoadComplete: () -> Unit = {
        // æ¨¡æ‹Ÿåˆå§‹åŒ–æ•°æ®ï¼Œ1ç§’åè·³è½¬ä¸»ç•Œé¢
        Handler(Looper.getMainLooper()).postDelayed({
            val intent = Intent(this, MainActivity::class.java)
            intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK)
            intent.addFlags(Intent.FLAG_ACTIVITY_CLEAR_TASK)
            // æ³¨æ„ï¼šæ­¤å¤„æ„å›¾ä½¿ç”¨çš„ flagï¼Œä¼šå°† LoadingActivity ç•Œé¢å…³é—­ï¼Œè§¦å‘ onDestroy()
            startActivity(intent)
        }, 1000)
    }
}
```

LoadingActivity çš„ xml å¸ƒå±€ä»£ç å¦‚ä¸‹ï¼Œé»˜è®¤çš„ Loading å¸ƒå±€åˆå§‹çŠ¶æ€ä¸å¯è§ï¼Œå³ `visibility="gone"`ï¼š

```xml
<?xml version="1.0" encoding="utf-8"?>
<FrameLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:background="@color/black">

    <androidx.constraintlayout.widget.ConstraintLayout
        android:id="@+id/cl_def_loading"
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        android:background="#f00"
        android:visibility="gone"
        tools:visibility="visible">

        <TextView
            android:layout_width="match_parent"
            android:layout_height="match_parent"
            android:gravity="center"
            android:text="å¾ˆå¥½çœ‹çš„é»˜è®¤loadingç•Œé¢"
            android:textColor="@color/white"
            android:textSize="60dp" />

        <ProgressBar
            android:id="@+id/pb_loading"
            android:layout_width="0dp"
            android:layout_height="0dp"
            android:indeterminateDrawable="@drawable/anim_loading"
            app:layout_constraintBottom_toBottomOf="parent"
            app:layout_constraintDimensionRatio="1"
            app:layout_constraintLeft_toLeftOf="parent"
            app:layout_constraintRight_toRightOf="parent"
            app:layout_constraintTop_toTopOf="parent"
            app:layout_constraintVertical_bias="0.75"
            app:layout_constraintWidth_percent="0.064" />

    </androidx.constraintlayout.widget.ConstraintLayout>

</FrameLayout>
```

ä»¥ä¸Šä»£ç æ¯”è¾ƒç®€å•ï¼Œç°åœ¨æ¥çœ‹ä¸‹æ¼”ç¤ºæ•ˆæœ:

![](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b7b9468b20734f388d650a4d2868152e~tplv-k3u1fbpfcp-watermark.image?)

è¿™é‡Œä¼šå‘ç°ä¸€ä¸ªé—®é¢˜ï¼Œå› ä¸ºæ˜¯ä»¥æ¸…ç©ºæ ˆçš„æ–¹å¼å¯åŠ¨ MainActivityï¼Œæ‰€ä»¥ç¬¬äºŒæ¬¡å¯åŠ¨æ—¶ï¼Œç†è®ºä¸Šåº”è¯¥ä¼šè·Ÿç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶ç•Œé¢æ˜¾ç¤ºæ•ˆæœå®Œå…¨ä¸€è‡´ï¼Œå³æ¯æ¬¡å¯åŠ¨éƒ½ä¼šæ˜¾ç¤ºé»˜è®¤çš„ Loading è§†å›¾ï¼Œä½†æ˜¯å®é™…æƒ…å†µå¹¶æ²¡æœ‰ï¼Œè€Œæ§åˆ¶å°çš„æ—¥å¿—ä¹Ÿè¯å®äº† LoadingActivity çš„ onDestroy() æœ‰è¢«è§¦å‘ï¼š

![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/39bbc88f3ead4acdbab11749eb7d8ba9~tplv-k3u1fbpfcp-watermark.image?)

## äºŒã€æ‘¸ç´¢è¿‡ç¨‹

### 1ã€ä»£ç æ‰§è¡Œäº†å—ï¼Ÿ

éš¾é“ç¬¬äºŒæ¬¡å¯åŠ¨ App æ—¶ï¼ŒLoadingActivity.onLoadFail æ²¡æœ‰è§¦å‘å—ï¼ŸåŠ ä¸Šæ—¥å¿—éªŒè¯ä¸€ä¸‹ï¼š

```kotlin
class LoadingActivity : AppCompatActivity() {
    ...
    private val onLoadFail: () -> Unit = {
        // æ˜¾ç¤ºé»˜è®¤ loading ç•Œé¢
        val defLoading = findViewById<View>(R.id.cl_def_loading)
        defLoading.setVisibility(View.VISIBLE)
        Log.e("GitLqr", "defLoading.setVisibility --> ${defLoading.visibility}")
    }
}
```

é‡æ–°æ‰“åŒ…å†æ‰§è¡Œä¸€éä¸Šé¢çš„æ¼”ç¤ºæ“ä½œï¼Œæ—¥å¿—è¾“å‡ºå¦‚ä¸‹ï¼š

![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9b053e0e466f4e1b9e8525522980530e~tplv-k3u1fbpfcp-watermark.image?)

è¯´æ˜ 2 æ¬¡å¯åŠ¨éƒ½æ˜¯æœ‰è§¦å‘ LoadingActivity.onLoadFail çš„ï¼Œå¹¶ä¸”ç»“æœéƒ½æ˜¯ 0 ï¼Œå³ View.VISIBLEã€‚

> æ­¤æ—¶æœ‰ç‚¹æ€€ç–‘äººç”Ÿï¼Œäºæ˜¯ç½‘ä¸Šæ‰¾äº†ä¸€åœˆ `setVisibility() å¤±æ•ˆ` çš„åŸå› ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯åŒä¸€ä¸ªå†…å®¹ï¼ˆéƒ½ç‰¹ä¹ˆæŠ„æ¥æŠ„å»çš„ï¼‰ï¼Œè¯´æ˜¯åšåŠ¨ç”»å¯¼è‡´çš„ï¼Œå¯æ˜¯æˆ‘è¿™é‡Œå¹¶æ²¡æœ‰åšåŠ¨ç”»ï¼Œæ‰€ä»¥ä¸ç½‘ä¸Šè¯´çš„æƒ…å†µä¸ç›¸ç¬¦ã€‚

### 2ã€è§†å›¾ä¸æ˜¾ç¤ºçš„ç›´æ¥åŸå› æ˜¯ä»€ä¹ˆï¼Ÿ

æ—¢ç„¶ï¼Œä»£ç æœ‰è¾“å‡ºæ—¥å¿—ï¼Œé‚£è¯´æ˜ `setVisibility(View.VISIBLE)` è¿™è¡Œä»£ç è‚¯å®šæ‰§è¡Œè¿‡äº†ï¼Œè€Œç•Œé¢ä¸Šä¸æ˜¾ç¤ºï¼Œç›´æ¥åŸå› æ˜¯ä»€ä¹ˆï¼Ÿæ˜¯å› ä¸ºé»˜è®¤ Loading è§†å›¾çš„ visibility ä¾æ—§ä¸º View.GONEï¼Ÿåˆæˆ–è€…æ˜¯å› ä¸ºå…¶ä»–å› ç´ å¯¼è‡´ View çš„å°ºå¯¸å‡ºç°äº†é—®é¢˜ï¼Ÿè¿™æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ AndroidStudio çš„ Layout Inspector å·¥å…·ï¼Œå¯ä»¥ç›´è§‚çš„åˆ†æç•Œé¢çš„å¸ƒå±€æƒ…å†µï¼Œä¸ºäº†æ–¹ä¾¿ Layout Inspector å·¥å…·è·å– LoadingActivity çš„å¸ƒå±€ä¿¡æ¯ï¼Œéœ€è¦å°† LoadingActivity.onLoadComplete ä¸­è·³è½¬ä¸»ç•Œé¢çš„ä»£ç æ³¨é‡Šæ‰ï¼Œå…¶ä»–ä¿æŒä¸å˜ï¼š

```kotlin
class LoadingActivity : AppCompatActivity() {
    ...
    private val onLoadComplete: () -> Unit = {
        // æ¨¡æ‹Ÿåˆå§‹åŒ–æ•°æ®ï¼Œ1ç§’åè·³è½¬ä¸»ç•Œé¢
        Handler(Looper.getMainLooper()).postDelayed({
//            val intent = Intent(this, MainActivity::class.java)
//            intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK)
//            intent.addFlags(Intent.FLAG_ACTIVITY_CLEAR_TASK)
//            // æ³¨æ„ï¼šæ­¤å¤„æ„å›¾çš„ flagï¼Œä¼šå°† LoadingActivity ç•Œé¢å…³é—­ï¼Œè§¦å‘ onDestroy()
//            startActivity(intent)
        }, 1000)
    }
}
```

ç„¶åé‡å¤ä¸Šè¿°æ¼”ç¤ºæ“ä½œï¼Œç¬¬ä¸€æ¬¡å¯åŠ¨ï¼Œæ˜¾ç¤ºå‡ºé»˜è®¤ Loadingï¼Œæ‰‹åŠ¨æŒ‰è¿”å›é”®é€€å‡º Appï¼Œå†ç¬¬äºŒæ¬¡å¯åŠ¨ï¼Œä¸æ˜¾ç¤ºé»˜è®¤ Loadingï¼š

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b05e2d721362465e94b501c73e105f08~tplv-k3u1fbpfcp-watermark.image?)

æ§åˆ¶å°æ—¥å¿—ä¿¡æ¯ä¹Ÿå¦‚æœŸè¾“å‡ºï¼Œç¬¬äºŒæ¬¡å¯åŠ¨ç¡®å®æ‰§è¡Œäº† `setVisibility(View.VISIBLE)`ï¼š

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/33488b7fbd164ecfb689a8960acd6654~tplv-k3u1fbpfcp-watermark.image?)

è¿™æ—¶ï¼Œä½¿ç”¨ Layout Inspectorï¼ˆèœå•æ  -> Tools -> Layout Inspectorï¼‰ï¼Œè·å–åˆ° LoadingActivity çš„å¸ƒå±€ä¿¡æ¯ï¼š

![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b5dc925ec6c34c27a541cddadab785aa~tplv-k3u1fbpfcp-watermark.image?)

è¿™é‡Œå¯ä»¥æ–­å®šï¼Œå°±æ˜¯é»˜è®¤ Loading è§†å›¾çš„ visibility ä¾æ—§ä¸º View.GONE çš„æƒ…å†µã€‚

> æ³¨ï¼šå› ä¸º View.GONE ä¸å æ®å±å¹•ç©ºé—´ï¼Œæ‰€ä»¥å®½é«˜éƒ½ä¸º 0ï¼Œæ˜¯æ­£å¸¸çš„ã€‚

### 3ã€æ“ä½œçš„è§†å›¾æ˜¯åŒä¸€ä¸ªå—ï¼Ÿ

ç°åœ¨å›é¡¾ä¸€ä¸‹ä¸Šè¿°çš„ 2 ä¸ªçº¿ç´¢ï¼Œé¦–å…ˆï¼Œä»£ç ä¸­ç¡®å®šæ‰§è¡Œäº† `setVisibility(View.VISIBLE)`ï¼Œå¹¶ä¸”æ—¥å¿—é‡Œä¹Ÿæ˜¾ç¤ºäº†è¯¥è§†å›¾çš„æ˜¾ç¤ºçŠ¶æ€ä¸º 0ï¼Œå³ View.VISIBLEï¼š

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/33488b7fbd164ecfb689a8960acd6654~tplv-k3u1fbpfcp-watermark.image?)

å…¶æ¬¡ï¼Œä½¿ç”¨ Layout Inspector çœ‹åˆ°çš„çš„è§†å›¾çŠ¶æ€å´ä¸º View.GONEï¼š

![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b5dc925ec6c34c27a541cddadab785aa~tplv-k3u1fbpfcp-watermark.image?)

æ‰€ä»¥ï¼ŒçœŸç›¸åªæœ‰ä¸€ä¸ªï¼Œæ—¥å¿—è¾“å‡ºçš„è§†å›¾ å’Œ Layout Inspector çœ‹åˆ°çš„çš„è§†å›¾ï¼Œè‚¯å®šä¸æ˜¯åŒä¸€ä¸ªï¼ï¼ä¸ºäº†éªŒè¯è¿™ä¸€ç‚¹ï¼Œä»£ç å†åšå¦‚ä¸‹è°ƒæ•´ï¼Œåˆ†åˆ«åœ¨ onCreate() å’Œ onLoadFail ä¸­æ‰“å°é»˜è®¤ Loading è§†å›¾ä¿¡æ¯ï¼š

```kotlin
class LoadingActivity : AppCompatActivity() {
    ...
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_loading)

        val defLoading = findViewById<View>(R.id.cl_def_loading)
        Log.e("GitLqr", "onCreate ---> view is ${defLoading}")

        // Loading æ¨¡å—åŠ è½½å™¨
        LoadingLoader.init(onLoadFail, onLoadComplete).go()
    }

    private val onLoadFail: () -> Unit = {
        // æ˜¾ç¤ºé»˜è®¤ loading ç•Œé¢
        val defLoading = findViewById<View>(R.id.cl_def_loading)
        defLoading.setVisibility(View.VISIBLE)
        Log.e("GitLqr", "defLoading.setVisibility --> ${defLoading.visibility}, view is ${defLoading}")
    }
}
```

å†å¦‚ä¸Šè¿°æ¼”ç¤ºæ“ä½œä¸€éï¼Œæ—¥å¿—è¾“å‡ºå¦‚ä¸‹ï¼š

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/70d2b395fb7540008f4f79e5d92a866c~tplv-k3u1fbpfcp-watermark.image?)

å¯ä»¥çœ‹åˆ°ç¬¬äºŒæ¬¡å¯åŠ¨æ—¶ï¼ŒLoadingActivity.onLoadFail ä¸­æ“ä½œçš„è§†å›¾ï¼Œè¿˜æ˜¯ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶çš„é‚£ä¸ªè§†å›¾ï¼Œè¯¥è§†å›¾æ˜¯é€šè¿‡ findViewById è·å–åˆ°çš„ï¼Œè¯´æ˜ LoadingActivity.onLoadFail ä¸­å¼•ç”¨çš„ Activity æ˜¯ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶çš„ LoadingActivityï¼Œä¹Ÿå°±æ˜¯è¯´ LoadingActivity å‘ç”Ÿå†…å­˜æ³„éœ²äº†ã€‚æ­¤æ—¶æ‰ç„•ç„¶å¤§æ‚Ÿï¼ŒKotlin ä¸­çš„ Lambda è¡¨è¾¾å¼ï¼ˆåƒ onLoadFailã€onLoadComplete è¿™ç§ï¼‰ï¼Œå¯¹åº”åˆ° Java ä¸­å°±æ˜¯åŒ¿åå†…éƒ¨ç±»ï¼Œé€šè¿‡ Kotlin Bytecode å†åç¼–è¯‘æˆ java ä»£ç å¯ä»¥éªŒè¯è¿™ç‚¹ï¼š

```java
public final class LoadingActivity extends AppCompatActivity {
   private final Function0 onLoadFail = (Function0)(new Function0() {
      // $FF: synthetic method
      // $FF: bridge method
      public Object invoke() {
         this.invoke();
         return Unit.INSTANCE;
      }

      public final void invoke() {
         View defLoading = LoadingActivity.this.findViewById(1000000);
         defLoading.setVisibility(0);
         StringBuilder var10001 = (new StringBuilder()).append("defLoading.setVisibility --> ");
         Intrinsics.checkExpressionValueIsNotNull(defLoading, "defLoading");
         Log.e("GitLqr", var10001.append(defLoading.getVisibility()).append(", view is ").append(defLoading).toString());
      }
   });
   private final Function0 onLoadComplete;

   protected void onCreate(@Nullable Bundle savedInstanceState) {
      super.onCreate(savedInstanceState);
      this.setContentView(1300004);
      View defLoading = this.findViewById(1000000);
      Log.e("GitLqr", "onCreate ---> view is " + defLoading);
      LoadingLoader.INSTANCE.init(this.onLoadFail, this.onLoadComplete).go();
   }

   protected void onDestroy() {
      super.onDestroy();
      Log.e("GitLqr", "onDestroy");
   }

   public LoadingActivity() {
      this.onLoadComplete = (Function0)null.INSTANCE;
   }
}
```

æˆ‘ä»¬çŸ¥é“ï¼ŒJava ä¸­ï¼ŒåŒ¿åå†…éƒ¨ç±»ä¼šæŒæœ‰å¤–éƒ¨ç±»çš„å¼•ç”¨ï¼Œå³åŒ¿åå†…éƒ¨ç±»å®ä¾‹ onLoadFail æŒæœ‰ LoadingActivity å®ä¾‹ï¼Œè€Œ onLoadFail åˆä¼šé€šè¿‡ `LoadingLoader.init()` æ–¹æ³•ä¼ é€’ç»™ LoadingLoader è¿™ä¸ªå•ä¾‹å¯¹è±¡ï¼Œæ‰€ä»¥é—´æ¥å¯¼è‡´ LoadingLoader æŒæœ‰äº† LoadingActivityï¼Œå› ä¸ºå•ä¾‹ç”Ÿå‘½å‘¨æœŸä¸æ•´ä¸ª App è¿›ç¨‹ç›¸åŒï¼Œæ‰€ä»¥åªè¦ App è¿›ç¨‹ä¸æ­»ï¼Œå†…å­˜ä¸­å°±åªæœ‰ä¸€åˆ† LoadingLoader å®ä¾‹ï¼Œåˆå› ä¸ºæ˜¯å¼ºå¼•ç”¨ï¼Œæ‰€ä»¥ GC æ— æ³•å›æ”¶æ‰ç¬¬ä¸€æ¬¡åˆå§‹åŒ–æ—¶ä¼ é€’ç»™ LoadingLoader çš„ LoadingActivity å®ä¾‹ï¼Œæ‰€ä»¥ï¼Œæ— è®ºé‡å¯å¤šå°‘æ¬¡ï¼ŒonLoadFail ä¸­æ°¸è¿œéƒ½æ˜¯æ‹¿ç€ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶çš„ LoadingActivity æ¥æ‰§è¡Œ findViewByIdï¼Œæ‹¿åˆ°çš„ Loading è§†å›¾è‡ªç„¶ä¹Ÿä¸ä¼šæ˜¯å½“å‰æœ€æ–° LoadingActivity çš„ Loading è§†å›¾ã€‚

## ä¸‰ã€è§£å†³æ–¹æ¡ˆ

æ—¢ç„¶çŸ¥é“æ˜¯å› ä¸º LoadingActivity å†…å­˜æ³„éœ²å¯¼è‡´çš„ï¼Œé‚£ä¹ˆè§£å†³æ–¹æ¡ˆä¹Ÿç®€å•ï¼Œå°±æ˜¯åœ¨ LoadingLoader å®Œæˆå®ƒçš„ä½¿å‘½ä¹‹åï¼ŒåŠæ—¶é‡Šæ”¾æ‰å¯¹ LoadingActivity çš„å¼•ç”¨å³å¯ï¼Œåˆå› ä¸º LoadingActivity å®é™…ä¸Šå¹¶ä¸æ˜¯è¢« LoadingLoader ç›´æ¥å¼•ç”¨ï¼Œè€Œæ˜¯è¢«å…¶å†…éƒ¨å˜é‡ onLoadFail ç›´æ¥å¼•ç”¨çš„ï¼Œé‚£ä¹ˆåœ¨ LoadingLoader ä¸­åªéœ€è¦å°† onLoadFail çš„å¼•ç”¨åˆ‡æ–­å°±è¡Œäº†ï¼š

```kotlin
object LoadingLoader {
    private var isInited = false // é˜²æ­¢å¤šæ¬¡åˆå§‹åŒ–
    private lateinit var onLoadFail: () -> Unit // è¿œç¨‹loadingåŠ è½½å¤±è´¥æ—¶çš„å›è°ƒ
    private lateinit var onLoadComplete: () -> Unit // åŠ è½½å®Œæˆåå›è°ƒ

    fun go() {
        if (isInited) {
            loadRemoteLoading(callback = { isSuccess ->
                if (!isSuccess) onLoadFail()
                onLoadComplete()
                destroy() // ä½¿å‘½å®Œæˆï¼Œé‡Šæ”¾èµ„æº
            })
        } else {
            log("you must invoke init() firstly")
        }
    }

    fun destroy() {
        this.onLoadFail = {}
        this.onLoadComplete = {}
        this.isInited = false
    }
}
```

è‡³æ­¤ï¼Œå› å†…å­˜æ³„éœ²å¯¼è‡´ setVisibility() å¤±æ•ˆçš„é—®é¢˜å°±è§£å†³æ‰äº†ï¼Œè¦åšä¿¡ï¼Œåœ¨ä»£ç çš„ä¸–ç•Œé‡Œï¼Œæ²¡æœ‰é­”æ³•~


> å¦‚æœæ–‡ç« å¯¹æ‚¨æœ‰æ‰€å¸®åŠ©, è¯·ä¸åç‚¹å‡»å…³æ³¨ä¸€ä¸‹æˆ‘çš„å¾®ä¿¡å…¬ä¼—å·ï¼š[FSAå…¨æ ˆè¡ŒåŠ¨](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/31960a996f1f4b0da35d69ab7480f7d6~tplv-k3u1fbpfcp-zoom-1.image), è¿™å°†æ˜¯å¯¹æˆ‘æœ€å¤§çš„æ¿€åŠ±. å…¬ä¼—å·ä¸ä»…æœ‰AndroidæŠ€æœ¯, è¿˜æœ‰iOS, Pythonç­‰æ–‡ç« , å¯èƒ½æœ‰ä½ æƒ³è¦äº†è§£çš„æŠ€èƒ½çŸ¥è¯†ç‚¹å“¦~

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c6baa1e32b224ae8a002d7a9e5ad4c51~tplv-k3u1fbpfcp-zoom-1.image)